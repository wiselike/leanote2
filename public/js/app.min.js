function trimLeft(t,e){if(!e||" "==e)return $.trim(t);for(;0==t.indexOf(e);)t=t.substring(e.length);return t}function json(str){return eval("("+str+")")}function t(){var t=arguments;if(t.length<=1)return t[0];var e=t[0];if(!e)return e;var o="LEAAEL";e=e.replace(/\?/g,o);for(var n=1;n<=t.length;++n)e=e.replace(o,t[n]);return e}function arrayEqual(t,e){return t=t||[],e=e||[],t.join(",")==e.join(",")}function isArray(t){return"[object Array]"===Object.prototype.toString.call(t)}function isEmpty(t){return!t||!(!isArray(t)||0!=t.length)}function getFormJsonData(t){var e=formArrDataToJson($("#"+t).serializeArray());return e}function formArrDataToJson(t){var e={},o={};for(var n in t){var i=t[n].name,a=t[n].value;"[]"!=i.substring(i.length-2,i.length)?e[i]=a:(i=i.substring(0,i.length-2),void 0==o[i]?o[i]=[a]:o[i].push(a))}return $.extend(e,o)}function formSerializeDataToJson(t){for(var e=t.split("&"),o={},n={},i=0;i<e.length;++i){var a=e[i].split("="),r=decodeURI(a[0]),s=decodeURI(a[1]);"[]"!=r.substring(r.length-2,r.length)?o[r]=s:(r=r.substring(0,r.length-2),void 0==n[r]?n[r]=[s]:n[r].push(s))}return $.extend(o,n)}function _ajaxCallback(t,e,o){if(t===!0||"true"==t||"object"==typeof t){if(t&&"object"==typeof t&&"NOTLOGIN"==t.Msg)return void alert(getMsg("Please sign in firstly!"));"function"==typeof e&&e(t)}else"function"==typeof o?o(t):alert("error!")}function _ajax(t,e,o,n,i,a){return a="undefined"==typeof a,$.ajax({type:t,url:e,data:o,async:a,success:function(t){_ajaxCallback(t,n,i)},error:function(t){"function"==typeof i?i(t):console.error("error: undefined failureFunc!")}})}function ajaxGet(t,e,o,n,i){return _ajax("GET",t,e,o,n,i)}function ajaxPost(t,e,o,n,i){_ajax("POST",t,e,o,n,i)}function ajaxPostJson(t,e,o,n,i){i="undefined"==typeof i,$.ajax({url:t,type:"POST",contentType:"application/json; charset=utf-8",datatype:"json",async:i,data:JSON.stringify(e),success:function(t,e){_ajaxCallback(t,o,n)},error:function(t){_ajaxCallback(t,o,n)}})}function findParents(t,e){if($(t).is(e))return $(t);for(var o=$(t).parents(),n=0;n<o.length;++n)if(log(o.eq(n)),o.eq(n).is(e))return o.seq(n);return null}function getVendorPrefix(){for(var t=document.body||document.documentElement,e=t.style,o=["webkit","khtml","moz","ms","o"],n=0;n<o.length;){if("string"==typeof e[o[n]+"Transition"])return o[n];n++}}function switchEditor(t){LEA.isM=t,t?($("#mdEditor").css("z-index",3).show(),$("#leanoteNav").hide()):($("#editor").show(),$("#mdEditor").css("z-index",1).hide(),$("#leanoteNav").show())}function setEditorContent(t,e,o,n){if(t||(t=""),clearIntervalForSetContent&&clearInterval(clearIntervalForSetContent),e)MD?(MD.setContent(t),MD.clearUndo&&MD.clearUndo(),n&&n()):clearIntervalForSetContent=setTimeout(function(){setEditorContent(t,!0,!1,n)},100);else if("undefined"!=typeof tinymce&&tinymce.activeEditor){var i=tinymce.activeEditor;i.setContent(t),n&&n(),i.undoManager.clear()}else clearIntervalForSetContent=setTimeout(function(){setEditorContent(t,!1,!1,n)},100)}function previewIsEmpty(t){return!t||t.substr(0,previewToken.length)==previewToken}function isAceError(t){return!!t&&t.indexOf("XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX")!=-1}function getEditorContent(t){var e=_getEditorContent(t);return'<p><br data-mce-bogus="1"></p>'===e?"<p><br></p>":e}function _getEditorContent(t){if(t)return[MD.getContent(),"<div>"+$("#preview-contents").html()+"</div>"];var e=tinymce.activeEditor;if(e){var o=e.getContent({format:"html"}),n=$("<div>").html(o);if(n.find(".toggle-raw").remove(),window.LeaAce&&LeaAce.getAce)for(var i=n.find("pre"),a=0;a<i.length;++a){var r=i.eq(a),s=r.attr("id"),l=LeaAce.getAce(s);if(l){var c=l.getValue();isAceError(c)&&(c=r.html()),c=c.replace(/</g,"&lt").replace(/>/g,"&gt"),r.removeAttr("style","").removeAttr("contenteditable").removeClass("ace_editor"),r.html(c)}}if(n.find("pinit").remove(),n.find(".thunderpin").remove(),n.find(".pin").parent().remove(),n=$(n).html())for(;;){var d=n.lastIndexOf("</script>");if(d==-1)return n;var h=n.length;if(h-9!=d)return n;var u=n.lastIndexOf("<script ");if(u==-1&&(u=n.lastIndexOf("<script>")),u==-1)return n;n=n.substring(0,u)}return n}}function disableEditor(){var t=tinymce.activeEditor;t&&(t.hide(),LEA.editorStatus=!1,$("#mceTollbarMark").show().css("z-index",1e3))}function enableEditor(){if(!LEA.editorStatus){$("#mceTollbarMark").css("z-index",-1).hide();var t=tinymce.activeEditor;t&&t.show()}}function showDialog(t,e){$("#leanoteDialog #modalTitle").html(e.title),$("#leanoteDialog .modal-body").html($("#"+t+" .modal-body").html()),$("#leanoteDialog .modal-footer").html($("#"+t+" .modal-footer").html()),delete e.title,e.show=!0,$("#leanoteDialog").modal(e)}function hideDialog(t){t||(t=0),setTimeout(function(){$("#leanoteDialog").modal("hide")},t)}function closeDialog(){$(".modal").modal("hide")}function showDialog2(t,e){e=e||{},e.show=!0,$(t).modal(e)}function hideDialog2(t,e){e||(e=0),setTimeout(function(){$(t).modal("hide")},e)}function showDialogRemote(t,e){e=e||{},t+="?";for(var o in e)t+=o+"="+e[o]+"&";$("#leanoteDialogRemote").modal({remote:t})}function hideDialogRemote(t){t?setTimeout(function(){$("#leanoteDialogRemote").modal("hide")},t):$("#leanoteDialogRemote").modal("hide")}function notifyInfo(t){$.pnotify({title:"通知",text:t,type:"info",styling:"bootstrap"})}function notifyError(t){$.pnotify.defaults.delay=2e3,$.pnotify({title:"通知",text:t,type:"error",styling:"bootstrap"})}function notifySuccess(t){$.pnotify({title:"通知",text:t,type:"success",styling:"bootstrap"})}function goNowToDatetime(t){if(!t)return"";if("object"==typeof t)try{return t.format("yyyy-M-d hh:mm:ss")}catch(e){return getCurDate()}return t.substr(0,10)+" "+t.substr(11,8)}function getCurDate(){return(new Date).format("yyyy-M-d")}function enter(t,e,o){t||(t="body"),$(t).on("keydown",e,function(t){13==t.keyCode&&o.call(this)})}function enterBlur(t,e){t||(t="body"),e||(e=t,t="body"),$(t).on("keydown",e,function(t){13==t.keyCode&&$(this).trigger("blur")})}function getObjectId(){return ObjectId()}function resizeEditor(t){return void(LEA.isM&&MD&&MD.resize&&MD.resize())}function showMsg(t,e){$("#msg").html(t),e&&setTimeout(function(){$("#msg").html("")},e)}function showMsg2(t,e,o){$(t).html(e),o&&setTimeout(function(){$(t).html("")},o)}function showAlert(t,e,o,n){$(t).html(e).removeClass("alert-danger").removeClass("alert-success").removeClass("alert-warning").addClass("alert-"+o).show(),n&&$(n).focus()}function hideAlert(t,e){e?setTimeout(function(){$(t).hide()},e):$(t).hide()}function post(t,e,o,n){n&&$(n).button("loading"),ajaxPost(t,e,function(t){n&&$(n).button("reset"),"object"==typeof t?"function"==typeof o&&o(t):alert("leanote出现了错误!")})}function isEmail(t){var e=/^([a-zA-Z0-9]+[_|\_|\.|\-]*)*[a-zA-Z0-9\-_]+@([a-zA-Z0-9\-]+[_|\_|\.|\-]?)*[a-zA-Z0-9\-]+\.[0-9a-zA-Z]{2,6}$/;return e.test(t)}function isEmailFromInput(t,e,o,n){var i=$(t).val(),a=function(){};if(e&&(a=function(e,o){showAlert(e,o,"danger",t)}),i){if(isEmail(i))return i;a(e,n||getMsg("errorEmail"))}else a(e,o||getMsg("inputEmail"))}function initCopy(t,e){var o=new ZeroClipboard(document.getElementById(t),{moviePath:"/js/ZeroClipboard/ZeroClipboard.swf"});o.on("complete",function(t,o){e(o)})}function showLoading(){$("#loading").css("visibility","visible")}function hideLoading(){$("#loading").css("visibility","hidden")}function setCookie(t,e,o){var n=new Date;n.setDate(n.getDate()+o),document.cookie=t+"="+escape(e)+(null==o?"":";expires="+n.toGMTString())+"path=/",document.cookie=t+"="+escape(e)+(null==o?"":";expires="+n.toGMTString())+"path=/note"}function logout(){Note.curChangedSaveIt(!0),LEA.isLogout=!0,setCookie("LEANOTE_SESSION","",-1),location.href="/logout?id=1"}function getImageSize(t,e){function o(t,o){n.parentNode.removeChild(n),e({width:t,height:o})}var n=document.createElement("img");n.onload=function(){o(n.clientWidth,n.clientHeight)},n.onerror=function(){o()},n.src=t;var i=n.style;i.visibility="hidden",i.position="fixed",i.bottom=i.left=0,i.width=i.height="auto",document.body.appendChild(n)}function hiddenIframeBorder(){$(".mce-window iframe").attr("frameborder","no").attr("scrolling","no")}function getEmailLoginAddress(t){if(t){var e=t.split("@");if(e&&!(e.length<2)){var o=e[1];return email2LoginAddress[o]||"http://mail."+o}}}function reIsOk(t){return t&&"object"==typeof t&&t.Ok}function saveBookmark(){try{if(LEA.bookmark=tinymce.activeEditor.selection.getBookmark(),LEA.bookmark&&LEA.bookmark.id){var t=$($("#editorContent_ifr").contents()),e=t.find("body"),o=e.children().eq(0);if(o.is("span")){var n=o,i=n.eq(0);i.attr("id")==LEA.bookmark.id+"_start"?(LEA.hasBookmark=!1,i.remove()):LEA.hasBookmark=!0}else if(o.is("p")){var n=o.children();if(1==n.length&&""==$.trim(o.text())){var i=n.eq(0);i.attr("id")==LEA.bookmark.id+"_start"?(LEA.hasBookmark=!1,o.remove()):LEA.hasBookmark=!0}else LEA.hasBookmark=!0}}}catch(a){}}function restoreBookmark(){try{if(LEA.hasBookmark){var t=tinymce.activeEditor;t.focus(),t.selection.moveToBookmark(LEA.bookmark)}}catch(e){}}function getHashObject(){var t=location.hash;if(!t)return{};for(var e=t.substr(1),o=e.split("&"),n={},i=0;i<o.length;++i){var a=o[i].split("=");2==a.length&&(n[a[0]]=a[1])}return n}function getHash(t,e){var o=getHashObject();return o[t]}function setHash(t,e){var o=location.hash;if(!o)return void(location.href="#"+t+"="+e);var n=getHashObject();n[t]=e;var i="";for(var a in n)n[a]&&(i&&(i+="&"),i+=a+"="+n[a]);location.href="#"+i}function revertTagStatus(){$("#addTagTrigger").show(),$("#addTagInput").hide()}function hideTagList(t){$("#tagDropdown").removeClass("open"),t&&t.stopPropagation()}function showTagList(t){$("#tagDropdown").addClass("open"),t&&t.stopPropagation()}function reRenderTags(){var t=["label label-default","label label-info"],e=0;$("#tags").children().each(function(){var o=$(this).attr("class");"label label-default"!=o&&"label label-info"!=o||($(this).removeClass(o).addClass(t[e%2]),e++)})}function addShareNoteOrNotebook(t){var e="#tr"+t,o=Share.dialogNoteOrNotebookId,n=isEmailFromInput(e+" #friendsEmail","#shareMsg",getMsg("inputFriendEmail"));if(n){var i=$(e+' input[name="perm'+t+'"]:checked').val()||0,a=i,r="/share/addShareNote",s={noteId:o,emails:[n],perm:i};Share.dialogIsNote||(r="/share/addShareNotebook",s={notebookId:o,emails:[n],perm:i}),hideAlert("#shareMsg"),post(r,s,function(t){var t=t[n];if(t)if(t.Ok){var i=tt("<td>?</td>","#");i+=tt("<td>?</td>",n),i+=tt('<td><a href="#" noteOrNotebookId="?" perm="?" toUserId="?" title="'+getMsg("clickToChangePermission")+'" class="btn btn-default change-perm">?</a></td>',o,a,t.Id,a&&"0"!=a?getMsg("writable"):getMsg("readOnly")),i+=tt('<td><a href="#" noteOrNotebookId="?" toUserId="?" class="btn btn-warning delete-share">'+getMsg("delete")+"</a></td>",o,t.Id),$(e).html(i)}else{var r="/register?iu="+UserInfo.Username;showAlert("#shareMsg",getMsg("friendNotExits",[getMsg("app"),'<input style="background: none;border: 1px solid #ccc;width: 300px;padding: 3px;border-radius: 3px;outline: none;" onclick="$(this).focus().select()" type="text" value="'+r+'" />'])+"</a> <br /> "+getMsg("sendInviteEmailToYourFriend")+', <a href="#" onclick="sendRegisterEmail(\''+n+"')\">"+getMsg("send"),"warning")}},e+" .btn-success")}}function sendRegisterEmail(t){showDialog2("#sendRegisterEmailDialog",{postShow:function(){$("#emailContent").val(getMsg("inviteEmailBody",[UserInfo.Username,getMsg("app")])),setTimeout(function(){$("#emailContent").focus()},500),$("#toEmail").val(t)}})}function deleteShareNoteOrNotebook(t){$("#tr"+t).remove()}function sendLog(t,e){t&&(e||(e=""),ajaxGet("/index/log",{key:t,value:e}))}function editorMode(){this.writingHash="writing",this.normalHash="normal",this.isWritingMode=location.hash.indexOf(this.writingHash)>=0,this.toggleA=null}function initSlimScroll(){Mobile.isMobile()||($("#notebook").slimScroll({height:"100%"}),$("#noteItemList").slimScroll({height:"100%"}),$("#wmd-panel-preview").slimScroll({height:"100%"}),$("#wmd-panel-preview").css("width","100%"))}function initEditor(){$("#moreBtn").on("click",function(){saveBookmark();var t=$("#editor");t.hasClass("all-tool")?t.removeClass("all-tool"):t.addClass("all-tool"),restoreBookmark()}),tinymce.init({inline:!0,theme:"leanote",valid_children:"+pre[div|#text|p|span|textarea|i|b|strong]",setup:function(t){t.on("keydown",function(t){var e=t.which?t.which:t.keyCode;return!Note.readOnly||(t.ctrlKey||t.metaKey)&&67==e?void LeaAce.removeCurToggleRaw():void t.preventDefault()}),t.on("cut",function(t){if($(t.target).hasClass("ace_text-input"))return void t.preventDefault()})},convert_urls:!1,relative_urls:!0,remove_script_host:!1,selector:"#editorContent",skin:"custom",language:LEA.locale,plugins:["autolink link leaui_image leaui_mindmap lists hr","paste","searchreplace leanote_nav leanote_code tabfocus","table textcolor"],toolbar1:"formatselect | forecolor backcolor | bold italic underline strikethrough | leaui_image leaui_mindmap | leanote_code leanote_inline_code | bullist numlist | alignleft aligncenter alignright alignjustify",toolbar2:"outdent indent blockquote | link unlink | table | hr removeformat | subscript superscript | searchreplace | pastetext | leanote_ace_pre | fontselect fontsizeselect",menubar:!1,toolbar_items_size:"small",statusbar:!1,url_converter:!1,font_formats:"Arial=arial,helvetica,sans-serif;Arial Black=arial black,avant garde;Times New Roman=times new roman,times;Courier New=courier new,courier;Tahoma=tahoma,arial,helvetica,sans-serif;Verdana=verdana,geneva;宋体=SimSun;新宋体=NSimSun;黑体=SimHei;微软雅黑=Microsoft YaHei",block_formats:"Header 1=h1;Header 2=h2;Header 3=h3;Header 4=h4;Paragraph=p",paste_data_images:!0}),window.onbeforeunload=function(t){LEA.isLogout||Note.curChangedSaveIt(!0,null,{refresh:!0})},$("body").on("keydown",function(t){var e=t.which?t.which:t.keyCode,o=t.ctrlKey||t.metaKey;if(o){if(83==e)return Note.curChangedSaveIt(!0,null,{ctrls:!0}),t.preventDefault(),!1;if(69==e)return Note.toggleWriteableAndReadOnly(),t.preventDefault(),!1}})}function scrollTo(t,e,o){var n=$("#editorContent"),i=n.find(e+":contains("+o+")");random++;var a=$('#leanoteNavContent [data-a="'+e+"-"+encodeURI(o)+'"]'),r=a.index(t);if(i.length>r){i=i.eq(r);var s=n.scrollTop()-n.offset().top+i.offset().top;return void n.animate({scrollTop:s},300)}}function hideMask(){$("#mainMask").html(""),$("#mainMask").hide(100)}function updateLeftIsMin(t){ajaxGet("/user/updateLeftIsMin",{leftIsMin:t})}function minLeft(t){$page.addClass("mini-left"),t&&updateLeftIsMin(!0)}function maxLeft(t){$page.removeClass("mini-left"),$("#noteAndEditor").css("left",UserInfo.NotebookWidth),$("#leftNotebook").width(UserInfo.NotebookWidth),t&&updateLeftIsMin(!1)}function getMaxDropdownHeight(t){var e=$(t).offset(),o=$(document).height()-e.top;o-=70,o<0&&(o=0);var n=$(t).find("ul").height();return n<o?n:o}function initLeanoteIfrPlugin(){self!=window.parent&&(LEA.topInfo={},window.addEventListener("message",function(t){console.log("child 收到消息: "),console.log(t.data),LEA.topInfo=t.data||{},LEA.topInfo.got=!0},!1),window.parent.postMessage&&window.parent.postMessage("leanote","*"))}function getNoteBySrc(t,e){ajaxGet("/note/getNoteAndContentBySrc",{src:t},function(t){if(t&&t.Ok){var o=t.Item;if(o){var n=o.NoteInfo,i=o.NoteContentInfo;for(var a in i)n[a]=i[a];e(n)}else e()}else e()})}function getTopInfoSrc(t){return LEA.topInfo.got?t(LEA.topInfo.src):(new Date).getTime()-_topInfoStart>2e3?t():void setTimeout(function(){getTopInfoSrc(t)},10)}function initPage(){initLeanoteIfrPlugin(),LEA.topInfo?getTopInfoSrc(function(t){t?getNoteBySrc(t,function(t){_initPage(t,!0)}):_initPage(!1,!0)}):_initPage()}function _initPage(t,e){if(t?(curNoteId=t.NoteId,curNotebookId=t.NotebookId,noteContentJson=t):e&&(curNoteId=null),Notebook.renderNotebooks(notebooks),Share.renderShareNotebooks(sharedUserInfos,shareNotebooks),curSharedNoteNotebookId)Share.firstRenderShareNote(curSharedUserId,curSharedNoteNotebookId,curNoteId);else{Note.setNoteCache(noteContentJson);var o=!1;if(e&&t&&notes){for(var n=0;n<notes.length;++n){var i=notes[n];if(i.NoteId===t.NoteId){o=!0,notes.splice(n,1),notes.unshift(t);break}}o||notes.unshift(t)}Note.renderNotes(notes),curNoteId&&(setTimeout(function(){Note.changeNoteForPjax(curNoteId,!0,curNotebookId),e&&(Note.toggleWriteable(),setTimeout(function(){Note.toggleWriteable()},100),setTimeout(function(){Note.toggleWriteable()},1e3))}),curNotebookId||Notebook.selectNotebook($(tt('#notebook [notebookId="?"]',Notebook.allNotebookId))))}if(latestNotes.length>0)for(var n=0;n<latestNotes.length;++n)Note.addNoteCache(latestNotes[n]);Tag.renderTagNav(tagsJson),initSlimScroll(),LeaAce.handleEvent(),e&&(Mobile.toEditor(),t||(Note.newNote(),Note.toggleWriteable(!0),setTimeout(function(){Note.toggleWriteable(!0)},100),setTimeout(function(){Note.toggleWriteable(!0)},1e3))),hideMask()}if(function(e){jQuery.fn.extend({slimScroll:function(o){var n={width:"auto",height:"250px",size:"7px",color:"#000",position:"right",distance:"1px",start:"top",opacity:.4,alwaysVisible:!1,disableFadeOut:!1,railVisible:!1,railColor:"#333",railOpacity:.2,railDraggable:!0,railClass:"slimScrollRail",barClass:"slimScrollBar",wrapperClass:"slimScrollDiv",allowPageScroll:!1,wheelStep:20,touchScrollStep:200,borderRadius:"7px",railBorderRadius:"7px"},i=e.extend(n,o);return this.each(function(){function n(t){if(d){var t=t||window.event,o=0;t.wheelDelta&&(o=-t.wheelDelta/120),t.detail&&(o=t.detail/3);var n=t.target||t.srcTarget||t.srcElement;e(n).closest("."+i.wrapperClass).is(I.parent())&&a(o,!0),t.preventDefault&&!k&&t.preventDefault(),k||(t.returnValue=!1)}}function a(t,e,o,n){k=!1;var a=t,r=I.outerHeight()-C.outerHeight();if(e&&(a=parseInt(C.css("top"))+t*parseInt(i.wheelStep)/100*C.outerHeight(),a=Math.min(Math.max(a,0),r),a=t>0?Math.ceil(a):Math.floor(a),C.css({top:a+"px"})),N=parseInt(C.css("top"))/(I.outerHeight()-C.outerHeight()),a=N*(I[0].scrollHeight-I.outerHeight()),o){a=t;var s=a/I[0].scrollHeight*I.outerHeight();s=Math.min(Math.max(s,0),r),C.css({top:s+"px"})}n||I.scrollTop(a),I.trigger("slimscrolling",~~a),l(),c()}function r(){window.addEventListener?(this.addEventListener("DOMMouseScroll",n,!1),this.addEventListener("mousewheel",n,!1),this.addEventListener("MozMousePixelScroll",n,!1)):document.attachEvent("onmousewheel",n)}function s(){p=Math.max(I.outerHeight()/I[0].scrollHeight*I.outerHeight(),b),C.css({height:p+"px"});var t=p==I.outerHeight()?"none":"block";C.css({display:t})}function l(){if(s(),clearTimeout(f),N==~~N){if(k=i.allowPageScroll,m!=N){var t=0==~~N?"top":"bottom";I.trigger("slimscroll",t)}}else k=!1;return m=N,p>=I.outerHeight()?void(k=!0):(C.stop(!0,!0).fadeIn("fast"),void(i.railVisible&&T.stop(!0,!0).fadeIn("fast")))}function c(){i.alwaysVisible||(f=setTimeout(function(){i.disableFadeOut&&d||h||u||(C.fadeOut("slow"),T.fadeOut("slow"))},1e3))}var d,h,u,f,g,p,N,m,v="<div></div>",b=30,k=!1,I=e(this);if(I.parent().hasClass(i.wrapperClass)){var y=I.scrollTop();if(C=I.parent().find("."+i.barClass),T=I.parent().find("."+i.railClass),s(),e.isPlainObject(o)){if("height"in o&&"auto"==o.height){I.parent().css("height","auto"),I.css("height","auto");var $=I.parent().parent().height();I.parent().css("height",$),I.css("height",$)}if("scrollTo"in o)y=parseInt(i.scrollTo);else if("scrollBy"in o)y+=parseInt(i.scrollBy);else if("destroy"in o)return C.remove(),T.remove(),void I.unwrap();a(y,!1,!0,o.onlyScrollBar)}}else{i.height="auto"==i.height?I.parent().height():i.height;var w=e(v).addClass(i.wrapperClass).css({position:"relative",overflow:"hidden",width:i.width,height:i.height});I.css({overflow:"hidden",width:i.width,height:i.height});var T=e(v).addClass(i.railClass).css({width:i.size,height:"100%",position:"absolute",top:0,display:i.alwaysVisible&&i.railVisible?"block":"none","border-radius":i.railBorderRadius,background:i.railColor,opacity:i.railOpacity,zIndex:90}),C=e(v).addClass(i.barClass).css({background:i.color,width:i.size,position:"absolute",top:0,opacity:i.opacity,display:i.alwaysVisible?"block":"none","border-radius":i.borderRadius,BorderRadius:i.borderRadius,MozBorderRadius:i.borderRadius,WebkitBorderRadius:i.borderRadius,zIndex:99}),S="right"==i.position?{right:i.distance}:{left:i.distance};T.css(S),C.css(S),I.wrap(w),I.parent().append(C),I.parent().append(T),i.railDraggable&&C.bind("mousedown",function(o){var n=e(document);return u=!0,t=parseFloat(C.css("top")),pageY=o.pageY,n.bind("mousemove.slimscroll",function(e){currTop=t+e.pageY-pageY,C.css("top",currTop),a(0,C.position().top,!1)}),n.bind("mouseup.slimscroll",function(t){u=!1,c(),n.unbind(".slimscroll")}),!1}).bind("selectstart.slimscroll",function(t){return t.stopPropagation(),t.preventDefault(),!1}),T.hover(function(){l()},function(){c()}),C.hover(function(){h=!0},function(){h=!1}),I.hover(function(){d=!0,l(),c()},function(){d=!1,c()}),I.bind("touchstart",function(t,e){t.originalEvent.touches.length&&(g=t.originalEvent.touches[0].pageY)}),I.bind("touchmove",function(t){if(k||t.originalEvent.preventDefault(),t.originalEvent.touches.length){var e=(g-t.originalEvent.touches[0].pageY)/i.touchScrollStep;a(e,!0),g=t.originalEvent.touches[0].pageY}}),s(),"bottom"===i.start?(C.css({top:I.outerHeight()-C.outerHeight()}),a(0,!0)):"top"!==i.start&&(a(e(i.start).position().top,null,!0),i.alwaysVisible||C.hide()),r()}}),this}}),jQuery.fn.extend({slimscroll:jQuery.fn.slimScroll})}(jQuery),LEA.cmroot=1,function(t){function e(){return!1}t.fn.contextmenu=function(o){function n(t){for(var e in p)i(e,!t.disable);for(var e=0;e<t.items.length;e++)i(t.items[e],t.disable);u=t.name}function i(e,o){if(e.indexOf(".")!==-1)for(var n=e.split("."),i=n[0],s=1;s<n.length;s++)i+="."+n[s],r(i,o);else t(p[e]).find(".b-m-arrow").css("background",o?"none":"");a(e,o)}function a(t,e){var o=s(t);o.disable=e,o.className=e?"b-m-idisable":"b-m-item"}function r(e,o){var n=s(e);1===n.nodeType?t(n).find(".c-text").css("text-decoration",o?"underline":""):n.underline=o}function s(t){return p[t]||(p[t]={})}function l(e,o){A(),d(),f=o,E.call(g[h],{left:e.pageX,top:e.pageY},0),!f||t(f).hasClass("item-active")||t(f).hasClass("curSelectedNode")||t(f).addClass("contextmenu-hover")}function c(e){var n=!o.onContextMenu||!t.isFunction(o.onContextMenu)||o.onContextMenu.call(this,e);return n&&(o.onShow&&t.isFunction(o.onShow)&&o.onShow.call(this,L),L.showMenu(e,this)),e&&e.preventDefault(),!1}function d(){Note.$itemList.find("li").removeClass("contextmenu-hover"),t(notebookList).find("a").removeClass("contextmenu-hover")}var h="contextmenu"+LEA.cmroot;LEA.cmroot++,o=t.extend({alias:h,width:150},o);var u=null,f=null,g={},p={},N={},m=[],v='<div class="b-m-$[type]" unselectable="on"><div class="clearfix cm-item"><div class="b-m-icon pull-left"><i class="fa $[faIcon]"></i>$[imgIcon]</div><div class="pull-left cm-text"><span class="c-text" unselectable="on">$[text]</span></div></div></div>';itemNoIconTpl="<div class='b-m-$[type]' unselectable=on><nobr unselectable=on><span align='absmiddle'></span><span class='c-text' unselectable=on>$[text]</span></nobr></div>";var b=t("<div/>").addClass("b-m-mpanel").attr("unselectable","on").css("display","none"),k=t("<div/>").addClass("b-m-item").attr("unselectable","on"),I=t("<div/>").addClass("b-m-split"),y=t("body"),$={},w=function(o){return g[o.alias]=this,this.gidx=o.alias,this.id=o.alias,o.disable&&(this.disable=o.disable,this.className="b-m-idisable"),t(this).width(o.width).on("click",function(){}).on("mousedown",e).appendTo(y),o=null,this},T=function(e){var o=this;o.title=e.text,o.idx=e.alias,o.gidx=e.gidx,o.data=e;var n="";return e.icon&&(n='<img src="'+e.icon+'"/>'),e.imgIcon=n,e.icon?o.innerHTML=v.replace(/\$\[([^\]]+)\]/g,function(){return e[arguments[1]]}):o.innerHTML=v.replace(/\$\[([^\]]+)\]/g,function(){return e[arguments[1]]}),(e.disable||p[e.alias]&&p[e.alias].disable)&&(o.disable=!0,o.className="b-m-idisable",t(o).find(".c-text").css("text-decoration","underline")),(e.underline||p[e.alias]&&p[e.alias].underline)&&t(o).find(".c-text").css("text-decoration","underline"),e.items&&(o.group=!0),e.action&&(N[e.alias]=e.action),p[e.alias]=o,o=e=null,this},C=function(o,n,i){for(var a=null,r=n.length,s=0;s<r;s++){var l=n[s];if("splitLine"==l.type)a=I.clone()[0];else{if(l.alias||(i?l.alias=i+"."+l.text:l.alias=l.text),l.gidx=o,"group"!=l.type||l.action){"group"==l.type?(w.apply(b.clone()[0],[l]),$[l.alias]=l.items,l.type="arrow",a=T.apply(k.clone()[0],[l])):(l.type="ibody",a=T.apply(k.clone()[0],[l]));var c=l;!function(e,o){t(o).on("click",function(o){return this.disable||(t.isFunction(N[this.idx])&&N[this.idx].call(this,f,e),A(),t(f).removeClass("contextmenu-hover")),!1})}(c,a)}else w.apply(b.clone()[0],[l]),$[l.alias]=l.items,l.type="arrow",a=T.apply(k.clone()[0],[l]);t(a).on("contextmenu",e).on("mouseenter",S).on("mouseleave",x)}g[o].appendChild(a),a=l=l.items=null}o=n=null},S=function(e){if(!this.group&&this.disable)return!1;if(this.disable&&this.idx.indexOf(".")===-1)return!1;if(A.call(g[this.gidx]),this.group){var o=t(this).offset(),n=t(this).outerWidth();E.apply(g[this.idx],[o,n,this])}return this.className="b-m-ifocus",!1},x=function(t){return this.group||this.disable||(this.className="b-m-item"),!1},A=function(){for(var t=null,e=m.length-1;e>=0&&m[e]!=this.gidx;e--)t=m.pop(),g[t].style.display="none",p[t]&&(p[t].disable?p[t].className="b-m-idisable":p[t].className="b-m-item")},E=function(e,o,n){var i=t(this);""==i.html()&&C(n.idx,$[n.idx],n.idx);var a=y.width(),r=document.documentElement.clientHeight-10;r=r<0?100:r;var s=t(this).outerWidth(),l=t(this).outerHeight()-10;l=l<0?100:l;var s=t(this).outerWidth();e.left=e.left+o+s>a?e.left-s<0?0:e.left-s:e.left+o,e.top=e.top+l>r?e.top-l+(o>0?25:0)<0?0:e.top-l+(o>0?25:0):e.top,t(this).css(e).show().css("max-height",r),m.push(this.gidx)},M=t("#"+o.alias),L=null;0==M.length?(L=w.apply(b.clone()[0],[o]),L.applyrule=n,L.showMenu=l,C(o.alias,o.items)):L=M[0];var B=t(o.parent).on("contextmenu",o.children,function(t){c.call(this,t)});t("body").on("click",function(t){d(),A()}),o.rule&&n(o.rule);var D={destroy:function(){B.off("contextmenu")},showMenu:function(t,e){c.call(e,t)}};return D}}(jQuery),"undefined"==typeof LEA)var LEA={};var Notebook={cache:{}},Note={cache:{}},Tag={},Notebook={},Share={},Mobile={},LeaAce={},Converter,MarkdownEditor,ScrollLink,MD;$.extend(LEA,{_eventCallbacks:{},_listen:function(t,e){var o=this._eventCallbacks[t]||(this._eventCallbacks[t]=[]);o.push(e)},on:function(t,e){for(var o=t.split(/\s+/),n=0;n<o.length;++n)this._listen(o[n],e);return this},off:function(t,e){var o,n,i,a,r=t.split(/\s+/);for(o=0;o<r.length;o++)if(i=this._eventCallbacks[r[o].toLowerCase()]){for(a=null,n=0;n<i.length;n++)i[n]==e&&(a=n);null!==a&&i.splice(a,1)}},trigger:function(t,e){var o=this._eventCallbacks[t]||[];if(0!==o.length)for(var n=0;n<o.length;n++)o[n].call(this,e)}});var tt=t;LEA.isM=!1,LEA.isMarkdownEditor=function(){return LEA.isM};var previewToken="<div style='display: none'>FORTOKEN</div>",clearIntervalForSetContent;LEA.editorStatus=!0,$(function(){$.pnotify&&($.pnotify.defaults.delay=1e3)}),Date.prototype.format=function(t){var e={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var o in e)new RegExp("("+o+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?e[o]:("00"+e[o]).substr((""+e[o]).length)));return t};var email2LoginAddress={"qq.com":"http://mail.qq.com","gmail.com":"http://mail.google.com","sina.com":"http://mail.sina.com.cn","163.com":"http://mail.163.com","126.com":"http://mail.126.com","yeah.net":"http://www.yeah.net/","sohu.com":"http://mail.sohu.com/","tom.com":"http://mail.tom.com/","sogou.com":"http://mail.sogou.com/","139.com":"http://mail.10086.cn/","hotmail.com":"http://www.hotmail.com","live.com":"http://login.live.com/","live.cn":"http://login.live.cn/","live.com.cn":"http://login.live.com.cn","189.com":"http://webmail16.189.cn/webmail/","yahoo.com.cn":"http://mail.cn.yahoo.com/","yahoo.cn":"http://mail.cn.yahoo.com/","eyou.com":"http://www.eyou.com/","21cn.com":"http://mail.21cn.com/","188.com":"http://www.188.com/","foxmail.com":"http://mail.foxmail.com"};LEA.bookmark=null,LEA.hasBookmark=!1;var vd={isInt:function(t){var e=/^0$|^[1-9]\d*$/;return result=e.test(t),result},isNumeric:function(t){return $.isNumeric(t)},isFloat:function(t){var e=/^0(\.\d+)?$|^[1-9]\d*(\.\d+)?$/;return result=e.test(t),result},isEmail:function(t){var e=/^([a-zA-Z0-9]+[_|\_|\.|\-]*)*[a-zA-Z0-9\-_]+@([a-zA-Z0-9\-]+[_|\_|\.|\-]?)*[a-zA-Z0-9\-]+\.[0-9a-zA-Z]{2,6}$/;return result=e.test(t),result},isBlank:function(t){return!$.trim(t)},has_special_chars:function(t){return/['"#$%&\^<>\?*]/.test(t)},init:function(form,rule_funcs){function is_required(t){var e=get_name(t),o=get_rules(t,e),n=o[0];return"required"==n.rule}function get_rules(target,name){return rules[name]||(rules[name]=eval("("+target.data("rules")+")")),rules[name]}function get_msg_target(t,e){if(!msg_targets[e]){var o=t.data("msg_target");if(o)msg_targets[e]=$(o);else{var n=$('<div class="help-block alert alert-warning" style="display: block;"></div>');t.parent().append(n),msg_targets[e]=n}}return msg_targets[e]}function hide_msg(t,e){var o=get_msg_target(t,e);o.hasClass("alert-success")||o.hide()}function show_msg(t,e,o,n){var i=get_msg_target(t,e);i.html(getMsg(o,n)).removeClass("hide alert-success").addClass("alert-danger").show()}function pre_fix(t){var e=t.data("pre_fix");if(e)switch(e){case"int":int_fix(t);break;case"price":price_fix(t);break;case"decimal":decimal_fix(t)}}function apply_rules(t,e){var o=get_rules(t,e);if(pre_fix(t),!o)return!0;for(var n=0;n<o.length;++n){var i=o[n],a=i.rule,r=i.msg,s=i.msgData;if(!rule_funcs[a](t,i))return show_msg(t,e,r,s),!1}hide_msg(t,e);var l=t.data("post_rule");return l&&setTimeout(function(){var t=$(l);apply_rules(t,get_name(t))},0),!0}function focus_func(t){var e=$(t.target),o=get_name(e);hide_msg(e,o),pre_fix(e)}function unfocus_func(t){var e=$(t.target),o=get_name(e);apply_rules(e,o)}function get_name(t){return t.data("u_name")||t.attr("name")||t.attr("id")}var get_val=function(t){if(t.is(":checkbox")){var e=t.attr("name"),o=$('input[name="'+e+'"]:checked').length;return o}if(!t.is(":radio"))return t.val()},default_rule_funcs={required:function(t){return get_val(t)},min:function(t,e){var o=get_val(t);return""===o&&!is_required(t)||!(o<e.data)},minLength:function(t,e){var o=get_val(t);return""===o&&!is_required(t)||!(o.length<e.data)},email:function(t,e){var o=get_val(t);return""===o&&!is_required(t)||vd.isEmail(o)},noSpecialChars:function(t){var e=get_val(t);return!e||!/[^0-9a-zzA-Z_\-]/.test(e)},password:function(t,e){var o=get_val(t);return""===o&&!is_required(t)||o.length>=6},equalTo:function(t,e){var o=get_val(t);return""===o&&!is_required(t)||$(e.data).val()==o}};rule_funcs=rule_funcs||{},rule_funcs=$.extend(default_rule_funcs,rule_funcs);var rules={},msg_targets={},$allElems=$(form).find("[data-rules]"),$form=$(form);$form.on({keyup:function(t){13!=t.keyCode&&focus_func(t)},blur:unfocus_func},'input[type="text"], input[type="password"]'),$form.on({change:function(t){$(this).val()?focus_func(t):unfocus_func(t)}},"select"),$form.on({change:function(t){unfocus_func(t)}},'input[type="checkbox"]'),this.valid=function(){for(var t=$allElems,e=!0,o=0;o<t.length;++o){var n=t.eq(o),i=get_name(n);if(!apply_rules(n,i))return e=!1,n.focus(),!1}return e},this.validElement=function(t){for(var t=$(t),e=!0,o=0;o<t.length;++o){var n=t.eq(o),i=get_name(n);apply_rules(n,i)||(e=!1)}return e}}},trimTitle=function(t){return t&&"string"==typeof t?t.replace(/</g,"&lt;").replace(/>/g,"&gt;"):""};if("undefined"==typeof jQuery)throw new Error("Bootstrap's JavaScript requires jQuery");!function(t){"use strict";var e=jQuery.fn.jquery.split(" ")[0].split(".");if(e[0]<2&&e[1]<9||1==e[0]&&9==e[1]&&e[2]<1||3<e[0])throw new Error("Bootstrap's JavaScript requires jQuery version 1.9.1 or higher, but lower than version 4");
}(),function(t){"use strict";t.fn.emulateTransitionEnd=function(e){var o=!1,n=this;return t(this).one("bsTransitionEnd",function(){o=!0}),setTimeout(function(){o||t(n).trigger(t.support.transition.end)},e),this},t(function(){t.support.transition=function(){var t=document.createElement("bootstrap"),e={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var o in e)if(void 0!==t.style[o])return{end:e[o]};return!1}(),t.support.transition&&(t.event.special.bsTransitionEnd={bindType:t.support.transition.end,delegateType:t.support.transition.end,handle:function(e){if(t(e.target).is(this))return e.handleObj.handler.apply(this,arguments)}})})}(jQuery),function(t){"use strict";var e='[data-dismiss="alert"]',o=function(o){t(o).on("click",e,this.close)};o.VERSION="3.4.1",o.TRANSITION_DURATION=150,o.prototype.close=function(e){function n(){r.detach().trigger("closed.bs.alert").remove()}var i=t(this),a=i.attr("data-target");a||(a=(a=i.attr("href"))&&a.replace(/.*(?=#[^\s]*$)/,"")),a="#"===a?[]:a;var r=t(document).find(a);e&&e.preventDefault(),r.length||(r=i.closest(".alert")),r.trigger(e=t.Event("close.bs.alert")),e.isDefaultPrevented()||(r.removeClass("in"),t.support.transition&&r.hasClass("fade")?r.one("bsTransitionEnd",n).emulateTransitionEnd(o.TRANSITION_DURATION):n())};var n=t.fn.alert;t.fn.alert=function(e){return this.each(function(){var n=t(this),i=n.data("bs.alert");i||n.data("bs.alert",i=new o(this)),"string"==typeof e&&i[e].call(n)})},t.fn.alert.Constructor=o,t.fn.alert.noConflict=function(){return t.fn.alert=n,this},t(document).on("click.bs.alert.data-api",e,o.prototype.close)}(jQuery),function(t){"use strict";function e(e){return this.each(function(){var n=t(this),i=n.data("bs.button"),a="object"==typeof e&&e;i||n.data("bs.button",i=new o(this,a)),"toggle"==e?i.toggle():e&&i.setState(e)})}var o=function(e,n){this.$element=t(e),this.options=t.extend({},o.DEFAULTS,n),this.isLoading=!1};o.VERSION="3.4.1",o.DEFAULTS={loadingText:"loading..."},o.prototype.setState=function(e){var o="disabled",n=this.$element,i=n.is("input")?"val":"html",a=n.data();e+="Text",null==a.resetText&&n.data("resetText",n[i]()),setTimeout(t.proxy(function(){n[i](null==a[e]?this.options[e]:a[e]),"loadingText"==e?(this.isLoading=!0,n.addClass(o).attr(o,o).prop(o,!0)):this.isLoading&&(this.isLoading=!1,n.removeClass(o).removeAttr(o).prop(o,!1))},this),0)},o.prototype.toggle=function(){var t=!0,e=this.$element.closest('[data-toggle="buttons"]');if(e.length){var o=this.$element.find("input");"radio"==o.prop("type")?(o.prop("checked")&&(t=!1),e.find(".active").removeClass("active"),this.$element.addClass("active")):"checkbox"==o.prop("type")&&(o.prop("checked")!==this.$element.hasClass("active")&&(t=!1),this.$element.toggleClass("active")),o.prop("checked",this.$element.hasClass("active")),t&&o.trigger("change")}else this.$element.attr("aria-pressed",!this.$element.hasClass("active")),this.$element.toggleClass("active")};var n=t.fn.button;t.fn.button=e,t.fn.button.Constructor=o,t.fn.button.noConflict=function(){return t.fn.button=n,this},t(document).on("click.bs.button.data-api",'[data-toggle^="button"]',function(o){var n=t(o.target).closest(".btn");e.call(n,"toggle"),t(o.target).is('input[type="radio"], input[type="checkbox"]')||(o.preventDefault(),n.is("input,button")?n.trigger("focus"):n.find("input:visible,button:visible").first().trigger("focus"))}).on("focus.bs.button.data-api blur.bs.button.data-api",'[data-toggle^="button"]',function(e){t(e.target).closest(".btn").toggleClass("focus",/^focus(in)?$/.test(e.type))})}(jQuery),function(t){"use strict";function e(e){return this.each(function(){var n=t(this),i=n.data("bs.carousel"),a=t.extend({},o.DEFAULTS,n.data(),"object"==typeof e&&e),r="string"==typeof e?e:a.slide;i||n.data("bs.carousel",i=new o(this,a)),"number"==typeof e?i.to(e):r?i[r]():a.interval&&i.pause().cycle()})}var o=function(e,o){this.$element=t(e),this.$indicators=this.$element.find(".carousel-indicators"),this.options=o,this.paused=null,this.sliding=null,this.interval=null,this.$active=null,this.$items=null,this.options.keyboard&&this.$element.on("keydown.bs.carousel",t.proxy(this.keydown,this)),"hover"==this.options.pause&&!("ontouchstart"in document.documentElement)&&this.$element.on("mouseenter.bs.carousel",t.proxy(this.pause,this)).on("mouseleave.bs.carousel",t.proxy(this.cycle,this))};o.VERSION="3.4.1",o.TRANSITION_DURATION=600,o.DEFAULTS={interval:5e3,pause:"hover",wrap:!0,keyboard:!0},o.prototype.keydown=function(t){if(!/input|textarea/i.test(t.target.tagName)){switch(t.which){case 37:this.prev();break;case 39:this.next();break;default:return}t.preventDefault()}},o.prototype.cycle=function(e){return e||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(t.proxy(this.next,this),this.options.interval)),this},o.prototype.getItemIndex=function(t){return this.$items=t.parent().children(".item"),this.$items.index(t||this.$active)},o.prototype.getItemForDirection=function(t,e){var o=this.getItemIndex(e);if(("prev"==t&&0===o||"next"==t&&o==this.$items.length-1)&&!this.options.wrap)return e;var n=(o+("prev"==t?-1:1))%this.$items.length;return this.$items.eq(n)},o.prototype.to=function(t){var e=this,o=this.getItemIndex(this.$active=this.$element.find(".item.active"));if(!(t>this.$items.length-1||t<0))return this.sliding?this.$element.one("slid.bs.carousel",function(){e.to(t)}):o==t?this.pause().cycle():this.slide(o<t?"next":"prev",this.$items.eq(t))},o.prototype.pause=function(e){return e||(this.paused=!0),this.$element.find(".next, .prev").length&&t.support.transition&&(this.$element.trigger(t.support.transition.end),this.cycle(!0)),this.interval=clearInterval(this.interval),this},o.prototype.next=function(){if(!this.sliding)return this.slide("next")},o.prototype.prev=function(){if(!this.sliding)return this.slide("prev")},o.prototype.slide=function(e,n){var i=this.$element.find(".item.active"),a=n||this.getItemForDirection(e,i),r=this.interval,s="next"==e?"left":"right",l=this;if(a.hasClass("active"))return this.sliding=!1;var c=a[0],d=t.Event("slide.bs.carousel",{relatedTarget:c,direction:s});if(this.$element.trigger(d),!d.isDefaultPrevented()){if(this.sliding=!0,r&&this.pause(),this.$indicators.length){this.$indicators.find(".active").removeClass("active");var h=t(this.$indicators.children()[this.getItemIndex(a)]);h&&h.addClass("active")}var u=t.Event("slid.bs.carousel",{relatedTarget:c,direction:s});return t.support.transition&&this.$element.hasClass("slide")?(a.addClass(e),"object"==typeof a&&a.length&&a[0].offsetWidth,i.addClass(s),a.addClass(s),i.one("bsTransitionEnd",function(){a.removeClass([e,s].join(" ")).addClass("active"),i.removeClass(["active",s].join(" ")),l.sliding=!1,setTimeout(function(){l.$element.trigger(u)},0)}).emulateTransitionEnd(o.TRANSITION_DURATION)):(i.removeClass("active"),a.addClass("active"),this.sliding=!1,this.$element.trigger(u)),r&&this.cycle(),this}};var n=t.fn.carousel;t.fn.carousel=e,t.fn.carousel.Constructor=o,t.fn.carousel.noConflict=function(){return t.fn.carousel=n,this};var i=function(o){var n=t(this),i=n.attr("href");i&&(i=i.replace(/.*(?=#[^\s]+$)/,""));var a=n.attr("data-target")||i,r=t(document).find(a);if(r.hasClass("carousel")){var s=t.extend({},r.data(),n.data()),l=n.attr("data-slide-to");l&&(s.interval=!1),e.call(r,s),l&&r.data("bs.carousel").to(l),o.preventDefault()}};t(document).on("click.bs.carousel.data-api","[data-slide]",i).on("click.bs.carousel.data-api","[data-slide-to]",i),t(window).on("load",function(){t('[data-ride="carousel"]').each(function(){var o=t(this);e.call(o,o.data())})})}(jQuery),function(t){"use strict";function e(e){var o,n=e.attr("data-target")||(o=e.attr("href"))&&o.replace(/.*(?=#[^\s]+$)/,"");return t(document).find(n)}function o(e){return this.each(function(){var o=t(this),i=o.data("bs.collapse"),a=t.extend({},n.DEFAULTS,o.data(),"object"==typeof e&&e);!i&&a.toggle&&/show|hide/.test(e)&&(a.toggle=!1),i||o.data("bs.collapse",i=new n(this,a)),"string"==typeof e&&i[e]()})}var n=function(e,o){this.$element=t(e),this.options=t.extend({},n.DEFAULTS,o),this.$trigger=t('[data-toggle="collapse"][href="#'+e.id+'"],[data-toggle="collapse"][data-target="#'+e.id+'"]'),this.transitioning=null,this.options.parent?this.$parent=this.getParent():this.addAriaAndCollapsedClass(this.$element,this.$trigger),this.options.toggle&&this.toggle()};n.VERSION="3.4.1",n.TRANSITION_DURATION=350,n.DEFAULTS={toggle:!0},n.prototype.dimension=function(){return this.$element.hasClass("width")?"width":"height"},n.prototype.show=function(){if(!this.transitioning&&!this.$element.hasClass("in")){var e,i=this.$parent&&this.$parent.children(".panel").children(".in, .collapsing");if(!(i&&i.length&&(e=i.data("bs.collapse"))&&e.transitioning)){var a=t.Event("show.bs.collapse");if(this.$element.trigger(a),!a.isDefaultPrevented()){i&&i.length&&(o.call(i,"hide"),e||i.data("bs.collapse",null));var r=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[r](0).attr("aria-expanded",!0),this.$trigger.removeClass("collapsed").attr("aria-expanded",!0),this.transitioning=1;var s=function(){this.$element.removeClass("collapsing").addClass("collapse in")[r](""),this.transitioning=0,this.$element.trigger("shown.bs.collapse")};if(!t.support.transition)return s.call(this);var l=t.camelCase(["scroll",r].join("-"));this.$element.one("bsTransitionEnd",t.proxy(s,this)).emulateTransitionEnd(n.TRANSITION_DURATION)[r](this.$element[0][l])}}}},n.prototype.hide=function(){if(!this.transitioning&&this.$element.hasClass("in")){var e=t.Event("hide.bs.collapse");if(this.$element.trigger(e),!e.isDefaultPrevented()){var o=this.dimension();this.$element[o](this.$element[o]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse in").attr("aria-expanded",!1),this.$trigger.addClass("collapsed").attr("aria-expanded",!1),this.transitioning=1;var i=function(){this.transitioning=0,this.$element.removeClass("collapsing").addClass("collapse").trigger("hidden.bs.collapse")};if(!t.support.transition)return i.call(this);this.$element[o](0).one("bsTransitionEnd",t.proxy(i,this)).emulateTransitionEnd(n.TRANSITION_DURATION)}}},n.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()},n.prototype.getParent=function(){return t(document).find(this.options.parent).find('[data-toggle="collapse"][data-parent="'+this.options.parent+'"]').each(t.proxy(function(o,n){var i=t(n);this.addAriaAndCollapsedClass(e(i),i)},this)).end()},n.prototype.addAriaAndCollapsedClass=function(t,e){var o=t.hasClass("in");t.attr("aria-expanded",o),e.toggleClass("collapsed",!o).attr("aria-expanded",o)};var i=t.fn.collapse;t.fn.collapse=o,t.fn.collapse.Constructor=n,t.fn.collapse.noConflict=function(){return t.fn.collapse=i,this},t(document).on("click.bs.collapse.data-api",'[data-toggle="collapse"]',function(n){var i=t(this);i.attr("data-target")||n.preventDefault();var a=e(i),r=a.data("bs.collapse")?"toggle":i.data();o.call(a,r)})}(jQuery),function(t){"use strict";function e(e){var o=e.attr("data-target");o||(o=(o=e.attr("href"))&&/#[A-Za-z]/.test(o)&&o.replace(/.*(?=#[^\s]*$)/,""));var n="#"!==o?t(document).find(o):null;return n&&n.length?n:e.parent()}function o(o){o&&3===o.which||(t(".dropdown-backdrop").remove(),t(n).each(function(){var n=t(this),i=e(n),a={relatedTarget:this};i.hasClass("open")&&(o&&"click"==o.type&&/input|textarea/i.test(o.target.tagName)&&t.contains(i[0],o.target)||(i.trigger(o=t.Event("hide.bs.dropdown",a)),o.isDefaultPrevented()||(n.attr("aria-expanded","false"),i.removeClass("open").trigger(t.Event("hidden.bs.dropdown",a)))))}))}var n='[data-toggle="dropdown"]',i=function(e){t(e).on("click.bs.dropdown",this.toggle)};i.VERSION="3.4.1",i.prototype.toggle=function(n){var i=t(this);if(!i.is(".disabled, :disabled")){var a=e(i),r=a.hasClass("open");if(o(),!r){"ontouchstart"in document.documentElement&&!a.closest(".navbar-nav").length&&t(document.createElement("div")).addClass("dropdown-backdrop").insertAfter(t(this)).on("click",o);var s={relatedTarget:this};if(a.trigger(n=t.Event("show.bs.dropdown",s)),n.isDefaultPrevented())return;i.trigger("focus").attr("aria-expanded","true"),a.toggleClass("open").trigger(t.Event("shown.bs.dropdown",s))}return!1}},i.prototype.keydown=function(o){if(/(38|40|27|32)/.test(o.which)&&!/input|textarea/i.test(o.target.tagName)){var i=t(this);if(o.preventDefault(),o.stopPropagation(),!i.is(".disabled, :disabled")){var a=e(i),r=a.hasClass("open");if(!r&&27!=o.which||r&&27==o.which)return 27==o.which&&a.find(n).trigger("focus"),i.trigger("click");var s=a.find(".dropdown-menu li:not(.disabled):visible a");if(s.length){var l=s.index(o.target);38==o.which&&0<l&&l--,40==o.which&&l<s.length-1&&l++,~l||(l=0),s.eq(l).trigger("focus")}}}};var a=t.fn.dropdown;t.fn.dropdown=function(e){return this.each(function(){var o=t(this),n=o.data("bs.dropdown");n||o.data("bs.dropdown",n=new i(this)),"string"==typeof e&&n[e].call(o)})},t.fn.dropdown.Constructor=i,t.fn.dropdown.noConflict=function(){return t.fn.dropdown=a,this},t(document).on("click.bs.dropdown.data-api",o).on("click.bs.dropdown.data-api",".dropdown form",function(t){t.stopPropagation()}).on("click.bs.dropdown.data-api",n,i.prototype.toggle).on("keydown.bs.dropdown.data-api",n,i.prototype.keydown).on("keydown.bs.dropdown.data-api",".dropdown-menu",i.prototype.keydown)}(jQuery),function(t){"use strict";function e(e,n){return this.each(function(){var i=t(this),a=i.data("bs.modal"),r=t.extend({},o.DEFAULTS,i.data(),"object"==typeof e&&e);r.remote&&(a=null),a||i.data("bs.modal",a=new o(this,r)),"string"==typeof e?a[e](n):r.show&&a.show(n),r.postShow&&(r.postShow(),i.find(".alert").hide())})}var o=function(e,o){this.options=o,this.$body=t(document.body),this.$element=t(e),this.$dialog=this.$element.find(".modal-dialog"),this.$backdrop=null,this.isShown=null,this.originalBodyPad=null,this.scrollbarWidth=0,this.ignoreBackdropClick=!1,this.fixedContent=".navbar-fixed-top, .navbar-fixed-bottom",this.options.remote&&this.$element.find(".modal-content").load(this.options.remote,t.proxy(function(){this.$element.trigger("loaded.bs.modal")},this))};o.VERSION="3.4.1",o.TRANSITION_DURATION=300,o.BACKDROP_TRANSITION_DURATION=150,o.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},o.prototype.toggle=function(t){return this.isShown?this.hide():this.show(t)},o.prototype.show=function(e){var n=this,i=t.Event("show.bs.modal",{relatedTarget:e});this.$element.trigger(i),this.isShown||i.isDefaultPrevented()||(this.isShown=!0,this.checkScrollbar(),this.setScrollbar(),this.$body.addClass("modal-open"),this.escape(),this.resize(),this.$element.on("click.dismiss.bs.modal",'[data-dismiss="modal"]',t.proxy(this.hide,this)),this.$dialog.on("mousedown.dismiss.bs.modal",function(){n.$element.one("mouseup.dismiss.bs.modal",function(e){t(e.target).is(n.$element)&&(n.ignoreBackdropClick=!0)})}),this.backdrop(function(){var i=t.support.transition&&n.$element.hasClass("fade");n.$element.parent().length||n.$element.appendTo(n.$body),n.$element.show().scrollTop(0),n.adjustDialog(),i&&n.$element[0].offsetWidth,n.$element.addClass("in"),n.enforceFocus();var a=t.Event("shown.bs.modal",{relatedTarget:e});i?n.$dialog.one("bsTransitionEnd",function(){n.$element.trigger("focus").trigger(a)}).emulateTransitionEnd(o.TRANSITION_DURATION):n.$element.trigger("focus").trigger(a)}))},o.prototype.hide=function(e){e&&e.preventDefault(),e=t.Event("hide.bs.modal"),this.$element.trigger(e),this.isShown&&!e.isDefaultPrevented()&&(this.isShown=!1,this.escape(),this.resize(),t(document).off("focusin.bs.modal"),this.$element.removeClass("in").off("click.dismiss.bs.modal").off("mouseup.dismiss.bs.modal"),this.$dialog.off("mousedown.dismiss.bs.modal"),t.support.transition&&this.$element.hasClass("fade")?this.$element.one("bsTransitionEnd",t.proxy(this.hideModal,this)).emulateTransitionEnd(o.TRANSITION_DURATION):this.hideModal())},o.prototype.enforceFocus=function(){t(document).off("focusin.bs.modal").on("focusin.bs.modal",t.proxy(function(t){document===t.target||this.$element[0]===t.target||this.$element.has(t.target).length||this.$element.trigger("focus")},this))},o.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keydown.dismiss.bs.modal",t.proxy(function(t){27==t.which&&this.hide()},this)):this.isShown||this.$element.off("keydown.dismiss.bs.modal")},o.prototype.resize=function(){this.isShown?t(window).on("resize.bs.modal",t.proxy(this.handleUpdate,this)):t(window).off("resize.bs.modal")},o.prototype.hideModal=function(){var t=this;this.$element.hide(),this.backdrop(function(){t.$body.removeClass("modal-open"),t.resetAdjustments(),t.resetScrollbar(),t.$element.trigger("hidden.bs.modal")})},o.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},o.prototype.backdrop=function(e){var n=this,i=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var a=t.support.transition&&i;if(this.$backdrop=t(document.createElement("div")).addClass("modal-backdrop "+i).appendTo(this.$body),this.$element.on("click.dismiss.bs.modal",t.proxy(function(t){this.ignoreBackdropClick?this.ignoreBackdropClick=!1:t.target===t.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus():this.hide())},this)),a&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!e)return;a?this.$backdrop.one("bsTransitionEnd",e).emulateTransitionEnd(o.BACKDROP_TRANSITION_DURATION):e()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");var r=function(){n.removeBackdrop(),e&&e()};t.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one("bsTransitionEnd",r).emulateTransitionEnd(o.BACKDROP_TRANSITION_DURATION):r()}else e&&e()},o.prototype.handleUpdate=function(){this.adjustDialog()},o.prototype.adjustDialog=function(){var t=this.$element[0].scrollHeight>document.documentElement.clientHeight;this.$element.css({paddingLeft:!this.bodyIsOverflowing&&t?this.scrollbarWidth:"",paddingRight:this.bodyIsOverflowing&&!t?this.scrollbarWidth:""})},o.prototype.resetAdjustments=function(){this.$element.css({paddingLeft:"",paddingRight:""})},o.prototype.checkScrollbar=function(){var t=window.innerWidth;if(!t){var e=document.documentElement.getBoundingClientRect();t=e.right-Math.abs(e.left)}this.bodyIsOverflowing=document.body.clientWidth<t,this.scrollbarWidth=this.measureScrollbar()},o.prototype.setScrollbar=function(){var e=parseInt(this.$body.css("padding-right")||0,10);this.originalBodyPad=document.body.style.paddingRight||"";var o=this.scrollbarWidth;this.bodyIsOverflowing&&(this.$body.css("padding-right",e+o),t(this.fixedContent).each(function(e,n){var i=n.style.paddingRight,a=t(n).css("padding-right");t(n).data("padding-right",i).css("padding-right",parseFloat(a)+o+"px")}))},o.prototype.resetScrollbar=function(){this.$body.css("padding-right",this.originalBodyPad),t(this.fixedContent).each(function(e,o){var n=t(o).data("padding-right");t(o).removeData("padding-right"),o.style.paddingRight=n||""})},o.prototype.measureScrollbar=function(){var t=document.createElement("div");t.className="modal-scrollbar-measure",this.$body.append(t);var e=t.offsetWidth-t.clientWidth;return this.$body[0].removeChild(t),e};var n=t.fn.modal;t.fn.modal=e,t.fn.modal.Constructor=o,t.fn.modal.noConflict=function(){return t.fn.modal=n,this},t(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(o){var n=t(this),i=n.attr("href"),a=n.attr("data-target")||i&&i.replace(/.*(?=#[^\s]+$)/,""),r=t(document).find(a),s=r.data("bs.modal")?"toggle":t.extend({remote:!/#/.test(i)&&i},r.data(),n.data());n.is("a")&&o.preventDefault(),r.one("show.bs.modal",function(t){t.isDefaultPrevented()||r.one("hidden.bs.modal",function(){n.is(":visible")&&n.trigger("focus")})}),e.call(r,s,this)})}(jQuery),function(t){"use strict";function e(e,o){var n=e.nodeName.toLowerCase();if(-1!==t.inArray(n,o))return-1===t.inArray(n,i)||Boolean(e.nodeValue.match(r)||e.nodeValue.match(s));for(var a=t(o).filter(function(t,e){return e instanceof RegExp}),l=0,c=a.length;l<c;l++)if(n.match(a[l]))return!0;return!1}function o(o,n,i){if(0===o.length)return o;if(i&&"function"==typeof i)return i(o);if(!document.implementation||!document.implementation.createHTMLDocument)return o;var a=document.implementation.createHTMLDocument("sanitization");a.body.innerHTML=o;for(var r=t.map(n,function(t,e){return e}),s=t(a.body).find("*"),l=0,c=s.length;l<c;l++){var d=s[l],h=d.nodeName.toLowerCase();if(-1!==t.inArray(h,r))for(var u=t.map(d.attributes,function(t){return t}),f=[].concat(n["*"]||[],n[h]||[]),g=0,p=u.length;g<p;g++)e(u[g],f)||d.removeAttribute(u[g].nodeName);else d.parentNode.removeChild(d)}return a.body.innerHTML}var n=["sanitize","whiteList","sanitizeFn"],i=["background","cite","href","itemtype","longdesc","poster","src","xlink:href"],a={"*":["class","dir","id","lang","role",/^aria-[\w-]*$/i],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],div:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},r=/^(?:(?:https?|mailto|ftp|tel|file):|[^&:\/?#]*(?:[\/?#]|$))/gi,s=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i,l=function(t,e){this.type=null,this.options=null,this.enabled=null,this.timeout=null,this.hoverState=null,this.$element=null,this.inState=null,this.init("tooltip",t,e)};l.VERSION="3.4.1",l.TRANSITION_DURATION=150,l.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1,viewport:{selector:"body",padding:0},sanitize:!0,sanitizeFn:null,whiteList:a},l.prototype.init=function(e,o,n){if(this.enabled=!0,this.type=e,this.$element=t(o),this.options=this.getOptions(n),this.$viewport=this.options.viewport&&t(document).find(t.isFunction(this.options.viewport)?this.options.viewport.call(this,this.$element):this.options.viewport.selector||this.options.viewport),this.inState={click:!1,hover:!1,focus:!1},this.$element[0]instanceof document.constructor&&!this.options.selector)throw new Error("`selector` option must be specified when initializing "+this.type+" on the window.document object!");for(var i=this.options.trigger.split(" "),a=i.length;a--;){var r=i[a];if("click"==r)this.$element.on("click."+this.type,this.options.selector,t.proxy(this.toggle,this));else if("manual"!=r){var s="hover"==r?"mouseenter":"focusin",l="hover"==r?"mouseleave":"focusout";this.$element.on(s+"."+this.type,this.options.selector,t.proxy(this.enter,this)),this.$element.on(l+"."+this.type,this.options.selector,t.proxy(this.leave,this))}}this.options.selector?this._options=t.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},l.prototype.getDefaults=function(){return l.DEFAULTS},l.prototype.getOptions=function(e){var i=this.$element.data();for(var a in i)i.hasOwnProperty(a)&&-1!==t.inArray(a,n)&&delete i[a];return(e=t.extend({},this.getDefaults(),i,e)).delay&&"number"==typeof e.delay&&(e.delay={show:e.delay,hide:e.delay}),e.sanitize&&(e.template=o(e.template,e.whiteList,e.sanitizeFn)),e},l.prototype.getDelegateOptions=function(){var e={},o=this.getDefaults();return this._options&&t.each(this._options,function(t,n){o[t]!=n&&(e[t]=n)}),e},l.prototype.enter=function(e){var o=e instanceof this.constructor?e:t(e.currentTarget).data("bs."+this.type);if(o||(o=new this.constructor(e.currentTarget,this.getDelegateOptions()),t(e.currentTarget).data("bs."+this.type,o)),e instanceof t.Event&&(o.inState["focusin"==e.type?"focus":"hover"]=!0),o.tip().hasClass("in")||"in"==o.hoverState)o.hoverState="in";else{if(clearTimeout(o.timeout),o.hoverState="in",!o.options.delay||!o.options.delay.show)return o.show();o.timeout=setTimeout(function(){"in"==o.hoverState&&o.show()},o.options.delay.show)}},l.prototype.isInStateTrue=function(){for(var t in this.inState)if(this.inState[t])return!0;return!1},l.prototype.leave=function(e){var o=e instanceof this.constructor?e:t(e.currentTarget).data("bs."+this.type);if(o||(o=new this.constructor(e.currentTarget,this.getDelegateOptions()),t(e.currentTarget).data("bs."+this.type,o)),e instanceof t.Event&&(o.inState["focusout"==e.type?"focus":"hover"]=!1),!o.isInStateTrue()){if(clearTimeout(o.timeout),o.hoverState="out",!o.options.delay||!o.options.delay.hide)return o.hide();o.timeout=setTimeout(function(){"out"==o.hoverState&&o.hide()},o.options.delay.hide)}},l.prototype.show=function(){var e=t.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){this.$element.trigger(e);var o=t.contains(this.$element[0].ownerDocument.documentElement,this.$element[0]);if(e.isDefaultPrevented()||!o)return;var n=this,i=this.tip(),a=this.getUID(this.type);this.setContent(),i.attr("id",a),this.$element.attr("aria-describedby",a),this.options.animation&&i.addClass("fade");var r="function"==typeof this.options.placement?this.options.placement.call(this,i[0],this.$element[0]):this.options.placement,s=/\s?auto?\s?/i,c=s.test(r);c&&(r=r.replace(s,"")||"top"),i.detach().css({top:0,left:0,display:"block"}).addClass(r).data("bs."+this.type,this),this.options.container?i.appendTo(t(document).find(this.options.container)):i.insertAfter(this.$element),this.$element.trigger("inserted.bs."+this.type);var d=this.getPosition(),h=i[0].offsetWidth,u=i[0].offsetHeight;if(c){var f=r,g=this.getPosition(this.$viewport);r="bottom"==r&&d.bottom+u>g.bottom?"top":"top"==r&&d.top-u<g.top?"bottom":"right"==r&&d.right+h>g.width?"left":"left"==r&&d.left-h<g.left?"right":r,i.removeClass(f).addClass(r)}var p=this.getCalculatedOffset(r,d,h,u);this.applyPlacement(p,r);var N=function(){var t=n.hoverState;n.$element.trigger("shown.bs."+n.type),n.hoverState=null,"out"==t&&n.leave(n)};t.support.transition&&this.$tip.hasClass("fade")?i.one("bsTransitionEnd",N).emulateTransitionEnd(l.TRANSITION_DURATION):N()}},l.prototype.applyPlacement=function(e,o){var n=this.tip(),i=n[0].offsetWidth,a=n[0].offsetHeight,r=parseInt(n.css("margin-top"),10),s=parseInt(n.css("margin-left"),10);isNaN(r)&&(r=0),isNaN(s)&&(s=0),e.top+=r,e.left+=s,t.offset.setOffset(n[0],t.extend({using:function(t){n.css({top:Math.round(t.top),left:Math.round(t.left)})}},e),0),n.addClass("in");var l=n[0].offsetWidth,c=n[0].offsetHeight;"top"==o&&c!=a&&(e.top=e.top+a-c);var d=this.getViewportAdjustedDelta(o,e,l,c);d.left?e.left+=d.left:e.top+=d.top;var h=/top|bottom/.test(o),u=h?2*d.left-i+l:2*d.top-a+c,f=h?"offsetWidth":"offsetHeight";n.offset(e),this.replaceArrow(u,n[0][f],h)},l.prototype.replaceArrow=function(t,e,o){this.arrow().css(o?"left":"top",50*(1-t/e)+"%").css(o?"top":"left","")},l.prototype.setContent=function(){var t=this.tip(),e=this.getTitle();this.options.html?(this.options.sanitize&&(e=o(e,this.options.whiteList,this.options.sanitizeFn)),t.find(".tooltip-inner").html(e)):t.find(".tooltip-inner").text(e),t.removeClass("fade in top bottom left right")},l.prototype.hide=function(e){function o(){"in"!=n.hoverState&&i.detach(),n.$element&&n.$element.removeAttr("aria-describedby").trigger("hidden.bs."+n.type),e&&e()}var n=this,i=t(this.$tip),a=t.Event("hide.bs."+this.type);if(this.$element.trigger(a),!a.isDefaultPrevented())return i.removeClass("in"),t.support.transition&&i.hasClass("fade")?i.one("bsTransitionEnd",o).emulateTransitionEnd(l.TRANSITION_DURATION):o(),this.hoverState=null,this},l.prototype.fixTitle=function(){var t=this.$element;(t.attr("title")||"string"!=typeof t.attr("data-original-title"))&&t.attr("data-original-title",t.attr("title")||"").attr("title","")},l.prototype.hasContent=function(){return this.getTitle()},l.prototype.getPosition=function(e){var o=(e=e||this.$element)[0],n="BODY"==o.tagName,i=o.getBoundingClientRect();null==i.width&&(i=t.extend({},i,{width:i.right-i.left,height:i.bottom-i.top}));var a=window.SVGElement&&o instanceof window.SVGElement,r=n?{top:0,left:0}:a?null:e.offset(),s={scroll:n?document.documentElement.scrollTop||document.body.scrollTop:e.scrollTop()},l=n?{width:t(window).width(),height:t(window).height()}:null;return t.extend({},i,s,l,r)},l.prototype.getCalculatedOffset=function(t,e,o,n){return"bottom"==t?{top:e.top+e.height,left:e.left+e.width/2-o/2}:"top"==t?{top:e.top-n,left:e.left+e.width/2-o/2}:"left"==t?{top:e.top+e.height/2-n/2,left:e.left-o}:{top:e.top+e.height/2-n/2,left:e.left+e.width}},l.prototype.getViewportAdjustedDelta=function(t,e,o,n){var i={top:0,left:0};if(!this.$viewport)return i;var a=this.options.viewport&&this.options.viewport.padding||0,r=this.getPosition(this.$viewport);if(/right|left/.test(t)){var s=e.top-a-r.scroll,l=e.top+a-r.scroll+n;s<r.top?i.top=r.top-s:l>r.top+r.height&&(i.top=r.top+r.height-l)}else{var c=e.left-a,d=e.left+a+o;c<r.left?i.left=r.left-c:d>r.right&&(i.left=r.left+r.width-d)}return i},l.prototype.getTitle=function(){var t=this.$element,e=this.options;return t.attr("data-original-title")||("function"==typeof e.title?e.title.call(t[0]):e.title)},l.prototype.getUID=function(t){for(;t+=~~(1e6*Math.random()),document.getElementById(t););return t},l.prototype.tip=function(){if(!this.$tip&&(this.$tip=t(this.options.template),1!=this.$tip.length))throw new Error(this.type+" `template` option must consist of exactly 1 top-level element!");return this.$tip},l.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},l.prototype.enable=function(){this.enabled=!0},l.prototype.disable=function(){this.enabled=!1},l.prototype.toggleEnabled=function(){this.enabled=!this.enabled},l.prototype.toggle=function(e){var o=this;e&&((o=t(e.currentTarget).data("bs."+this.type))||(o=new this.constructor(e.currentTarget,this.getDelegateOptions()),t(e.currentTarget).data("bs."+this.type,o))),e?(o.inState.click=!o.inState.click,o.isInStateTrue()?o.enter(o):o.leave(o)):o.tip().hasClass("in")?o.leave(o):o.enter(o)},l.prototype.destroy=function(){var t=this;clearTimeout(this.timeout),this.hide(function(){t.$element.off("."+t.type).removeData("bs."+t.type),t.$tip&&t.$tip.detach(),t.$tip=null,t.$arrow=null,t.$viewport=null,t.$element=null})},l.prototype.sanitizeHtml=function(t){return o(t,this.options.whiteList,this.options.sanitizeFn)};var c=t.fn.tooltip;t.fn.tooltip=function(e){return this.each(function(){var o=t(this),n=o.data("bs.tooltip"),i="object"==typeof e&&e;!n&&/destroy|hide/.test(e)||(n||o.data("bs.tooltip",n=new l(this,i)),"string"==typeof e&&n[e]())})},t.fn.tooltip.Constructor=l,t.fn.tooltip.noConflict=function(){return t.fn.tooltip=c,this}}(jQuery),function(t){"use strict";var e=function(t,e){this.init("popover",t,e)};if(!t.fn.tooltip)throw new Error("Popover requires tooltip.js");e.VERSION="3.4.1",e.DEFAULTS=t.extend({},t.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),((e.prototype=t.extend({},t.fn.tooltip.Constructor.prototype)).constructor=e).prototype.getDefaults=function(){return e.DEFAULTS},e.prototype.setContent=function(){var t=this.tip(),e=this.getTitle(),o=this.getContent();if(this.options.html){var n=typeof o;this.options.sanitize&&(e=this.sanitizeHtml(e),"string"===n&&(o=this.sanitizeHtml(o))),t.find(".popover-title").html(e),t.find(".popover-content").children().detach().end()["string"===n?"html":"append"](o)}else t.find(".popover-title").text(e),t.find(".popover-content").children().detach().end().text(o);t.removeClass("fade top bottom left right in"),t.find(".popover-title").html()||t.find(".popover-title").hide()},e.prototype.hasContent=function(){return this.getTitle()||this.getContent()},e.prototype.getContent=function(){var t=this.$element,e=this.options;
return t.attr("data-content")||("function"==typeof e.content?e.content.call(t[0]):e.content)},e.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")};var o=t.fn.popover;t.fn.popover=function(o){return this.each(function(){var n=t(this),i=n.data("bs.popover"),a="object"==typeof o&&o;!i&&/destroy|hide/.test(o)||(i||n.data("bs.popover",i=new e(this,a)),"string"==typeof o&&i[o]())})},t.fn.popover.Constructor=e,t.fn.popover.noConflict=function(){return t.fn.popover=o,this}}(jQuery),function(t){"use strict";function e(o,n){this.$body=t(document.body),this.$scrollElement=t(t(o).is(document.body)?window:o),this.options=t.extend({},e.DEFAULTS,n),this.selector=(this.options.target||"")+" .nav li > a",this.offsets=[],this.targets=[],this.activeTarget=null,this.scrollHeight=0,this.$scrollElement.on("scroll.bs.scrollspy",t.proxy(this.process,this)),this.refresh(),this.process()}function o(o){return this.each(function(){var n=t(this),i=n.data("bs.scrollspy"),a="object"==typeof o&&o;i||n.data("bs.scrollspy",i=new e(this,a)),"string"==typeof o&&i[o]()})}e.VERSION="3.4.1",e.DEFAULTS={offset:10},e.prototype.getScrollHeight=function(){return this.$scrollElement[0].scrollHeight||Math.max(this.$body[0].scrollHeight,document.documentElement.scrollHeight)},e.prototype.refresh=function(){var e=this,o="offset",n=0;this.offsets=[],this.targets=[],this.scrollHeight=this.getScrollHeight(),t.isWindow(this.$scrollElement[0])||(o="position",n=this.$scrollElement.scrollTop()),this.$body.find(this.selector).map(function(){var e=t(this),i=e.data("target")||e.attr("href"),a=/^#./.test(i)&&t(i);return a&&a.length&&a.is(":visible")&&[[a[o]().top+n,i]]||null}).sort(function(t,e){return t[0]-e[0]}).each(function(){e.offsets.push(this[0]),e.targets.push(this[1])})},e.prototype.process=function(){var t,e=this.$scrollElement.scrollTop()+this.options.offset,o=this.getScrollHeight(),n=this.options.offset+o-this.$scrollElement.height(),i=this.offsets,a=this.targets,r=this.activeTarget;if(this.scrollHeight!=o&&this.refresh(),n<=e)return r!=(t=a[a.length-1])&&this.activate(t);if(r&&e<i[0])return this.activeTarget=null,this.clear();for(t=i.length;t--;)r!=a[t]&&e>=i[t]&&(void 0===i[t+1]||e<i[t+1])&&this.activate(a[t])},e.prototype.activate=function(e){this.activeTarget=e,this.clear();var o=this.selector+'[data-target="'+e+'"],'+this.selector+'[href="'+e+'"]',n=t(o).parents("li").addClass("active");n.parent(".dropdown-menu").length&&(n=n.closest("li.dropdown").addClass("active")),n.trigger("activate.bs.scrollspy")},e.prototype.clear=function(){t(this.selector).parentsUntil(this.options.target,".active").removeClass("active")};var n=t.fn.scrollspy;t.fn.scrollspy=o,t.fn.scrollspy.Constructor=e,t.fn.scrollspy.noConflict=function(){return t.fn.scrollspy=n,this},t(window).on("load.bs.scrollspy.data-api",function(){t('[data-spy="scroll"]').each(function(){var e=t(this);o.call(e,e.data())})})}(jQuery),function(t){"use strict";function e(e){return this.each(function(){var n=t(this),i=n.data("bs.tab");i||n.data("bs.tab",i=new o(this)),"string"==typeof e&&i[e]()})}var o=function(e){this.element=t(e)};o.VERSION="3.4.1",o.TRANSITION_DURATION=150,o.prototype.show=function(){var e=this.element,o=e.closest("ul:not(.dropdown-menu)"),n=e.data("target");if(n||(n=(n=e.attr("href"))&&n.replace(/.*(?=#[^\s]*$)/,"")),!e.parent("li").hasClass("active")){var i=o.find(".active:last a"),a=t.Event("hide.bs.tab",{relatedTarget:e[0]}),r=t.Event("show.bs.tab",{relatedTarget:i[0]});if(i.trigger(a),e.trigger(r),!r.isDefaultPrevented()&&!a.isDefaultPrevented()){var s=t(document).find(n);this.activate(e.closest("li"),o),this.activate(s,s.parent(),function(){i.trigger({type:"hidden.bs.tab",relatedTarget:e[0]}),e.trigger({type:"shown.bs.tab",relatedTarget:i[0]})})}}},o.prototype.activate=function(e,n,i){function a(){r.removeClass("active").find("> .dropdown-menu > .active").removeClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!1),e.addClass("active").find('[data-toggle="tab"]').attr("aria-expanded",!0),s?(e[0].offsetWidth,e.addClass("in")):e.removeClass("fade"),e.parent(".dropdown-menu").length&&e.closest("li.dropdown").addClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!0),i&&i()}var r=n.find("> .active"),s=i&&t.support.transition&&(r.length&&r.hasClass("fade")||!!n.find("> .fade").length);r.length&&s?r.one("bsTransitionEnd",a).emulateTransitionEnd(o.TRANSITION_DURATION):a(),r.removeClass("in")};var n=t.fn.tab;t.fn.tab=e,t.fn.tab.Constructor=o,t.fn.tab.noConflict=function(){return t.fn.tab=n,this};var i=function(o){o.preventDefault(),e.call(t(this),"show")};t(document).on("click.bs.tab.data-api",'[data-toggle="tab"]',i).on("click.bs.tab.data-api",'[data-toggle="pill"]',i)}(jQuery),function(t){"use strict";function e(e){return this.each(function(){var n=t(this),i=n.data("bs.affix"),a="object"==typeof e&&e;i||n.data("bs.affix",i=new o(this,a)),"string"==typeof e&&i[e]()})}var o=function(e,n){this.options=t.extend({},o.DEFAULTS,n);var i=this.options.target===o.DEFAULTS.target?t(this.options.target):t(document).find(this.options.target);this.$target=i.on("scroll.bs.affix.data-api",t.proxy(this.checkPosition,this)).on("click.bs.affix.data-api",t.proxy(this.checkPositionWithEventLoop,this)),this.$element=t(e),this.affixed=null,this.unpin=null,this.pinnedOffset=null,this.checkPosition()};o.VERSION="3.4.1",o.RESET="affix affix-top affix-bottom",o.DEFAULTS={offset:0,target:window},o.prototype.getState=function(t,e,o,n){var i=this.$target.scrollTop(),a=this.$element.offset(),r=this.$target.height();if(null!=o&&"top"==this.affixed)return i<o&&"top";if("bottom"==this.affixed)return null!=o?!(i+this.unpin<=a.top)&&"bottom":!(i+r<=t-n)&&"bottom";var s=null==this.affixed,l=s?i:a.top;return null!=o&&i<=o?"top":null!=n&&t-n<=l+(s?r:e)&&"bottom"},o.prototype.getPinnedOffset=function(){if(this.pinnedOffset)return this.pinnedOffset;this.$element.removeClass(o.RESET).addClass("affix");var t=this.$target.scrollTop(),e=this.$element.offset();return this.pinnedOffset=e.top-t},o.prototype.checkPositionWithEventLoop=function(){setTimeout(t.proxy(this.checkPosition,this),1)},o.prototype.checkPosition=function(){if(this.$element.is(":visible")){var e=this.$element.height(),n=this.options.offset,i=n.top,a=n.bottom,r=Math.max(t(document).height(),t(document.body).height());"object"!=typeof n&&(a=i=n),"function"==typeof i&&(i=n.top(this.$element)),"function"==typeof a&&(a=n.bottom(this.$element));var s=this.getState(r,e,i,a);if(this.affixed!=s){null!=this.unpin&&this.$element.css("top","");var l="affix"+(s?"-"+s:""),c=t.Event(l+".bs.affix");if(this.$element.trigger(c),c.isDefaultPrevented())return;this.affixed=s,this.unpin="bottom"==s?this.getPinnedOffset():null,this.$element.removeClass(o.RESET).addClass(l).trigger(l.replace("affix","affixed")+".bs.affix")}"bottom"==s&&this.$element.offset({top:r-e-a})}};var n=t.fn.affix;t.fn.affix=e,t.fn.affix.Constructor=o,t.fn.affix.noConflict=function(){return t.fn.affix=n,this},t(window).on("load",function(){t('[data-spy="affix"]').each(function(){var o=t(this),n=o.data();n.offset=n.offset||{},null!=n.offsetBottom&&(n.offset.bottom=n.offsetBottom),null!=n.offsetTop&&(n.offset.top=n.offsetTop),e.call(o,n)})})}(jQuery),Note.curNoteId="",Note.interval="",Note.itemIsBlog='<div class="item-blog"><i class="fa fa-bold" title="blog"></i></div><div class="item-blogtop"><i class="fa fa-arrow-up" title="blogtop"></i></div><div class="item-setting"><i class="fa fa-cog" title="setting"></i></div>',Note.itemTplNoImg='<li href="#" class="item ?" data-seq="?" noteId="?">',Note.itemTplNoImg+=Note.itemIsBlog+'<div class="item-desc"><p class="item-title">?</p><p class="item-info"><i class="fa fa-book"></i> <span class="note-notebook">?</span> <i class="fa fa-clock-o"></i> <span class="updated-time">?</span></p><p class="desc">?</p></div></li>',Note.itemTpl='<li href="#" class="item ? item-image" data-seq="?" noteId="?"><div class="item-thumb" style=""><img src="?"/></div>',Note.itemTpl+=Note.itemIsBlog+'<div class="item-desc" style=""><p class="item-title">?</p><p class="item-info"><i class="fa fa-book"></i> <span class="note-notebook">?</span> <i class="fa fa-clock-o"></i> <span class="updated-time">?</span></p><p class="desc">?</p></div></li>',Note.newItemTpl='<li href="#" class="item item-active ?" data-seq="?" fromUserId="?" noteId="?">',Note.newItemTpl+=Note.itemIsBlog+'<div class="item-desc" style="right: 0px;"><p class="item-title">?</p><p class="item-info"><i class="fa fa-book"></i> <span class="note-notebook">?</span> <i class="fa fa-clock-o"></i> <span class="updated-time">?</span></p><p class="desc">?</p></div></li>',Note.noteItemListO=$("#noteItemList"),Note.cacheByNotebookId={all:{}},Note.notebookIds={},Note.isReadOnly=!1,Note.intervalTime=1e4,Note.startInterval=function(){clearInterval(Note.interval),Note.interval=setInterval(function(){log("自动保存开始..."),Note.curChangedSaveIt()},Note.intervalTime)},Note.stopInterval=function(){clearInterval(Note.interval),setTimeout(function(){Note.startInterval()},Note.intervalTime)},Note.addNoteCache=function(t){Note.cache[t.NoteId]=t,Note.clearCacheByNotebookId(t.NotebookId)},Note.setNoteCache=function(t,e){Note.cache[t.NoteId]?$.extend(Note.cache[t.NoteId],t):Note.cache[t.NoteId]=t,void 0==e&&(e=!0),e&&Note.clearCacheByNotebookId(t.NotebookId)},Note.setCurNoteId=function(t){this.curNoteId=t},Note.clearCurNoteId=function(){this.curNoteId=null},Note.getCurNote=function(){var t=this;return""==t.curNoteId?null:t.cache[t.curNoteId]},Note.getNote=function(t){var e=this;return e.cache[t]},Note.clearCacheByNotebookId=function(t){t&&(Note.cacheByNotebookId[t]={},Note.cacheByNotebookId.all={},Note.notebookIds[t]=!0)},Note.notebookHasNotes=function(t){var e=Note.getNotesByNotebookId(t);return!isEmpty(e)},Note.getNotesByNotebookId=function(t){if(Note.listIsIn(),t||(t="all"),!Note.cacheByNotebookId[t])return[];var e=Note.getSorterAndOrder(),o=e.sortBy,n=e.isAsc;if(Note.cacheByNotebookId[t][o]){if(Note.cacheByNotebookId[t][o][n])return Note.cacheByNotebookId[t][o][n];Note.cacheByNotebookId[t][o][!n].reverse();var i=Note.cacheByNotebookId[t][o][!n];return Note.cacheByNotebookId[t][o][!n]=null,Note.cacheByNotebookId[t][o][n]=i,i}var i=[];for(var a in Note.cache)if(a){var r=Note.cache[a];r&&(r.IsTrash||r.IsShared||"all"!=t&&r.NotebookId!=t||i.push(r))}return Note.sortNotes(i),Note.cacheByNotebookId[t][o]={},Note.cacheByNotebookId[t][o][n]=i,i},Note.renderNotesAndFirstOneContent=function(t,e){isArray(t)&&(Note.renderNotes(t,!1,!1,e),isEmpty(t[0])||Note.changeNoteForPjax(t[0].NoteId,!0,!1))},Note.curHasChanged=function(t,e){var o=Note.getCurNote();if(!o)return!1;var n=$("#noteTitle").val(),i=Tag.getTags(),a={hasChanged:!1,IsAutoBackup:!t||!(!e||!e.ctrls),IsNew:o.IsNew,IsMarkdown:o.IsMarkdown,FromUserId:o.FromUserId,NoteId:o.NoteId,NotebookId:o.NotebookId};o.IsNew&&(a.hasChanged=!0,a.title=n,LEA.topInfo&&(a.Src=LEA.topInfo.src)),o.Title!=n&&(a.hasChanged=!0,a.Title=n),arrayEqual(o.Tags,i)||(a.hasChanged=!0,a.Tags=i.join(","));var r=!1;if((o.IsNew||t||!Note.readOnly)&&(r=!0),!a.hasChanged&&!r)return!1;if(!r)return a;var s,l,c=getEditorContent(o.IsMarkdown);if(isArray(c)?(s=c[0],l=c[1],s&&previewIsEmpty(l)&&Converter&&(l=Converter.makeHtml(s)),s||(l=""),o.Preview=l):s=c,a.Src&&LEA.topInfo&&n===LEA.topInfo.title&&!a.Tags&&(!s||"<p><br></p>"==s)&&(!e||!e.ctrls))return!1;if(o.Content!=s){a.hasChanged=!0,a.Content=s;var d=l||s;o.HasSelfDefined&&o.IsBlog||(a.Desc=Note.genDesc(d),a.ImgSrc=Note.getImgSrc(d),a.Abstract=Note.genAbstract(d))}else log("text相同");return a},Note.genDesc=function(t){return t?(t=t.replace(/<br \/>/g," "),t=t.replace(/<\/p>/g," "),t=t.replace(/<\/div>/g," "),t=t.replace(/<\/?[^>]+(>|$)/g,""),t=$.trim(t),t=t.replace(/</g,"&lt;"),t=t.replace(/>/g,"&gt;"),t.length<300?t:t.substring(0,300)):""},Note.genAbstract=function(t,e){if(!t)return"";if(void 0==e&&(e=1e3),t.length<e)return t;for(var o=!1,n=!1,i=0,a="",r=e,s=0;s<t.length;++s){var l=t[s];if("<"==l?o=!0:"&"==l?n=!0:">"==l&&o?(i-=1,o=!1):";"==l&&n&&(n=!1),o||n||(i+=1),a+=l,i>=r)break}var c=document.createElement("div");return c.innerHTML=a,c.innerHTML},Note.getImgSrc=function(t){if(!t)return"";var e=$(t).find("img");for(var o in e){var n=e.eq(o).attr("src");if(n)return n}return""},Note.saveInProcess={},Note.savePool={},Note.curChangedSaveIt=function(t,e,o){var n=this;if(Note.curNoteId&&!Note.isReadOnly&&!LEA.readOnly){var i;try{i=Note.curHasChanged(t,o)}catch(a){return void(e&&e(!1))}var r=function(t){n.saveInProcess[t.NoteId]=!0,ajaxPost("/note/updateNoteOrContent",t,function(o){n.saveInProcess[t.NoteId]=!1,t.IsNew&&(o.IsNew=!1,Note.setNoteCache(o,!1),Pjax.changeNote(o)),e&&e(),showMsg(getMsg("saveSuccess"),1e3)},function(e){n.saveInProcess[t.NoteId]=!1,alert(getMsg("saveFailure")),showMsg(getMsg("saveFailure"),3e3),console.error("updateNoteContent失败",e)})};if(i){if(i.hasChanged)return log("需要保存..."),Note.renderChangedNote(i),delete i.hasChanged,showMsg(i.IsAutoBackup?getMsg("autoSaving"):getMsg("saving")),r(i),void 0!=i.Tags&&"string"==typeof i.Tags&&(i.Tags=i.Tags.split(",")),Note.setNoteCache(i,!1),Note.setNoteCache({NoteId:i.NoteId,UpdatedTime:(new Date).format("yyyy-MM-ddThh:mm:ss.S")},!1),Note.clearCacheByNotebookId(i.NotebookId),i;i.IsAutoBackup||(showMsg(getMsg("saving")),r(i))}else log("无需保存");return!1}},Note.updatePoolNote=function(){var t=this;for(var e in t.savePool)if(e){delete t.savePool[e];var o=t.savePool[e];t.saveInProcess[e]=!0,ajaxPost("/note/updateNoteOrContent",o,function(o){t.saveInProcess[e]=!1})}},Note.updatePoolNoteInterval=null,Note.startUpdatePoolNoteInterval=function(){return},Note.clearSelect=function(t){$(".item").removeClass("item-active")},Note.selectTarget=function(t){this.clearSelect(),$(t).addClass("item-active")},Note.showContentLoading=function(){$("#noteMaskForLoading").css("z-index",11)},Note.hideContentLoading=function(){$("#noteMaskForLoading").css("z-index",-1)},Note.directToNote=function(t){var e=$("#noteItemList"),o=e.height(),n=$("[noteId='"+t+"']").position();if(!n)return void console.error("no position: "+t);var i=n.top,a=e.scrollTop();if(i+=a,i>=a&&i<=o+a);else{var r=i;log("定位到特定note, 在可视范围内"),LEA.isMobile||Mobile.isMobile()||($("#noteItemList").scrollTop(r),$("#noteItemList").slimScroll({scrollTo:r+"px",height:"100%",onlyScrollBar:!0}))}},Note.changeNoteForPjax=function(t,e,o){var n=this,i=n.getNote(t);if(i){var a=void 0!=i.Perm;void 0==o&&(o=!0),n.changeNote(t,a,!0,function(n){void 0==e&&(e=!0),e&&Pjax.changeNote(n),o&&Note.directToNote(t)}),o&&(a?$("#myShareNotebooks").hasClass("closed")&&$("#myShareNotebooks .folderHeader").trigger("click"):$("#myNotebooks").hasClass("closed")&&$("#myNotebooks .folderHeader").trigger("click"),Notebook.expandNotebookTo(i.NotebookId))}},Note.contentAjax=null,Note.contentAjaxSeq=1,Note.changeNote=function(t,e,o,n){function i(e,o){Note.contentAjax=null,o==Note.contentAjaxSeq&&(Note.setNoteCache(e,!1),e=Note.cache[t],Note.renderNoteContent(e),a.hideContentLoading(),n&&n(e))}var a=this;if(t){Note.stopInterval();var r=a.getTargetById(t);if(Note.selectTarget(r),void 0==o&&(o=!0),o){Note.curChangedSaveIt()}Note.clearCurNoteId();var s=a.getNote(t);if(s){e||void 0!=s.Perm&&(e=!0);var l=!e||Share.hasUpdatePerm(t);l?(Note.hideReadOnly(),Note.renderNote(s)):Note.renderNoteReadOnly(s),switchEditor(s.IsMarkdown),LEA.trigger("noteChanged",s),Attach.renderNoteAttachNum(t,!0),Note.contentAjaxSeq++;var c=Note.contentAjaxSeq;if(Notebook.changeNotebookNavForNewNote(s.IsTrash?Notebook.trashNotebookId:s.NotebookId,s.Title),s.Content)return void i(s,c);var d="/note/getNoteContent",h={noteId:t};e&&(d="/share/getShareNoteContent",h.sharedUserId=s.UserId),a.showContentLoading(),null!=Note.contentAjax&&Note.contentAjax.abort(),Note.contentAjax=ajaxGet(d,h,function(t){return function(e){delete e.IsBlog,i(e,t)}}(c))}}},Note.renderChangedNote=function(t){if(t){var e=$(tt('[noteId="?"]',t.NoteId));t.Title&&e.find(".item-title").html(trimTitle(t.Title)),t.Desc&&e.find(".desc").html(trimTitle(t.Desc)),t.ImgSrc?($thumb=e.find(".item-thumb"),$thumb.length>0?$thumb.find("img").attr("src",t.ImgSrc):(e.append(tt('<div class="item-thumb" style=""><img src="?"></div>',t.ImgSrc)),e.addClass("item-image")),e.find(".item-desc").removeAttr("style")):""==t.ImgSrc&&(e.find(".item-thumb").remove(),e.removeClass("item-image"))}},Note.clearNoteInfo=function(){Note.clearCurNoteId(),Tag.clearTags(),$("#noteTitle").val(""),setEditorContent(""),$("#noteRead").hide()},Note.clearNoteList=function(){Note.noteItemListO.html("")},Note.clearAll=function(){Note.clearCurNoteId(),Note.clearNoteInfo(),Note.clearNoteList()},Note.renderNote=function(t){t&&($("#noteTitle").val(t.Title),Tag.renderTags(t.Tags))},Note.renderNoteContent=function(t){setEditorContent(t.Content,t.IsMarkdown,t.Preview,function(){Note.setCurNoteId(t.NoteId),Note.toggleReadOnly()})},Note.showEditorMask=function(){$("#editorMask").css("z-index",10).show(),Notebook.curNotebookIsTrashOrAll()?($("#editorMaskBtns").hide(),$("#editorMaskBtnsEmpty").show()):($("#editorMaskBtns").show(),$("#editorMaskBtnsEmpty").hide())},Note.hideEditorMask=function(){$("#editorMask").css("z-index",-10).hide()},Note.toggleView=function(t){var e;e="object"==typeof t&&t?$(t.target).data("view"):t,e||(e="snippet"),Note._isTag||Note._isSearch||Note._isShare||Notebook.curNotebookIsTrashOrAll(Notebook.curNotebookId)?localStorage.setItem("viewStyle",e):(ajaxPost("/notebook/updateNotebookAddition",{notebookId:Notebook.curNotebookId,view:e}),Notebook.getNotebook(Notebook.curNotebookId).View=e),Note.showView(e)},Note.showView=function(t){t||(t="snippet"),"list"==t?$("#noteItemList").addClass("list"):$("#noteItemList").removeClass("list"),$(".view-style").removeClass("checked"),$(".view-"+t).addClass("checked")},Note.setNotesSorter=function(t){var e=$(t.currentTarget).data("sorter");e||(e="dateUpdatedDESC"),Note.checkSorter(e),Note._isTag||Note._isSearch||Note._isShare||Notebook.curNotebookIsTrashOrAll(Notebook.curNotebookId)?(localStorage.setItem("sorterType",e),Note.renderNotesAndFirstOneContent(Note._everNotes,!1)):(ajaxPost("/notebook/updateNotebookAddition",{notebookId:Notebook.curNotebookId,sortBy:e}),Notebook.getNotebook(Notebook.curNotebookId).SortBy=e,Notebook.changeNotebook(Notebook.curNotebookId))};var $sorterStyles=$(".sorter-style");Note.checkSorter=function(t){var e=$(".sorter-"+t);e.is(".checked")||($sorterStyles.removeClass("checked"),e.addClass("checked"))},Note.sortNotesToRender=function(t){Note.sortNotes(t)},Note.sortNotes=function(t){if(!isEmpty(t)){var e=Note.getSorterAndOrder(),o=e.sortBy,n=e.isAsc;t.sort(function(t,e){var i=t[o],a=e[o];if(n){if(i<a)return-1;if(i>a)return 1}else{if(i<a)return 1;if(i>a)return-1}return 0})}},Note.getSorterAndOrder=function(){var t="",e=Notebook.curNotebookId&&"0"!==Notebook.curNotebookId?Notebook.curNotebookId:curNotebookId;if(Note._isTag||Note._isSearch||Note._isShare||Notebook.curNotebookIsTrashOrAll(e))t=localStorage.getItem("sorterType");else{var o=Notebook.getNotebook(e);o&&(t=o.SortBy)}var n="UpdatedTime",i=!1;switch(t){case"dateCreatedASC":n="CreatedTime",i=!0;break;case"dateCreatedDESC":n="CreatedTime",i=!1;break;case"dateUpdatedASC":n="UpdatedTime",i=!0;break;case"dateUpdatedDESC":n="UpdatedTime",i=!1;break;case"titleASC":n="Title",i=!0;break;case"titleDESC":n="Title",i=!1;break;default:t="dateUpdatedDESC"}return Note.checkSorter(t),log({sortBy:n,isAsc:i}),{sortBy:n,isAsc:i}},Note.listIsIn=function(t,e,o){this._isTag=t,this._isSearch=e,this._isShare=o},Note.renderNotesC=0,Note.renderNotes=function(t,e,o,n){var i=++Note.renderNotesC;if(this.clearSeqForNew(),this.batch.reset(),Note._everNotes=Array.from(t),LEA.isMobile||Mobile.isMobile()||$("#noteItemList").slimScroll({scrollTo:"0px",height:"100%",onlyScrollBar:!0}),!t||"object"!=typeof t||t.length<=0)return void(e||Note.showEditorMask());Note.hideEditorMask(),void 0==e&&(e=!1),e||Note.noteItemListO.html("");var a=t.length,r=Math.ceil(a/20);n||Note.sortNotes(t),Note._renderNotes(t,e,o,1);for(var s=0;s<a;++s){var l=t[s];Note.setNoteCache(l,!1),o&&Share.setCache(l)}for(var s=1;s<r;++s)setTimeout(function(n){return function(){i==Note.renderNotesC&&Note._renderNotes(t,e,o,n+1)}}(s),2e3*s)},Note._renderNotes=function(t,e,o,n){for(var i=t.length,a=20*(n-1);a<i&&a<20*n;++a){var r=t[a];r.Title=trimTitle(r.Title);var s="item-my";Note.nowIsInShared=!1,(o||r.UserId!=UserInfo.UserId)&&(s="item-shared",Note.nowIsInShared=!0),e||0!=a||(s+=" item-active");var l;l=r.ImgSrc?tt(Note.itemTpl,s,a,r.NoteId,r.ImgSrc,r.Title,Notebook.getNotebookTitle(r.NotebookId),goNowToDatetime(r.UpdatedTime),r.Desc):tt(Note.itemTplNoImg,s,a,r.NoteId,r.Title,Notebook.getNotebookTitle(r.NotebookId),goNowToDatetime(r.UpdatedTime),r.Desc),l=$(l),r.IsTop?(l.removeClass("item-b"),l.addClass("item-bt")):(l.removeClass("item-bt"),r.IsBlog?l.addClass("item-b"):l.removeClass("item-b")),Note.noteItemListO.append(l)}},Note._seqForNew=0,Note.clearSeqForNew=function(){this._seqForNew=0},Note.newNoteSeq=function(){return--this._seqForNew},Note.newNote=function(t,e,o,n){t||(t=$("#curNotebookForNewNote").attr("notebookId")),switchEditor(n),Note.hideEditorMask(),Note.hideReadOnly(),Note.stopInterval(),Note.curChangedSaveIt(),Note.batch.reset();var i={NoteId:getObjectId(),Title:"",Tags:[],Content:"",NotebookId:t,IsNew:!0,FromUserId:o,IsMarkdown:n,UpdatedTime:new Date,CreatedTime:new Date};LEA.topInfo&&LEA.topInfo.title&&(i.Title=LEA.topInfo.title),Note.addNoteCache(i),Note.clearCacheByNotebookId(t),Attach.clearNoteAttachNum();var a="",r="item-my";e&&(r="item-shared");var s=Notebook.getNotebook(t),l=s?s.Title:"",c=getCurDate();a=e?tt(Note.newItemTpl,r,this.newNoteSeq(),o,i.NoteId,i.Title,l,c,""):tt(Note.newItemTpl,r,this.newNoteSeq(),"",i.NoteId,i.Title,l,c,""),a=$(a),s.IsTop?(a.removeClass("item-b"),a.addClass("item-bt")):(a.removeClass("item-bt"),s.IsBlog?a.addClass("item-b"):a.removeClass("item-b")),Notebook.isCurNotebook(t)?Note.noteItemListO.prepend(a):(Note.clearAll(),Note.noteItemListO.prepend(a),e?Share.changeNotebookForNewNote(t):Notebook.changeNotebookForNewNote(t)),Note.selectTarget($(tt('[noteId="?"]',i.NoteId))),$("#noteTitle").focus(),Note.renderNote(i),Note.renderNoteContent(i),Note.setCurNoteId(i.NoteId),Notebook.incrNotebookNumberNotes(t),Note.toggleWriteable(!0)},Note.changeToNext=function(t){var e=$(t),o=e.next();if(!o.length){var n=e.prev();if(!n.length)return void Note.showEditorMask();o=n}Note.changeNote(o.attr("noteId"))},Note.changeToNextSkipNotes=function(t){var e=Note;if(!isEmpty(t)){if(e.$itemList.find("li").length==t.length)return void e.showEditorMask();if(1==t.length){var o=e.$itemList.find(".item-active");if(1==o.length&&o.attr("noteId")!=t[0])return}for(var n=e.getTargetById(t[0]),i=n.next(),a=1,r=t.length,s=!1;i.length;){if(a>=r){s=!0;break}if(i.attr("noteId")!=e.getTargetById(t[a]).attr("noteId")){s=!0;break}i=i.next(),a++}s||(i=n.prev()),i&&e.changeNote(i.attr("noteId"))}},Note.deleteNote=function(t,e,o){var n,i=Note;if(n=i.inBatch?i.getBatchNoteIds():[$(t).attr("noteId")],!isEmpty(n)){1==n.length&&$(t).hasClass("item-active")&&(Note.stopInterval(),i.clearCurNoteId(),Note.clearNoteInfo());var a;a=1==n.length?$(t):i.$itemList.find(".item-active"),a.hide(),ajaxPost("/note/deleteNote",{noteIds:n,isShared:o},function(t){if(t){Note.changeToNextSkipNotes(n),a.remove();for(var e=0;e<n.length;++e){var o=n[e],r=i.getNote(o);r&&(r.IsTrash||Notebook.minusNotebookNumberNotes(r.NotebookId),Note.clearCacheByNotebookId(r.NotebookId),delete Note.cache[o])}}}),i.batch.reset()}},Note.listNoteShareUserInfo=function(t){var e=$(t).attr("noteId");showDialogRemote("/share/listNoteShareUserInfo",{noteId:e})},Note.shareNote=function(t){var e=$(t).find(".item-title").text();showDialog("dialogShareNote",{title:getMsg("shareToFriends")+"-"+e}),setTimeout(function(){$("#friendsEmail").focus()},500);var o=$(t).attr("noteId");shareNoteOrNotebook(o,!0)},Note.download=function(t,e){var o="";for(var n in e)o+='<input name="'+n+'" value="'+e[n]+'">';$('<form target="mdImageManager" action="'+t+'" method="GET">'+o+"</form>").appendTo("body").submit().remove()},Note.exportPDF=function(t){var e=$(t).attr("noteId");$('<form target="mdImageManager" action="/note/exportPdf" method="GET"><input name="noteId" value="'+e+'"/></form>').appendTo("body").submit().remove()},Note.showReadOnly=function(){Note.isReadOnly=!0,$("#note").addClass("read-only")},Note.hideReadOnly=function(){Note.isReadOnly=!1,$("#note").removeClass("read-only"),$("#noteRead").hide()},Note.renderNoteReadOnly=function(t){Note.showReadOnly(),$("#noteReadTitle").html(t.Title||getMsg("unTitled")),Tag.renderReadOnlyTags(t.Tags),$("#noteReadCreatedTime").html(goNowToDatetime(t.CreatedTime)),$("#noteReadUpdatedTime").html(goNowToDatetime(t.UpdatedTime))},Note.lastSearch=null,Note.lastKey=null,Note.lastSearchTime=new Date,Note.isOver2Seconds=!1,Note.isSameSearch=function(t){var e=new Date,o=e.getTime()-Note.lastSearchTime.getTime();return Note.isOver2Seconds=o>2e3,!Note.lastKey||Note.lastKey!=t||o>1e3?(Note.lastKey=t,Note.lastSearchTime=e,!1):t==Note.lastKey||(Note.lastSearchTime=e,Note.lastKey=t,!1)},Note.searchNote=function(){var t=$("#searchNoteInput").val();return t?void(Note.isSameSearch(t)||(Note.lastSearch&&Note.lastSearch.abort(),Note.curChangedSaveIt(),Note.clearAll(),showLoading(),Notebook.showNoteAndEditorLoading(),Note.listIsIn(!1,!0),$("#tagSearch").hide(),Note.lastSearch=$.post("/note/searchNote",{key:t},function(t){hideLoading(),Notebook.hideNoteAndEditorLoading(),t&&(Note.lastSearch=null,Note.renderNotes(t),isEmpty(t)||Note.changeNote(t[0].NoteId,!1))}))):void Notebook.changeNotebook("0")},Note.$itemList=$("#noteItemList"),Note.getTargetById=function(t){return this.$itemList.find('li[noteId="'+t+'"]')},Note.setNote2Blog=function(t){Note._setBlog(t,!0,!1)},Note.unsetNote2Blog=function(t){Note._setBlog(t,!1,!1)},Note._setBlog=function(t,e,o){var n,i=Note;n=Note.inBatch?i.getBatchNoteIds():[$(t).attr("noteId")],ajaxPost("/note/setNote2Blog",{noteIds:n,isBlog:e,isTop:o},function(t){if(t)for(var a=0;a<n.length;++a){var r=n[a],s=i.getTargetById(r);o?(s.removeClass("item-b"),s.addClass("item-bt")):(s.removeClass("item-bt"),e?s.addClass("item-b"):s.removeClass("item-b")),i.setNoteCache({NoteId:r,IsBlog:e,IsTop:o},!1)}})},Note.setBlogTop=function(t){Note._setBlog(t,!0,!0)},Note.unsetBlogTop=function(t){Note._setBlog(t,!0,!1)},Note.setAllNoteBlogStatus=function(t,e){if(t){var o=Note.getNotesByNotebookId(t);if(isArray(o)){var n=o.length;if(0==n)for(var i in Note.cache)Note.cache[i].NotebookId==t&&(Note.cache[i].IsBlog=e);else for(var i=0;i<n;++i)o[i].IsBlog=e}}},Note.moveNote=function(t,e){var o,n=Note;o=Note.inBatch?n.getBatchNoteIds():[$(t).attr("noteId")];var i=e.notebookId;if(Notebook.getCurNotebookId()!=i){if(1==o.length){var a=n.getNote(o[0]);if(!a.IsTrash&&a.NotebookId==i)return}ajaxPost("/note/moveNote",{noteIds:o,notebookId:i},function(e){if(e){n.clearCacheByNotebookId(i);for(var a=0;a<o.length;++a){var r=o[a],s=n.getNote(r);s&&(s.NotebookId!=i?(Notebook.incrNotebookNumberNotes(i),s.IsTrash||Notebook.minusNotebookNumberNotes(s.NotebookId)):s.IsTrash&&Notebook.incrNotebookNumberNotes(s.NotebookId),n.clearCacheByNotebookId(s.NotebookId),s.NotebookId=i,s.IsTrash=!1,s.UpdatedTime=new Date,n.setNoteCache(s))}var l;l=1==o.length?t:n.$itemList.find(".item-active"),Notebook.curActiveNotebookIsAll()?(l.find(".note-notebook").html(Notebook.getNotebookTitle(i)),n.changeNote(l.eq(0).attr("noteId"))):(n.changeToNextSkipNotes(o),l.remove())}}),n.batch.reset()}},Note.copyNote=function(t,e,o){var n,i=Note,a=e.notebookId;n=Note.inBatch?i.getBatchNoteIds():[$(t).attr("noteId")];for(var r=[],s=0;s<n.length;++s){var l=n[s],c=i.getNote(l);if(c){if(c.IsTrash||c.NotebookId==a)continue;r.push(l)}}if(0!=r.length){var d="/note/copyNote",e={noteIds:r,notebookId:a};if(o){d="/note/copySharedNote";var c=i.getNote(r[0]);e.fromUserId=c.UserId}ajaxPost(d,e,function(t){if(reIsOk(t)){var e=t.Item;if(isEmpty(e))return;Note.clearCacheByNotebookId(a);for(var o=0;o<e.length;++o){var n=e[o];n.NoteId&&(Note.setNoteCache(n),Notebook.incrNotebookNumberNotes(a))}}})}},Note.deleteNoteTag=function(t,e){if(t)for(var o in t){var n=Note.getNote(o);if(n){n.Tags=n.Tags||[];for(var i in n.Tags)n.Tags[i]!=e||n.Tags.splice(i,1);o==Note.curNoteId&&Tag.renderTags(n.Tags)}}},Note.readOnly=!0,LEA.readOnly=!0,Note.toggleReadOnly=function(t){if(LEA.em&&LEA.em.isWriting())return Note.toggleWriteable();var e=this,o=e.getCurNote(),n=$("#editor");n.addClass("read-only").removeClass("all-tool"),$("#editorContent").attr("contenteditable",!1),$("#mdEditor").addClass("read-only"),$("#note").addClass("read-only-editor"),o&&($(".info-toolbar").removeClass("invisible"),o.IsMarkdown?($("#mdInfoToolbar .created-time").html(goNowToDatetime(o.CreatedTime)),$("#mdInfoToolbar .updated-time").html(goNowToDatetime(o.UpdatedTime))):($("#infoToolbar .created-time").html(goNowToDatetime(o.CreatedTime)),$("#infoToolbar .updated-time").html(goNowToDatetime(o.UpdatedTime))),t&&Note.curChangedSaveIt(),Note.readOnly=!0,LEA.readOnly=!0,o.IsMarkdown||$("#editorContent pre").each(function(){LeaAce.setAceReadOnly($(this),!0)}))},LEA.toggleWriteable=Note.toggleWriteable=function(t){var e=Note;$("#editor").removeClass("read-only"),$("#note").removeClass("read-only-editor"),$("#editorContent").attr("contenteditable",!0),$("#mdEditor").removeClass("read-only");var o=e.getCurNote();o&&(Note.readOnly=!1,LEA.readOnly=!1,o.IsMarkdown?MD&&(t||MD.focus(),MD.onResize()):($("#editorContent pre").each(function(){LeaAce.setAceReadOnly($(this),!1)}),t||tinymce.activeEditor.focus()))},Note.toggleWriteableAndReadOnly=function(){LEA.readOnly?Note.toggleWriteable():Note.toggleReadOnly(!0)},Note.getPostUrl=function(t){var e=t.UrlTitle||t.NoteId;return UserInfo.PostUrl+"/"+e},Note.getContextNotebooks=function(t){var e=[],o=[],n=[];for(var i in t){var a=t[i],r={text:a.Title,notebookId:a.NotebookId,action:Note.moveNote},s={text:a.Title,notebookId:a.NotebookId,action:Note.copyNote},l={text:a.Title,notebookId:a.NotebookId,action:Share.copySharedNote};if(!isEmpty(a.Subs)){var c=Note.getContextNotebooks(a.Subs);r.items=c[0],s.items=c[1],l.items=c[2],r.type="group",r.width=150,s.type="group",s.width=150,l.type="group",l.width=150}e.push(r),o.push(s),n.push(l)}return[e,o,n]},Note.contextmenu=null,Note.notebooksCopy=[],Note.initContextmenu=function(){function t(t){var e=$(this).attr("noteId"),o=[];if(Note.inBatch)o.push("shareToFriends"),o.push("exportPDF"),Notebook.curActiveNotebookIsTrash()&&(o.push("shareStatus"),o.push("unset2Blog"),o.push("set2Blog"),o.push("copy"));else{var n=Note.getNote(e);if(!n)return;if(n.IsTrash||Notebook.curActiveNotebookIsTrash())o.push("shareToFriends"),o.push("shareStatus"),o.push("unset2Blog"),o.push("set2Blog"),o.push("copy");else{n.IsBlog?o.push("set2Blog"):o.push("unset2Blog");var i=Notebook.getNotebookTitlePath(n.NotebookId);o.push("move."+i),o.push("copy."+i)}}o.indexOf("set2Blog")!=-1&&o.indexOf("unset2Blog")==-1?n.IsTop?o.push("setBlogTop"):o.push("cancelBlogTop"):(o.push("setBlogTop"),o.push("cancelBlogTop")),t.applyrule({name:"target..",disable:!0,items:o})}function e(){return"target3"!=this.id}var o=Note;Note.contextmenu&&Note.contextmenu.destroy();var n=Notebook.everNotebooks,i=o.getContextNotebooks(n),a=i[0],r=i[1];o.notebooksCopy=i[2];var s={width:180,items:[{text:getMsg("shareToFriends"),alias:"shareToFriends",icon:"",faIcon:"fa-share-square-o",action:Note.listNoteShareUserInfo},{type:"splitLine"},{text:getMsg("publicAsBlog"),alias:"set2Blog",faIcon:"fa-bold",action:Note.setNote2Blog},{text:getMsg("cancelPublic"),alias:"unset2Blog",faIcon:"fa-undo",action:Note.unsetNote2Blog},{text:getMsg("setBlogTop"),alias:"setBlogTop",faIcon:"fa-arrow-up",action:Note.setBlogTop},{text:getMsg("cancelBlogTop"),alias:"cancelBlogTop",faIcon:"fa-minus",action:Note.unsetBlogTop},{type:"splitLine"},{text:getMsg("exportPdf"),alias:"exportPDF",faIcon:"fa-file-pdf-o",action:Note.exportPDF},{type:"splitLine"},{text:getMsg("delete"),
icon:"",faIcon:"fa-trash-o",action:Note.deleteNote},{text:getMsg("move"),alias:"move",faIcon:"fa-arrow-right",type:"group",width:180,items:a},{text:getMsg("copy"),alias:"copy",icon:"",faIcon:"fa-copy",type:"group",width:180,items:r}],onShow:t,onContextMenu:e,parent:"#noteItemList",children:".item-my"};Note.contextmenu=$("#noteItemList .item-my").contextmenu(s)};var Attach={loadedNoteAttachs:{},attachsMap:{},init:function(){var t=this;$("#showAttach").on("click",function(){t.renderAttachs(Note.curNoteId)}),t.attachListO.on("click",function(t){t.stopPropagation()}),t.attachListO.on("click",".delete-attach",function(e){e.stopPropagation();var o=$(this).closest("li").data("id"),n=this;confirm(getMsg("Are you sure to delete it ?"))&&($(n).button("loading"),ajaxPost("/attach/deleteAttach",{attachId:o},function(e){$(n).button("reset"),reIsOk(e)?t.deleteAttach(o):alert(e.Msg)}))}),t.attachListO.on("click",".download-attach",function(t){t.stopPropagation();var e=$(this).closest("li").data("id");Note.download("/attach/download",{attachId:e})}),t.downloadAllBtnO.click(function(){Note.download("/attach/downloadAll",{noteId:Note.curNoteId})}),t.attachListO.on("click",".link-attach",function(e){e.stopPropagation();var o=$(this).closest("li").data("id"),n=t.attachsMap[o],i="/api/file/getAttach?fileId="+o;Note.toggleWriteable(),LEA.isMarkdownEditor()&&MD?MD.insertLink(i,n.Title):tinymce.activeEditor.insertContent('<a target="_blank" href="'+i+'">'+n.Title+"</a>")})},attachListO:$("#attachList"),attachNumO:$("#attachNum"),attachDropdownO:$("#attachDropdown"),downloadAllBtnO:$("#downloadAllBtn"),linkAllBtnO:$("#linkAllBtn"),clearNoteAttachNum:function(){var t=this;t.attachNumO.html("").hide()},renderNoteAttachNum:function(t,e){var o=this,n=Note.getNote(t);n.AttachNum?(o.attachNumO.html("("+n.AttachNum+")").show(),o.downloadAllBtnO.show(),o.linkAllBtnO.show()):(o.attachNumO.hide(),o.downloadAllBtnO.hide(),o.linkAllBtnO.hide()),e&&o.attachDropdownO.removeClass("open")},_renderAttachs:function(t){for(var e=this,o="",n=t.length,i=getMsg("Delete"),a=getMsg("Download"),r=getMsg("Insert link into content"),s=0;s<n;++s){var l=t[s];o+='<li class="clearfix" data-id="'+l.AttachId+'"><div class="attach-title">'+l.Title+'</div><div class="attach-process"> \t  <button class="btn btn-sm btn-warning delete-attach" data-loading-text="..." title="'+i+'"><i class="fa fa-trash-o"></i></button> \t  <button type="button" class="btn btn-sm btn-primary download-attach" title="'+a+'"><i class="fa fa-download"></i></button> \t  <button type="button" class="btn btn-sm btn-default link-attach" title="'+r+'"><i class="fa fa-link"></i></button> </div></li>',e.attachsMap[l.AttachId]=l}e.attachListO.html(o);var c=Note.getCurNote();c&&(c.AttachNum=n,e.renderNoteAttachNum(c.NoteId,!1))},_bookmark:null,renderAttachs:function(t){var e=this;return e.loadedNoteAttachs[t]?void e._renderAttachs(e.loadedNoteAttachs[t]):(e.attachListO.html('<li class="loading"><img src="/images/loading-24.gif"/></li>'),void ajaxGet("/attach/getAttachs",{noteId:t},function(o){var n=[];o.Ok&&(n=o.List,n||(n=[])),e.loadedNoteAttachs[t]=n,e._renderAttachs(n)}))},addAttach:function(t){var e=this;e.loadedNoteAttachs[t.NoteId]||(e.loadedNoteAttachs[t.NoteId]=[]),e.loadedNoteAttachs[t.NoteId].push(t),e.renderAttachs(t.NoteId)},deleteAttach:function(t){for(var e=this,o=Note.curNoteId,n=e.loadedNoteAttachs[o],i=0;i<n.length;++i)if(n[i].AttachId==t){n.splice(i,1);break}e.renderAttachs(o)},downloadAttach:function(t){},downloadAll:function(){}};Note.inBatch=!1,Note.getBatchNoteIds=function(){for(var t=[],e=Note.$itemList.find(".item-active"),o=0;o<e.length;++o)t.push(e.eq(o).attr("noteId"));return t},Note.batch={$noteItemList:$("#noteItemList"),cancelInBatch:function(){Note.inBatch=!1,this.$body.removeClass("batch")},setInBatch:function(){Note.inBatch=!0,this.$body.addClass("batch")},isInBatch:function(){var t=this,e=t.$noteItemList.find(".item-active");return e.length>=2},_startNoteO:null,getStartNoteO:function(){var t=this;return t._startNoteO||(t._startNoteO=t.getCurSelected()),t._startNoteO},_selectByStart:{},clearByStart:function(t){var e=this;if(t){var o=this._selectByStart[t];if(!isEmpty(o))for(var n=0;n<o.length;++n)e.clearTarget(o[n])}},selectTo:function(t){var e=this.getStartNoteO();e||alert("nono start");var o,n,i,a,r=+e.data("seq"),s=+t.data("seq");r<s?(o=e,n=t,i=r,a=s):(o=t,n=e,i=s,a=r);var l=e.attr("noteId");this.clearByStart(l);var c=o;this._selectByStart[l]=[];for(var d=i;d<=a;++d)this.selectTarget(c),this._selectByStart[l].push(c),c=c.next()},selectAll:function(){this.$noteItemList.find("li").addClass("item-active")},clearAllSelect:function(){Note.clearSelect()},selectTarget:function(t){t&&t.addClass("item-active")},clearTarget:function(t){t&&t.removeClass("item-active")},select:function(t){var e=this;if(t.hasClass("item-active")){var o=this.isInBatch();o&&t.removeClass("item-active")}else e._startNoteO=t,this.selectTarget(t)},getCurSelected:function(){return this.$noteItemList.find(".item-active")},reset:function(){this.cancelInBatch(),this._selectByStart={},this._startMove=!1,this._startNoteO=null,this.clearRender()},canBatch:function(){return!LEA.em.isWritingMode},init:function(){var t=this;t.$noteItemList.on("click",".item",function(e){var o=$(this),n=o.attr("noteId");if(n){var i=!1,a=!1;t.canBatch()&&(e.shiftKey?a=!0:i=e.metaKey||e.ctrlKey),(i||a)&&Note.curChangedSaveIt(),i?t.select(o):a?t.selectTo(o):Note.selectTarget(o),t.finalFix()}}),t._startMove=!1,t.$noteItemList.on("mousedown",".item",function(e){t.canBatch()&&(t.isContextMenu(e)||!t._startMove&&(e.metaKey||e.ctrlKey||e.shiftKey)||(t._startNoteO=$(this),t._startMove=!0))}),t.$noteItemList.on("mousemove",".item",function(e){t.canBatch()&&t._startMove&&(Note.curChangedSaveIt(),t.clearAllSelect(),t.selectTo($(this)),t.finalFix(!0))});var e=$("body");e.on("mouseup",function(){t._startMove=!1}),e.on("keydown",function(e){e.target&&"BODY"===e.target.nodeName&&(e.ctrlKey||e.metaKey)&&65===e.which&&(e.preventDefault(),t.canBatch()&&(Note.curChangedSaveIt(),t.selectAll(),t.finalFix()))}),t.$noteItemList.on("dragstart",function(t){t.preventDefault(),t.stopPropagation()}),t.initContextmenu()},initContextmenu:function(){var t=this;t.$batchMask.on("contextmenu",function(t){t.preventDefault(),Note.nowIsInShared?Share.contextmenu.showMenu(t):Note.contextmenu.showMenu(t)}),t.$batchMask.find(".batch-info .fa").click(function(t){t.preventDefault(),t.pageX-=90,t.pageY+=10,t.stopPropagation(),$(document).click(),Note.nowIsInShared?Share.contextmenu.showMenu(t):Note.contextmenu.showMenu(t)})},$body:$("body"),finalFix:function(t){var e=this;if(e.isInBatch())Note.clearCurNoteId(),e.renderBatchNotes(),e.setInBatch();else{e.clearRender(),e.cancelInBatch();var o=e.getCurSelected();if(o){var n=o.attr("noteId");t||(e._startNoteO=o),Mobile.changeNote(n),Note.curNoteId!=n&&Note.changeNoteForPjax(n,!0,!1)}}},isContextMenu:function(t){return(void 0==t.which||1!=t.which)&&1!=t.button&&(void 0!=t.which&&3==t.which||2==t.button)},_notes:{},clearRender:function(){this._notes={},this.$batchCtn.html(""),this.hideMask()},showMask:function(){this.$batchMask.css({"z-index":99}).show()},hideMask:function(){this.$batchMask.css({"z-index":-2}).hide()},renderBatchNotes:function(){var t=this;t.showMask();var e=t.$noteItemList.find(".item-active");t.$batchNum.html(e.length);for(var o={},n=0;n<e.length;++n){var i=e.eq(n).attr("noteId");t.addTo(i),o[i]=1}for(var i in t._notes)if(!o[i]){var a=t._notes[i];a.css({"margin-left":"-800px"}),setTimeout(function(){a.remove()},500),delete t._notes[i]}},$batchMask:$("#batchMask"),$batchCtn:$("#batchCtn"),$batchNum:$("#batchMask .batch-info span"),_i:1,getRotate:function(){var t=this,e=t._i++,o=e%2===0?1:-1,n=(o*Math.random()*70,[0,10,20,30,40]),i=o*n[e%5]*3;return i-=80,[o*Math.random()*30,i]},addTo:function(t){var e=this;if(!e._notes[t]){var o=Note.getNote(t),n=o.Title||getMsg("unTitled"),i=o.Desc||"...",a=$('<div class="batch-note"><div class="title">'+n+'</div><div class="content">'+i+"</div></div>");e._notes[t]=a;var r=e.getRotate();e.$batchCtn.append(a),setTimeout(function(){a.css({transform:"rotate("+r[0]+"deg)","margin-left":r[1]+"px"})})}}},$(function(){Attach.init(),$("#noteItemList").on("mouseenter",".item",function(t){(LEA.isIpad||LEA.isIphone)&&$(this).trigger("click")}),Note.batch.init(),$("#newNoteBtn, #editorMask .note").click(function(){var t=$("#curNotebookForNewNote").attr("notebookId");Note.newNote(t)}),$("#newNoteMarkdownBtn, #editorMask .markdown").click(function(){var t=$("#curNotebookForNewNote").attr("notebookId");Note.newNote(t,!1,"",!0)}),$("#notebookNavForNewNote").on("click","li div",function(){var t=$(this).attr("notebookId");$(this).hasClass("new-note-right")?Note.newNote(t,!1,"",!0):Note.newNote(t)}),$("#searchNotebookForAdd").on("click",function(t){t.stopPropagation()}),$("#searchNotebookForAdd").on("keyup",function(){var t=$(this).val();Notebook.searchNotebookForAddNote(t)}),$("#searchNotebookForList").on("keyup",function(){var t=$(this).val();Notebook.searchNotebookForList(t)}),$("#noteTitle").on("keydown",function(t){var e=t.keyCode||t.witch;9==e&&(Note.toggleWriteable(),t.preventDefault())}),$("#searchNoteInput").on("keydown",function(t){var e=t.keyCode||t.witch;if(13==e||108==e)return t.preventDefault(),Note.searchNote(),!1}),$("#saveBtn").on("click",function(){Note.curChangedSaveIt(!0)}),Note.$itemList.on("click",".item-blog, .item-blogtop",function(t){t.preventDefault(),t.stopPropagation(),$(document).click();var e=$(this).parent().attr("noteId"),o=Note.getNote(e);o&&window.open(Note.getPostUrl(o))}),Note.$itemList.on("click",".item-my .item-setting",function(t){t.preventDefault(),t.stopPropagation(),$(document).click();var e=$(this).parent();Note.contextmenu.showMenu(t,e)}),$(".toolbar-update").on("click",function(){Note.toggleWriteable()}),$("#editBtn").on("click",function(){Note.toggleWriteableAndReadOnly()}),$("#editorContent").on("click","a",function(t){if(Note.readOnly){var e=$(this).attr("href");if(e&&"#"==e[0])return;t.preventDefault(),window.open(e)}}),$("#preview-contents").on("click","a",function(t){var e=$(this).attr("href");e&&"#"==e[0]||(t.preventDefault(),window.open(e))}),$(".view-style").on("click",function(t){Note.toggleView(t)}),$(".sorter-style").on("click",function(t){Note.setNotesSorter(t)})}),Note.startInterval(),Tag.classes={"蓝色":"label label-blue","红色":"label label-red","绿色":"label label-green","黄色":"label label-yellow",blue:"label label-blue",red:"label label-red",green:"label label-green",yellow:"label label-yellow"},Tag.mapCn2En={"蓝色":"blue","红色":"red","绿色":"green","黄色":"yellow"},Tag.mapEn2Cn={blue:"蓝色",red:"红色",green:"绿色",yellow:"黄色"},Tag.t=$("#tags"),Tag.getTags=function(){var t=[];return Tag.t.children().each(function(){var e=$(this).data("tag");e=Tag.mapCn2En[e]||e,t.push(e)}),t},Tag.clearTags=function(){Tag.t.html("")},Tag.renderTags=function(t){if(Tag.t.html(""),!isEmpty(t))for(var e=0;e<t.length;++e){var o=t[e];Tag.appendTag(o)}},Tag.renderReadOnlyTags=function(t){function e(){return o?"label label-default":(o=!0,"label label-info")}$("#noteReadTags").html(""),(isEmpty(t)||1==t.length&&""==t[0])&&$("#noteReadTags").html(getMsg("noTag"));var o=!0;for(var o in t){var n=t[o];n=Tag.mapEn2Cn[n]||n;var i=Tag.classes[n];i||(i=e()),tag=tt('<span class="?">?</span>',i,trimTitle(n)),$("#noteReadTags").append(tag)}},Tag.appendTag=function(t,e){var o,n,i=!1;if("object"==typeof t){if(o=t.classes,n=t.text,!n)return}else{if(t=t.trim(),n=t,!n)return;var o=Tag.classes[n];o?i=!0:o="label label-default"}var a=n;LEA.locale.indexOf("zh")>=0&&(n=Tag.mapEn2Cn[n]||n,a=Tag.mapCn2En[a]||a),t=tt('<span class="?" data-tag="?">?<i title="'+getMsg("delete")+'">X</i></span>',o,n,n);var r=!1;$("#tags").children().each(function(){if(i){var e=$("<div></div>").append($(this).clone()).html();e==t&&($(this).remove(),r=!0)}else n+"X"==$(this).text()&&($(this).remove(),r=!0)}),$("#tags").append(t),hideTagList(),i||reRenderTags(),e&&(r||Note.curChangedSaveIt(!0,function(){ajaxPost("/tag/updateTag",{tag:a},function(t){reIsOk(t)&&Tag.addTagNav(t.Item)})}))},Tag.removeTag=function(t){var e=t.data("tag");t.remove(),reRenderTags(),LEA.locale.indexOf("zh")>=0&&(e=Tag.mapCn2En[e]||e),Note.curChangedSaveIt(!0,function(){})},Tag.tags=[],Tag.renderTagNav=function(t){t=t||[],Tag.tags=t,$("#tagNav").html("");for(var e in t){var o=t[e],n=o.Tag,i=n;if(LEA.locale.indexOf("zh")>=0)var i=Tag.mapEn2Cn[n]||i;if(i=trimTitle(i)){var a=Tag.classes[n]||"label label-default";$("#tagNav").append(tt('<li data-tag="?"><a> <span class="?">?</span> <span class="tag-delete">X</span></li>',n,a,i))}}},Tag.deleteTag=function(t){for(var e=0;e<this.tags.length;++e){var o=this.tags[e];if(o.Tag==t){this.tags.splice(e,1);break}}},Tag.addTagNav=function(t){var e=this;for(var o in e.tags){var n=e.tags[o];if(n.Tag==t.Tag){e.tags.splice(o,1);break}}e.tags.unshift(t),e.renderTagNav(e.tags)},$(function(){function t(){$li=$(this).closest("li");var t=$.trim($li.data("tag"));confirm("Are you sure ?")&&ajaxPost("/tag/deleteTag",{tag:t},function(e){if(reIsOk(e)){var o=e.Item;Note.deleteNoteTag(o,t),$li.remove(),Tag.deleteTag(t)}})}function e(){var t=$(this).closest("li"),e=$.trim(t.data("tag"));Note.curChangedSaveIt(),Note.clearAll(),$("#tagSearch").html(t.html()).show(),$("#tagSearch .tag-delete").remove(),Note.listIsIn(!0,!1),showLoading(),ajaxGet("/note/searchNoteByTags",{tags:[e]},function(t){hideLoading(),t&&(Note.renderNotes(t),isEmpty(t)||Note.changeNote(t[0].NoteId))})}$("#addTagTrigger").on("click",function(){$(this).hide(),$("#addTagInput").show().focus().val("")}),$("#addTagInput").on("click",function(t){showTagList(t)}),$("#addTagInput").on("blur",function(){var t=$(this).val();t&&Tag.appendTag(t,!0)}),$("#addTagInput").on("keydown",function(t){13==t.keyCode&&(hideTagList(),$("#addTagInput").val()?($(this).trigger("blur"),$("#addTagTrigger").trigger("click")):$(this).trigger("blur"))}),$("#tagColor li").click(function(t){var e;e=$(this).attr("role")?$(this).find("span"):$(this),Tag.appendTag({classes:e.attr("class"),text:e.text()},!0)}),$("#tags").on("click","i",function(){Tag.removeTag($(this).parent())}),$("#myTag .folderBody").on("click","li .label",e),$("#myTag .folderBody").on("click","li .tag-delete",t)}),Notebook.curNotebookId="",Notebook.cache={},Notebook.notebooks=[],Notebook.notebookNavForListNote="",Notebook.notebookNavForNewNote="",Notebook.setCache=function(t){var e=t.NotebookId;e&&(Notebook.cache[e]||(Notebook.cache[e]={}),$.extend(Notebook.cache[e],t))},Notebook.getCurNotebookId=function(){return Notebook.curNotebookId},Notebook.getCurNotebook=function(){return Notebook.cache[Notebook.curNotebookId]},Notebook._updateNotebookNumberNotes=function(t,e){var o=this,n=o.getNotebook(t);n&&(n.NumberNotes+=e,n.NumberNotes<0&&(n.NumberNotes=0),$("#numberNotes_"+t).html(n.NumberNotes))},Notebook.incrNotebookNumberNotes=function(t){var e=this;e._updateNotebookNumberNotes(t,1)},Notebook.minusNotebookNumberNotes=function(t){var e=this;e._updateNotebookNumberNotes(t,-1)},Notebook.getNotebook=function(t){return Notebook.cache[t]},Notebook.getNotebookTitle=function(t){var e=Notebook.cache[t];return e?e.Title:"未知"},Notebook.getNotebookTitlePath=function(t){var e=Notebook.cache[t];return e?""==e.ParentNotebookId?e.Title:Notebook.getNotebookTitlePath(e.ParentNotebookId)+"."+e.Title:"未知"},Notebook.getTreeSetting=function(t,e){function o(t,o){var n=$("#"+t+" #"+o.tId+"_switch"),i=$("#"+t+" #"+o.tId+"_ico");n.remove(),i.before(n),e?Share.isDefaultNotebookId(o.NotebookId)||i.after($('<span class="fa notebook-setting" title="setting"></span>')):Notebook.isAllNotebookId(o.NotebookId)||Notebook.isTrashNotebookId(o.NotebookId)||(i.after($('<span class="notebook-number-notes" id="numberNotes_'+o.NotebookId+'">'+(o.NumberNotes||0)+"</span>")),i.after($('<span class="fa notebook-setting" title="setting"></span>')))}function n(t,e){for(var o=0,n=e.length;o<n;o++)if(e[o].drag===!1)return!1;return!0}function i(t,e,o,n){return!o||o.drop!==!1}function a(t,e,o,n,i){function a(t){return t.level==h}var r=o[0];if(n){var l,c=s.tree,d={curNotebookId:r.NotebookId};if(l="inner"==i?n:n.getParentNode()){d.parentNotebookId=l.NotebookId;var h=l.level+1,u=c.getNodesByFilter(a,!1,l)}else var u=c.getNodes();d.siblings=[];for(var f in u){var g=u[f].NotebookId;Notebook.isAllNotebookId(g)||Notebook.isTrashNotebookId(g)||d.siblings.push(g)}ajaxPost("/notebook/dragNotebooks",{data:JSON.stringify(d)}),setTimeout(function(){Notebook.changeNav()},100)}}var r=!t,s=this;if(e)var l=function(t,e,o){var n=o.NotebookId,i=$(t.target).closest(".friend-notebooks").attr("fromUserId");Share.changeNotebook(i,n)},c=null;else var l=function(t,e,o){var n=o.NotebookId;Notebook.changeNotebook(n)},c=function(t){var e=$(t.target).attr("notebookId");Notebook.isAllNotebookId(e)||Notebook.isTrashNotebookId(e)||s.updateNotebookTitle(t.target)};var d={view:{showLine:!1,showIcon:!1,selectedMulti:!1,dblClickExpand:!1,addDiyDom:o},data:{key:{name:"Title",children:"Subs"}},edit:{enable:!0,showRemoveBtn:!1,showRenameBtn:!1,drag:{isMove:r,prev:r,inner:r,next:r}},callback:{beforeDrag:n,beforeDrop:i,onDrop:a,onClick:l,onDblClick:c,beforeRename:function(t,e,o,n){if(""==o)return!!e.IsNew&&(s.tree.removeNode(e),!0);if(e.Title==o)return!0;if(e.IsNew){var i=e.getParentNode(),a=i?i.NotebookId:"";s.doAddNotebook(e.NotebookId,o,a)}else s.doUpdateNotebookTitle(e.NotebookId,o);return!0}}};return d},Notebook.allNotebookId="0",Notebook.trashNotebookId="-1",Notebook.curNotebookIsTrashOrAll=function(){return Notebook.curNotebookId==Notebook.trashNotebookId||Notebook.curNotebookId==Notebook.allNotebookId},Notebook.renderNotebooks=function(t){var e=this;(!t||"object"!=typeof t||t.length<0)&&(t=[]);for(var o=0,n=t.length;o<n;++o){var i=t[o];i.Title=trimTitle(i.Title)}t=[{NotebookId:Notebook.allNotebookId,Title:getMsg("all"),drop:!1,drag:!1}].concat(t),t.push({NotebookId:Notebook.trashNotebookId,Title:getMsg("trash"),drop:!1,drag:!1}),Notebook.notebooks=t,e.tree=$.fn.zTree.init($("#notebookList"),e.getTreeSetting(),t);var a=$("#notebookList");a.on("mouseenter",function(){$(this).hasClass("showIcon")||$(this).addClass("showIcon")}).on("mouseleave",function(){$(this).removeClass("showIcon")}),isEmpty(t)||(Notebook.curNotebookId=curNotebookId?curNotebookId:t[0].NotebookId,e.cacheAllNotebooks(t)),Notebook.renderNav(),Notebook.changeNotebookNavForNewNote(t[0].NotebookId)},Notebook.cacheAllNotebooks=function(t){var e=this;for(var o in t){var n=t[o];Notebook.cache[n.NotebookId]=n,isEmpty(n.Subs)||e.cacheAllNotebooks(n.Subs)}},Notebook.expandNotebookTo=function(t,e){var o=this,n=!1,i=o.tree;if(e&&(i=Share.trees[e]),i){var a=i.getNodeByTId(t);if(a)for(;;){var r=a.getParentNode();if(!r){n||Notebook.changeNotebookNav(t);break}i.expandNode(r,!0),n||(Notebook.changeNotebookNav(t),n=!0),a=r}}},Notebook.renderNav=function(t){var e=this;e.changeNav()},Notebook.searchNotebookForAddNote=function(t){var e=this;if(t){var o=e.tree.getNodesByParamFuzzy("Title",t);o=o||[];var n=[];for(var i in o){var a=o[i].NotebookId;e.isAllNotebookId(a)||e.isTrashNotebookId(a)||n.push(o[i])}isEmpty(n)?$("#notebookNavForNewNote").html(""):$("#notebookNavForNewNote").html(e.getChangedNotebooks(n))}else $("#notebookNavForNewNote").html(e.everNavForNewNote)},Notebook.searchNotebookForList=function(t){var e=this,o=$("#notebookListForSearch"),n=$("#notebookList");if(t){o.show(),n.hide();var i=e.tree.getNodesByParamFuzzy("Title",t);if(log("search"),log(i),isEmpty(i))o.html("");else{var a=e.getTreeSetting(!0);e.tree2=$.fn.zTree.init(o,a,i)}}else e.tree2=null,o.hide(),n.show(),$("#notebookNavForNewNote").html(e.everNavForNewNote)},Notebook.getChangedNotebooks=function(t){for(var e=this,o="",n=t.length,i=0;i<n;++i){var a=t[i],r="";isEmpty(a.Subs)||(r="dropdown-submenu");var s=tt('<li role="presentation" class="clearfix ?"><div class="new-note-left pull-left" title="为该笔记本新建笔记" href="#" notebookId="?">?</div><div title="为该笔记本新建markdown笔记" class="new-note-right pull-left" notebookId="?">M</div>',r,a.NotebookId,a.Title,a.NotebookId);isEmpty(a.Subs)||(s+="<ul class='dropdown-menu'>",s+=e.getChangedNotebooks(a.Subs),s+="</ul>"),s+="</li>",o+=s}return o},Notebook.everNavForNewNote="",Notebook.everNotebooks=[],Notebook.changeNav=function(){var t=Notebook,e=Notebook.tree.getNodes(),o=e.slice(1,-1),n=t.getChangedNotebooks(o);t.everNavForNewNote=n,t.everNotebooks=o,$("#notebookNavForNewNote").html(n),Note.initContextmenu(),Share.initContextmenu(Note.notebooksCopy)},Notebook.renderShareNotebooks=function(t,e){if(!isEmpty(t)&&e&&"object"==typeof e&&!(e.length<0)){var o=$("#shareNotebooks"),n={};for(var i in e){var a=e[i];n[a.UserId]=a}for(var i in t){var r=t[i],a=n[r.UserId]||{ShareNotebooks:[]};a.ShareNotebooks=[{NotebookId:"-2",Title:"默认共享"}].concat(a.ShareNotebooks);var s=r.Username||r.Email,l=tt('<div class="folderNote closed"><div class="folderHeader"><a><h1 title="? 的共享"><i class="fa fa-angle-right"></i>?</h1></a></div>',s,s),c='<ul class="folderBody">';for(var d in a.ShareNotebooks){var h=a.ShareNotebooks[d];c+=tt('<li><a notebookId="?">?</a></li>',h.NotebookId,h.Title)}c+="</ul>",o.append(l+c+"</div>")}}},Notebook.selectNotebook=function(t){$(".notebook-item").removeClass("curSelectedNode"),$(t).addClass("curSelectedNode")},Notebook.changeNotebookNavForNewNote=function(t,e){if(void 0===t||"0"==t){var o=Notebook.notebooks[0];t=o.NotebookId,e=o.Title}if(void 0===e){var o=Notebook.cache[0];e=o.Title}else{for(var n=[],o=Notebook.cache[t];o&&(n.unshift(o.Title),o.ParentNotebookId);)o=Notebook.cache[o.ParentNotebookId];e=n.join(" > ")}if(Notebook.isAllNotebookId(t)){if(!$("#curNotebookForNewNote").attr("notebookId")&&Notebook.notebooks.length>2){var o=Notebook.notebooks[1];t=o.NotebookId,e=o.Title,Notebook.changeNotebookNavForNewNote(t,e)}}else $("#curNotebookForNewNote").html(e).attr("notebookId",t)},Notebook.toggleToMyNav=function(t,e){$("#sharedNotebookNavForListNav").hide(),$("#myNotebookNavForListNav").show(),$("#newMyNote").show(),$("#newSharedNote").hide(),$("#tagSearch").hide()},Notebook.changeNotebookNav=function(t){Notebook.curNotebookId=t,Notebook.toggleToMyNav(),Notebook.selectNotebook($(tt('#notebook [notebookId="?"]',t)));var e=Notebook.cache[t];if(e){$("#curNotebookForListNote").html(e.Title),Notebook.changeNotebookNavForNewNote(t,e.Title);var o="";if(Note._isTag||Note._isSearch||Note._isShare||Notebook.curNotebookIsTrashOrAll(t))o=localStorage.getItem("viewStyle",o);else{var e=Notebook.getNotebook(t);e&&e.View&&(o=e.View)}Note.showView(o)}},Notebook.isAllNotebookId=function(t){return t==Notebook.allNotebookId},Notebook.isTrashNotebookId=function(t){return t==Notebook.trashNotebookId},Notebook.curActiveNotebookIsAll=function(){return Notebook.isAllNotebookId($("#notebookList .curSelectedNode").attr("notebookId"))},Notebook.curActiveNotebookIsTrash=function(){return Notebook.isTrashNotebookId($("#notebookList .curSelectedNode").attr("notebookId"))},Notebook.changeNotebookSeq=1,Notebook.changeNotebook=function(t,e){var o=this;Notebook.changeNotebookNav(t),Notebook.curNotebookId=t,Note.curChangedSaveIt(),Note.clearAll();var n="/note/listNotes/",i={notebookId:t};if(Notebook.isTrashNotebookId(t))n="/note/listTrashNotes",i={};else if(Notebook.isAllNotebookId(t)){if(i={},cacheNotes=Note.getNotesByNotebookId(),!isEmpty(cacheNotes))return void(e?e(cacheNotes):Note.renderNotesAndFirstOneContent(cacheNotes,!0))}else{cacheNotes=Note.getNotesByNotebookId(t);var a=Notebook.cache[t],r=cacheNotes?cacheNotes.length:0;if(r==a.NumberNotes)return void(e?e(cacheNotes):Note.renderNotesAndFirstOneContent(cacheNotes,!0));Note.clearCacheByNotebookId(t),log("数量不一致")}o.showNoteAndEditorLoading(),o.changeNotebookSeq++,function(t){ajaxGet(n,i,function(n){return t!=o.changeNotebookSeq?(log("notebook changed too fast!"),void log(n)):(e?e(n):Note.renderNotesAndFirstOneContent(n,!1),void o.hideNoteAndEditorLoading())})}(o.changeNotebookSeq)},Notebook.showNoteAndEditorLoading=function(){$("#noteAndEditorMask").show()},Notebook.hideNoteAndEditorLoading=function(){$("#noteAndEditorMask").hide()},Notebook.isCurNotebook=function(t){return"active"==$(tt('#notebookList [notebookId="?"], #shareNotebooks [notebookId="?"]',t,t)).attr("class")},Notebook.changeNotebookForNewNote=function(t){if(!Notebook.isTrashNotebookId(t)&&!Notebook.isAllNotebookId(t)){Notebook.changeNotebookNav(t,!0),Notebook.curNotebookId=t;var e="/note/listNotes/",o={notebookId:t};ajaxGet(e,o,function(t){Note.renderNotes(t,!0)})}},Notebook.listNotebookShareUserInfo=function(t){var e=$(t).attr("notebookId");showDialogRemote("/share/listNotebookShareUserInfo",{notebookId:e})},Notebook.shareNotebooks=function(t){var e=$(t).text();showDialog("dialogShareNote",{title:"分享笔记本给好友-"+e}),setTimeout(function(){$("#friendsEmail").focus()},500);var o=$(t).attr("notebookId");shareNoteOrNotebook(o,!1)},Notebook.setNotebook2Blog=function(t){var e=$(t).attr("notebookId"),o=Notebook.cache[e],n=!0;void 0!=o.IsBlog&&(n=!o.IsBlog),Notebook.curNotebookId==e?n?$(".item").addClass("item-b"):$(".item").removeClass("item-b"):Notebook.curNotebookId==Notebook.allNotebookId&&$("#noteItemList .item").each(function(){var t=$(this).attr("noteId"),o=Note.cache[t];o.NotebookId==e&&(n?$(this).addClass("item-b"):$(this).removeClass("item-b"))}),ajaxPost("/notebook/setNotebook2Blog",{notebookId:e,isBlog:n},function(t){t&&(Note.setAllNoteBlogStatus(e,n),Notebook.setCache({NotebookId:e,IsBlog:n}))})},Notebook.updateNotebookTitle=function(t){var e=Notebook,o=$(t).attr("notebookId");e.tree2?e.tree2.editName(e.tree2.getNodeByTId(o)):e.tree.editName(e.tree.getNodeByTId(o))},Notebook.doUpdateNotebookTitle=function(t,e){var o=Notebook;ajaxPost("/notebook/updateNotebookTitle",{notebookId:t,title:e},function(n){if(Notebook.cache[t].Title=e,Notebook.changeNav(),o.tree2){var i=o.tree.getNodeByTId(t);i.Title=e,o.tree.updateNode(i)}})},Notebook.addNotebookSeq=1,Notebook.addNotebook=function(){var t=Notebook;$("#myNotebooks").hasClass("closed")&&$("#myNotebooks .folderHeader").trigger("click"),t.tree.addNodes(null,{Title:"",NotebookId:getObjectId(),IsNew:!0},!0,!0)},Notebook.doAddNotebook=function(t,e,o){var n=Notebook;ajaxPost("/notebook/addNotebook",{notebookId:t,title:e,parentNotebookId:o},function(e){if(e.NotebookId){Notebook.cache[e.NotebookId]=e;var o=n.tree.getNodeByTId(t);$.extend(o,e),o.IsNew=!1,Notebook.changeNotebook(t),Notebook.changeNav()}})},Notebook.addChildNotebook=function(t){var e=Notebook;$("#myNotebooks").hasClass("closed")&&$("#myNotebooks .folderHeader").trigger("click");var o=$(t).attr("notebookId");e.tree.addNodes(e.tree.getNodeByTId(o),{Title:"",NotebookId:getObjectId(),IsNew:!0},!1,!0)},Notebook.deleteNotebook=function(t){var e=Notebook,o=$(t).attr("notebookId");o&&ajaxGet("/notebook/deleteNotebook",{notebookId:o},function(t){t.Ok?(e.tree.removeNode(e.tree.getNodeByTId(o)),e.tree2&&e.tree2.removeNode(e.tree2.getNodeByTId(o)),delete Notebook.cache[o],Notebook.changeNav()):alert(t.Msg)})},$(function(){function t(t){var e=$(this).attr("notebookId"),o=Notebook.cache[e];if(o){var n=[];o.IsBlog?n.push("set2Blog"):n.push("unset2Blog"),Note.notebookHasNotes(e)&&n.push("delete"),t.applyrule({name:"target2",disable:!0,items:n})}}function e(){var t=$(this).attr("notebookId");return!Notebook.isTrashNotebookId(t)&&!Notebook.isAllNotebookId(t)}$("#minNotebookList").on("click","li",function(){var t=$(this).find("a").attr("notebookId");Notebook.changeNotebook(t)});var o={width:180,items:[{text:getMsg("shareToFriends"),alias:"shareToFriends",icon:"",faIcon:"fa-share-square-o",action:Notebook.listNotebookShareUserInfo},{type:"splitLine"},{text:getMsg("publicAsBlog"),alias:"set2Blog",faIcon:"fa-bold",action:Notebook.setNotebook2Blog},{text:getMsg("cancelPublic"),alias:"unset2Blog",faIcon:"fa-undo",action:Notebook.setNotebook2Blog},{type:"splitLine"},{text:getMsg("addChildNotebook"),faIcon:"fa-sitemap",action:Notebook.addChildNotebook},{text:getMsg("rename"),faIcon:"fa-pencil",action:Notebook.updateNotebookTitle},{text:getMsg("delete"),icon:"",alias:"delete",faIcon:"fa-trash-o",action:Notebook.deleteNotebook}],onShow:t,onContextMenu:e,parent:"#notebookList ",children:"li a"},n={width:180,items:[{text:getMsg("shareToFriends"),alias:"shareToFriends",icon:"",faIcon:"fa-share-square-o",action:Notebook.listNotebookShareUserInfo},{type:"splitLine"},{text:getMsg("publicAsBlog"),alias:"set2Blog",faIcon:"fa-bold",action:Notebook.setNotebook2Blog},{text:getMsg("cancelPublic"),alias:"unset2Blog",faIcon:"fa-undo",action:Notebook.setNotebook2Blog},{type:"splitLine"},{text:getMsg("rename"),icon:"",action:Notebook.updateNotebookTitle},{text:getMsg("delete"),icon:"",alias:"delete",faIcon:"fa-trash-o",action:Notebook.deleteNotebook}],onShow:t,onContextMenu:e,parent:"#notebookListForSearch ",children:"li a"};Notebook.contextmenu=$("#notebookList li a").contextmenu(o),Notebook.contextmenuSearch=$("#notebookListForSearch li a").contextmenu(n),$("#addNotebookPlus").on("click",function(t){t.stopPropagation(),Notebook.addNotebook()}),$("#notebookList").on("click",".notebook-setting",function(t){t.preventDefault(),t.stopPropagation();var e=$(this).parent();Notebook.contextmenu.showMenu(t,e)}),$("#notebookListForSearch").on("click",".notebook-setting",function(t){t.preventDefault(),t.stopPropagation();var e=$(this).parent();Notebook.contextmenuSearch.showMenu(t,e)})}),Share.defaultNotebookId="share0",Share.defaultNotebookTitle=getMsg("defaultShare"),Share.sharedUserInfos={},Share.userNavs={},Share.notebookCache={},Share.cache={},Share.dialogIsNote=!0,Share.setCache=function(t){t&&t.NoteId&&(Share.cache[t.NoteId]=t)},Share.getNotebooksForNew=function(t,e){for(var o=this,n="",i=e.length,a=0;a<i;++a){var r=e[a];r.IsShared=!0,r.UserId=t,o.notebookCache[r.NotebookId]=r,Notebook.cache[r.NotebookId]=r;var s="",l=!1;if(!isEmpty(r.Subs)){log(11),log(r.Subs);var l=o.getNotebooksForNew(t,r.Subs);l&&(s="dropdown-submenu")}var c="";if(r.Perm){var c=tt('<li role="presentation" class="clearfix ?" userId="?" notebookId="?"><div class="new-note-left pull-left" title="为该笔记本新建笔记" href="#">?</div><div title="为该笔记本新建markdown笔记" class="new-note-right pull-left">M</div>',s,t,r.NotebookId,r.Title);l&&(c+="<ul class='dropdown-menu'>",c+=l,c+="</ul>"),c+="</li>"}n+=c}return n},Share.trees={},Share.renderShareNotebooks=function(t,e){function o(t){}function n(){var t=$(this).attr("notebookId");return!Share.isDefaultNotebookId(t)}var i=Share;if(!isEmpty(t)){(!e||"object"!=typeof e||e.length<0)&&(e={});var a=$("#shareNotebooks");for(var r in t){var s=t[r],l=e[s.UserId]||[];userNotebooks=[{NotebookId:i.defaultNotebookId,Title:Share.defaultNotebookTitle}].concat(l),i.notebookCache[i.defaultNotebookId]=userNotebooks[0];var c=s.Username||s.Email;s.Username=c,Share.sharedUserInfos[s.UserId]=s;var d=s.UserId,h=tt('<li class="each-user"><div class="friend-header" fromUserId="?"><i class="fa fa-angle-down"></i><span>?</span> <span class="fa notebook-setting" title="setting"></span> </div>',s.UserId,c),u="friendContainer_"+d,f='<ul class="friend-notebooks ztree" id="'+u+'" fromUserId="'+d+'"></ul>';a.append(h+f+"</li>"),i.trees[d]=$.fn.zTree.init($("#"+u),Notebook.getTreeSetting(!0,!0),userNotebooks),i.userNavs[d]={forNew:i.getNotebooksForNew(d,l)},log(i.userNavs)}$(".friend-notebooks").hover(function(){$(this).hasClass("showIcon")||$(this).addClass("showIcon")},function(){$(this).removeClass("showIcon")}),$(".friend-header i").click(function(){var t=$(this),e=$(this).parent().next();e.is(":hidden")?(e.slideDown("fast"),t.removeClass("fa-angle-right fa-angle-down").addClass("fa-angle-down")):(e.slideUp("fast"),t.removeClass("fa-angle-right fa-angle-down").addClass("fa-angle-right"))});var g={width:180,items:[{text:getMsg("deleteSharedNotebook"),icon:"",faIcon:"fa-trash-o",action:Share.deleteShareNotebook}],onShow:o,onContextMenu:n,parent:"#shareNotebooks",children:".notebook-item"},p=$("#shareNotebooks").contextmenu(g),N={width:180,items:[{text:getMsg("deleteAllShared"),icon:"",faIcon:"fa-trash-o",action:Share.deleteUserShareNoteAndNotebook
}],parent:"#shareNotebooks",children:".friend-header"},m=$("#shareNotebooks").contextmenu(N);$(".friend-header").on("click",".notebook-setting",function(t){t.preventDefault(),t.stopPropagation();var e=$(this).parent();m.showMenu(t,e)}),$("#shareNotebooks .notebook-item").on("click",".notebook-setting",function(t){t.preventDefault(),t.stopPropagation();var e=$(this).parent();p.showMenu(t,e)})}},Share.isDefaultNotebookId=function(t){return Share.defaultNotebookId==t},Share.toggleToSharedNav=function(t,e){$("#curNotebookForListNote").html(Share.notebookCache[e].Title+"("+Share.sharedUserInfos[t].Username+")"),Note.listIsIn(!1,!1,!0);var o=Share.userNavs[t].forNew;if(o){$("#notebookNavForNewSharedNote").html(o);var n="",i="";if(Share.notebookCache[e].Perm)n=e,i=Share.notebookCache[e].Title;else{var a=$("#notebookNavForNewSharedNote li").eq(0);n=a.attr("notebookId"),i=a.find(".new-note-left").text()}$("#curNotebookForNewSharedNote").html(i+"("+Share.sharedUserInfos[t].Username+")"),$("#curNotebookForNewSharedNote").attr("notebookId",n),$("#curNotebookForNewSharedNote").attr("userId",t),$("#newSharedNote").show(),$("#newMyNote").hide()}else $("#newMyNote").show(),$("#newSharedNote").hide();$("#tagSearch").hide()},Share.firstRenderShareNote=function(t,e,o){$("#myShareNotebooks .folderHeader").trigger("click"),Notebook.expandNotebookTo(e,t),Share.changeNotebook(t,e,function(t){Note.renderNotes(t),Note.changeNoteForPjax(o,!1,!1)})},Share.changeNotebook=function(t,e,o){var n=this;Notebook.curNotebookId=e;var i=$(tt('#friendContainer_? a[notebookId="?"]',t,e));0==i.length?(Notebook.selectNotebook($(tt('#friendContainer_? a[notebookId="?"]',t,n.defaultNotebookId))),e=n.defaultNotebookId):Notebook.selectNotebook(i),Share.toggleToSharedNav(t,e),Note.curChangedSaveIt(),Note.clearAll();var a="/share/listShareNotes",r={userId:t};Share.isDefaultNotebookId(e)||(r.notebookId=e),ajaxGet(a,r,function(t){r.notebookId,o?o(t):(Note.renderNotes(t,!1,!0),isEmpty(t)||Note.changeNoteForPjax(t[0].NoteId,!0,!1))})},Share.hasUpdatePerm=function(t){var e=Share.cache[t];return e||(e=Note.getNote(t)),!(!e||!e.Perm)},Share.deleteShareNotebook=function(t){if(confirm("Are you sure to delete it?")){var e=$(t).attr("notebookId"),o=$(t).closest(".friend-notebooks").attr("fromUserId");ajaxGet("/share/DeleteShareNotebookBySharedUser",{notebookId:e,fromUserId:o},function(e){e&&$(t).parent().remove()})}},Share.deleteShareNote=function(t){var e=$(t).attr("noteId"),o=$(t).attr("fromUserId");ajaxGet("/share/DeleteShareNoteBySharedUser",{noteId:e,fromUserId:o},function(e){e&&$(t).remove()})},Share.deleteUserShareNoteAndNotebook=function(t){if(confirm("Are you sure to delete all shared notebooks and notes?")){var e=$(t).attr("fromUserId");ajaxGet("/share/deleteUserShareNoteAndNotebook",{fromUserId:e},function(e){e&&$(t).parent().remove()})}},Share.changeNotebookForNewNote=function(t){Notebook.selectNotebook($(tt('#shareNotebooks [notebookId="?"]',t)));var e=Share.notebookCache[t].UserId;Share.toggleToSharedNav(e,t);var o="/share/listShareNotes",n={userId:e,notebookId:t};ajaxGet(o,n,function(t){Note.renderNotes(t,!0,!0)})},Share.deleteSharedNote=function(t,e){Note.deleteNote(t,e,!0)},Share.copySharedNote=function(t,e){Note.copyNote(t,e,!0)},Share.contextmenu=null,Share.initContextmenu=function(t){function e(t){var e=$(this).attr("noteId"),o=Note.getNote(e),n=[];!Note.inBatch&&o||n.push("delete"),!o||o.Perm&&o.CreatedUserId==UserInfo.UserId||n.push("delete"),t.applyrule({name:"target...",disable:!0,items:n})}Share.contextmenu&&Share.contextmenu.destroy();var o={width:180,items:[{text:getMsg("copyToMyNotebook"),alias:"copy",faIcon:"fa-copy",type:"group",width:180,items:t},{type:"splitLine"},{text:getMsg("delete"),alias:"delete",icon:"",faIcon:"fa-trash-o",action:Share.deleteSharedNote}],onShow:e,parent:"#noteItemList",children:".item-shared"};Share.contextmenu=$("#noteItemList .item-shared").contextmenu(o)},$(function(){$("#noteItemList").on("click",".item-shared .item-setting",function(t){t.preventDefault(),t.stopPropagation();var e=$(this).parent();Share.contextmenu.showMenu(t,e)}),$("#newSharedNoteBtn").click(function(){var t=$("#curNotebookForNewSharedNote").attr("notebookId"),e=$("#curNotebookForNewSharedNote").attr("userId");Note.newNote(t,!0,e)}),$("#newShareNoteMarkdownBtn").click(function(){var t=$("#curNotebookForNewSharedNote").attr("notebookId"),e=$("#curNotebookForNewSharedNote").attr("userId");Note.newNote(t,!0,e,!0)}),$("#notebookNavForNewSharedNote").on("click","li div",function(){var t=$(this).parent().attr("notebookId"),e=$(this).parent().attr("userId");"M"==$(this).text()?Note.newNote(t,!0,e,!0):Note.newNote(t,!0,e)}),$("#leanoteDialogRemote").on("click",".change-perm",function(){var t=this,e=$(this).attr("perm"),o=$(this).attr("noteOrNotebookId"),n=$(this).attr("toUserId"),i=getMsg("writable"),a="1";"1"==e&&(i=getMsg("readOnly"),a="0");var r="/share/updateShareNotebookPerm",s={perm:a,toUserId:n};Share.dialogIsNote?(r="/share/updateShareNotePerm",s.noteId=o):s.notebookId=o,ajaxGet(r,s,function(e){e&&($(t).html(i),$(t).attr("perm",a))})}),$("#leanoteDialogRemote").on("click",".delete-share",function(){var t=this,e=$(this).attr("noteOrNotebookId"),o=$(this).attr("toUserId"),n="/share/deleteShareNotebook",i={toUserId:o};Share.dialogIsNote?(n="/share/deleteShareNote",i.noteId=e):i.notebookId=e,ajaxGet(n,i,function(e){e&&$(t).parent().parent().remove()})});var t=1;$("#leanoteDialogRemote").on("click","#addShareNotebookBtn",function(){t++;var e='<tr id="tr'+t+'"><td>#</td><td><input id="friendsEmail" type="text" class="form-control" style="width: 200px" placeholder="'+getMsg("friendEmail")+'"/></td>';e+='<td><label for="readPerm'+t+'"><input type="radio" name="perm'+t+'" checked="checked" value="0" id="readPerm'+t+'"> '+getMsg("readOnly")+"</label>",e+=' <label for="writePerm'+t+'"><input type="radio" name="perm'+t+'" value="1" id="writePerm'+t+'"> '+getMsg("writable")+"</label></td>",e+='<td><button class="btn btn-success" onclick="addShareNoteOrNotebook('+t+')">'+getMsg("share")+"</button>",e+=' <button class="btn btn-warning" onclick="deleteShareNoteOrNotebook('+t+')">'+getMsg("delete")+"</button>",e+="</td></tr>",$("#shareNotebookTable tbody").prepend(e),$("#tr"+t+" #friendsEmail").focus()}),$("#registerEmailBtn").click(function(){var t=$("#emailContent").val(),e=$("#toEmail").val();return t?void post("/user/sendRegisterEmail",{content:t,toEmail:e},function(t){showAlert("#registerEmailMsg",getMsg("sendSuccess"),"success"),hideDialog2("#sendRegisterEmailDialog",1e3)},this):void showAlert("#registerEmailMsg",getMsg("emailBodyRequired"),"danger")})}),editorMode.prototype.toggleAText=function(t){var e=this;setTimeout(function(){var o=$(".toggle-editor-mode a"),n=$(".toggle-editor-mode span");t?(o.attr("href","#"+e.normalHash),n.text(getMsg("normalMode"))):(o.attr("href","#"+e.writingHash),n.text(getMsg("writingMode")))},0)},editorMode.prototype.isWriting=function(t){return t||(t=location.hash),t.indexOf(this.writingHash)>=0},editorMode.prototype.init=function(){this.$themeLink=$("#themeLink"),this.changeMode(this.isWritingMode);var t=this;$(".toggle-editor-mode").on("click",function(e){e.preventDefault(),saveBookmark();var o=$(this).find("a"),n=t.isWriting(o.attr("href"));t.changeMode(n),n?setHash("m",t.writingHash):setHash("m",t.normalHash),restoreBookmark()})},editorMode.prototype.changeMode=function(t){this.toggleAText(t),t?this.writtingMode():this.normalMode()},editorMode.prototype.resizeEditor=function(){setTimeout(function(){resizeEditor()},10),setTimeout(function(){resizeEditor()},20),setTimeout(function(){resizeEditor()},500)},editorMode.prototype.normalMode=function(){$("#noteItemListWrap, #notesAndSort").show(),$("#noteList").off("mouseenter").off("mouseleave");var t=UserInfo.Theme||"default";t+=".css";$("#themeLink");this.$themeLink.attr("href").indexOf("writting-overwrite.css")!=-1&&this.$themeLink.attr("href",LEA.sPath+"/css/theme/"+t),$("#noteList").width(UserInfo.NoteListWidth),$("#note").css("left",UserInfo.NoteListWidth),this.isWritingMode=!1,this.resizeEditor()},editorMode.prototype.writtingMode=function(){Note.inBatch||(this.$themeLink.attr("href").indexOf("writting-overwrite.css")==-1&&this.$themeLink.attr("href",LEA.sPath+"/css/theme/writting-overwrite.css"),$("#noteItemListWrap, #notesAndSort").fadeOut(),$("#noteList").hover(function(){$("#noteItemListWrap, #notesAndSort").fadeIn()},function(){$("#noteItemListWrap, #notesAndSort").fadeOut()}),this.resizeEditor(),$("#noteList").width(250),$("#note").css("left",0),Note.toggleWriteable(),this.isWritingMode=!0)},editorMode.prototype.getWritingCss=function(){return this.isWritingMode?["/css/editor/editor-writting-mode.css"]:[]};var em=new editorMode;LEA.em=em;var Resize={lineMove:!1,mdLineMove:!1,target:null,leftNotebook:$("#leftNotebook"),notebookSplitter:$("#notebookSplitter"),noteList:$("#noteList"),noteAndEditor:$("#noteAndEditor"),noteSplitter:$("#noteSplitter"),note:$("#note"),body:$("body"),leftColumn:$("#left-column"),rightColumn:$("#right-column"),mdSplitter:$("#mdSplitter2"),init:function(){var t=this;t.initEvent()},initEvent:function(){var t=this;$(".noteSplit").on("mousedown",function(e){e.preventDefault(),t.lineMove=!0,$(this).css("background-color","#ccc"),t.target=$(this).attr("id"),$("#noteMask").css("z-index",99999)}),t.mdSplitter.on("mousedown",function(e){e.preventDefault(),$(this).hasClass("open")&&(t.mdLineMove=!0)}),t.body.on("mousemove",function(e){t.lineMove?(e.preventDefault(),t.resize3Columns(e)):t.mdLineMove&&(e.preventDefault(),t.resizeMdColumns(e))}),t.body.on("mouseup",function(e){t.stopResize(),$("#noteMask").css("z-index",-1)});var e;$(".layout-toggler-preview").on("click",function(){var o=$(this),n=t.leftColumn.parent();if(o.hasClass("open")){var i=n.width(),a=22,r=i-a;e=t.leftColumn.width(),t.leftColumn.width(r),t.rightColumn.css("left","auto").width(a),o.removeClass("open"),t.rightColumn.find(".layout-resizer").removeClass("open"),$(".preview-container").hide(),MD&&MD.resize()}else o.addClass("open"),t.rightColumn.find(".layout-resizer").addClass("open"),t.leftColumn.width(e),$(".preview-container").show(),t.rightColumn.css("left",e).width("auto"),MD&&MD.resize()})},stopResize:function(){var t=this;(t.lineMove||t.mdLineMove)&&ajaxGet("/user/updateColumnWidth",{mdEditorWidth:UserInfo.MdEditorWidth,notebookWidth:UserInfo.NotebookWidth,noteListWidth:UserInfo.NoteListWidth},function(){}),t.lineMove=!1,t.mdLineMove=!1,$(".noteSplit").css("background","none"),t.mdSplitter.css("background","none")},set3ColumnsWidth:function(t,e){var o=this;if(!(t<150||e<100)){var n=o.body.width()-t-e;n<400||(o.leftNotebook.width(t),o.notebookSplitter.css("left",t),o.noteAndEditor.css("left",t),o.noteList.width(e),o.noteSplitter.css("left",e),o.note.css("left",e),UserInfo.NotebookWidth=0|t,UserInfo.NoteListWidth=0|e)}},resize3Columns:function(t,e){var o=this;e&&(t.clientX+=o.body.width()-o.note.width());var n,i;o.lineMove&&("notebookSplitter"==o.target?(n=t.clientX,i=o.noteList.width(),o.set3ColumnsWidth(n,i)):(n=o.leftNotebook.width(),i=t.clientX-n,o.set3ColumnsWidth(n,i)),resizeEditor())},resizeMDInterval:null,resizeMdColumns:function(t){var e=this;if(e.mdLineMove){var o=t.clientX-e.leftColumn.offset().left;e.setMdColumnWidth(o),clearInterval(e.resizeMDInterval),e.resizeMDInterval=setTimeout(function(){MD.resize&&MD.resize()},50)}},setMdColumnWidth:function(t){var e=this,o=$("#note").width();t>100&&t<o-80&&(UserInfo.MdEditorWidth=t,e.leftColumn.width(t),e.rightColumn.css("left",t)),MD&&MD.onResize()}};Mobile={noteO:$("#note"),bodyO:$("body"),setMenuO:$("#setMenu"),hashChange:function(){var t=Mobile,e=location.hash;if(e.indexOf("noteId")!=-1){t.toEditor(!1);var o=e.substr(8);Note.changeNote(o,!1,!1)}else t.toNormal(!1)},init:function(){var t=this;t.isMobile()},isMobile:function(){var t=navigator.userAgent;return LEA.isMobile=!1,LEA.isMobile=/Mobile|Android|iPhone|iPad/i.test(t),LEA.isIpad=/iPad/i.test(t),LEA.isIphone=/iPhone/i.test(t),!LEA.isMobile&&$(document).width()<=700&&(LEA.isMobile=!0),LEA.isMobile},changeNote:function(t){var e=this;return!LEA.isMobile||(e.toEditor(!0,t),!1)},toEditor:function(t,e){var o=this;o.bodyO.addClass("full-editor"),o.noteO.addClass("editor-show")},toNormal:function(t){var e=this;e.bodyO.removeClass("full-editor"),e.noteO.removeClass("editor-show")},switchPage:function(){var t=this;return!(LEA.isMobile&&!LEA.isIpad)||(t.bodyO.hasClass("full-editor")?t.toNormal(!0):t.toEditor(!0),!1)}};var random=1;LEA.s3=new Date,console.log("initing..."),$(window).on("resize",function(){Mobile.isMobile(),resizeEditor()}),initEditor(),$(".folderHeader").on("click",function(){var t=$(this).next(),e=$(this).parent();t.is(":hidden")?($(".folderNote").removeClass("opened").addClass("closed"),e.removeClass("closed").addClass("opened"),$(this).find(".fa-angle-right").removeClass("fa-angle-right").addClass("fa-angle-down")):($(".folderNote").removeClass("opened").addClass("closed"),e.removeClass("opened").addClass("closed"),$(this).find(".fa-angle-down").removeClass("fa-angle-down").addClass("fa-angle-right"))}),$(".leanoteNav h1").on("click",function(t){var e=$(this).closest(".leanoteNav");e.hasClass("unfolder")?e.removeClass("unfolder"):e.addClass("unfolder")}),$("#wrongEmail").on("click",function(){openSetInfoDialog(1)}),$("#setTheme").on("click",function(){showDialog2("#setThemeDialog",{title:"主题设置",postShow:function(){UserInfo.Theme||(UserInfo.Theme="default"),$("#themeForm input[value='"+UserInfo.Theme+"']").attr("checked",!0)}})}),$("#themeForm").on("click","input",function(t){var e=$(this).val(),o=$("#themeLink").attr("href"),n=o.split("="),i=1;2==n.length&&(i=n[1]),$("#themeLink").attr("href",LEA.sPath+"/css/theme/"+e+".css?id="+i),ajaxPost("/user/updateTheme",{theme:e},function(t){reIsOk(t)&&(UserInfo.Theme=e)})}),$("#notebook, #newMyNote, #myProfile, #topNav, #notesAndSort","#leanoteNavTrigger").on("selectstart",function(t){return t.preventDefault(),!1});var $page=$("#page");$("#leftSwitcher2").on("click",function(){maxLeft(!0)}),$("#leftSwitcher").on("click",function(){Mobile.switchPage()&&minLeft(!0)}),$("#notebookMin div.minContainer").on("click",function(){var t=$(this).attr("target");maxLeft(!0),"#notebookList"==t?$("#myNotebooks").hasClass("closed")&&$("#myNotebooks .folderHeader").trigger("click"):"#tagNav"==t?$("#myTag").hasClass("closed")&&$("#myTag .folderHeader").trigger("click"):$("#myShareNotebooks").hasClass("closed")&&$("#myShareNotebooks .folderHeader").trigger("click")}),UserInfo.NotebookWidth=UserInfo.NotebookWidth||$("#notebook").width(),UserInfo.NoteListWidth=UserInfo.NoteListWidth||$("#noteList").width(),Resize.init(),Resize.set3ColumnsWidth(UserInfo.NotebookWidth,UserInfo.NoteListWidth),Resize.setMdColumnWidth(UserInfo.MdEditorWidth),Mobile.isMobile()?maxLeft(!1):UserInfo.LeftIsMin?minLeft(!1):maxLeft(!1),$(".dropdown").on("shown.bs.dropdown",function(){$(this).find("ul")}),em.init(),Mobile.init();var Pjax={init:function(){var t=this;window.addEventListener("popstate",function(e){var o=e.state;o&&(document.title=o.title||"Untitled",log("pop"),t.changeNotebookAndNote(o.noteId))},!1),history.pushState||$(window).on("hashchange",function(){var e=getHash("noteId");e&&t.changeNotebookAndNote(e)})},changeNotebookAndNote:function(t){var e=Note.getNote(t);if(e){var o=void 0!=e.Perm,n=e.NotebookId;return Notebook.curNotebookId==n?void Note.changeNoteForPjax(t,!1):void(o?Share.changeNotebook(e.UserId,n,function(e){Note.renderNotes(e),Note.changeNoteForPjax(t,!1,!0)}):Notebook.changeNotebook(n,function(e){Note.renderNotes(e),Note.changeNoteForPjax(t,!1,!0)}))}},changeNote:function(t){var e=t.NoteId,o=t.Title,n="/note/"+e;if(location.href.indexOf("?online")>0&&(n+="?online="+/online=([0-9])/.exec(location.href)[1]),location.hash&&(n+=location.hash),history.pushState){var i={url:n,noteId:e,title:o};history.pushState(i,o,n),document.title=o||"Untitled"}else setHash("noteId",e)}};$(function(){Pjax.init()}),LeaAce={_aceId:0,_aceEditors:{},_isInit:!1,_canAce:!1,isAce:!0,disableAddHistory:function(){tinymce.activeEditor.undoManager.setCanAdd(!1)},resetAddHistory:function(){tinymce.activeEditor.undoManager.setCanAdd(!0)},canAce:function(){return this._isInit?this._canAce:("webkit"!=getVendorPrefix()||Mobile.isMobile()?this._canAce=!1:this._canAce=!0,this._isInit=!0,this._canAce)},canAndIsAce:function(){return this.canAce()&&this.isAce},getAceId:function(){return this.aceId++,"leanote_ace_"+(new Date).getTime()+"_"+this._aceId},initAce:function(t,e,o){var n=this;if(o||n.canAndIsAce()){var i=$("#"+t);if(0!=i.length){var a=i.html();try{n.disableAddHistory();var r=i.attr("class")||"",s=r.indexOf("brush:html")!=-1;(i.attr("style")||!s&&i.html().indexOf("<style>")!=-1)&&i.html(i.text()),i.attr("tabindex")||i.attr("tabindex",-1),i.find(".toggle-raw").remove();i.html();i.removeClass("ace-to-pre"),i.attr("contenteditable",!1);var l=ace.edit(t);l.container.style.lineHeight=1.5,l.setTheme("ace/theme/tomorrow");var c=n.getPreBrush(i),d="";if(c)try{d=c.split(":")[1]}catch(h){}return d&&"false"!==d||(d="javascript"),l.session.setMode("ace/mode/"+d),l.session.setOption("useWorker",!1),2==window.devicePixelRatio?l.setFontSize("12px"):l.setFontSize("14px"),l.getSession().setUseWorker(!1),l.setOption("showInvisibles",!1),l.setShowInvisibles(!1),l.setOption("wrap","free"),l.setShowInvisibles(!1),l.setReadOnly(Note.readOnly),l.setAutoScrollEditorIntoView(!0),l.setOption("maxLines",1e4),l.commands.addCommand({name:"undo",bindKey:{win:"Ctrl-z",mac:"Command-z"},exec:function(t){var e=t.getSession().getUndoManager();e.hasUndo()?e.undo():(e.reset(),tinymce.activeEditor.undoManager.undo())}}),this._aceEditors[t]=l,e&&l.setValue(e),n.resetAddHistory(),l}catch(h){console.error("ace error!!!!"),console.error(h),i.attr("contenteditable",!0),i.removeClass("ace-tomorrow ace_editor ace-tm"),i.html(a),n.resetAddHistory()}}}},clearIntervalForInitAce:null,initAceFromContent:function(t){if(!this.canAndIsAce()){var e=$(t.getBody());return void e.find("pre").removeClass("ace_editor")}var o=this;this.clearIntervalForInitAce&&clearInterval(this.clearIntervalForInitAce),this.clearIntervalForInitAce=setTimeout(function(){for(var e=$(t.getBody()),n=e.find("pre"),i=0;i<n.length;++i){var a=n.eq(i),r=o.isInAce(a);if(r){if(!isAceError(r[0].getValue()))break;console.error("之前有些没有destroy掉")}setTimeout(function(t){return function(){t.find(".toggle-raw").remove();var e=t.html();e=e.replace(/ /g,"&nbsp;").replace(/\<br *\/*\>/gi,"\n").replace(/</g,"&lt;").replace(/>/g,"&gt;"),t.html(e);var n=t.attr("id");n||(n=o.getAceId(),t.attr("id",n)),o.initAce(n)}}(a))}},10)},allToPre:function(t){if(this.canAndIsAce()){var e=this;e.clearIntervalForInitAce&&clearInterval(e.clearIntervalForInitAce),e.clearIntervalForInitAce=setTimeout(function(){for(var o=$(t.getBody()),n=o.find("pre"),i=0;i<n.length;++i){var a=n.eq(i);setTimeout(function(t){return function(){e.aceToPre(t)}}(a))}},10)}},undo:function(t){if(this.canAndIsAce()){var e=this;this.clearIntervalForInitAce&&clearInterval(this.clearIntervalForInitAce),this.clearIntervalForInitAce=setTimeout(function(){for(var o=$(t.getBody()),n=o.find("pre"),i=0;i<n.length;++i){var a=n.eq(i);setTimeout(function(t){return function(){var o=t.html(),n=t.attr("id"),i=e.getAce(n);if(i){var o=i.getValue();i.destroy();var i=e.initAce(n,o);i.selection.clearSelection()}else{o=o.replace(/ /g,"&nbsp;").replace(/\<br *\/*\>/gi,"\n"),t.html(o);var n=t.attr("id");n||(n=e.getAceId(),t.attr("id",n)),e.initAce(n)}}}(a))}},10)}},destroyAceFromContent:function(t){if(this.canAce())for(var e=t.find("pre"),o=0;o<e.length;++o){var n=e.eq(o).attr("id"),i=this.getAce(n);i&&(i.destroy(),this._aceEditors[n]=null)}},getAce:function(t){if(this.canAce())return this._aceEditors[t]},setAceReadOnly:function(t,e){var o=this;if("object"==typeof t)var n=t.attr("id");else var n=t;var i=o.getAce(n);i&&i.setReadOnly(e)},nowIsInAce:function(){if(this.canAce()){var t=tinymce.activeEditor.selection.getNode();return this.isInAce(t)}},nowIsInPre:function(){var t=tinymce.activeEditor.selection.getNode();return this.isInPre(t)},isInPre:function(t){var e=$(t),t=e.get(0);return"PRE"==t.nodeName||($pre=e.closest("pre"),0!=$pre.length)},isInAce:function(t){if(this.canAce()){var e=$(t),t=e.get(0);if("PRE"==t.nodeName){var o=e.attr("id"),n=this.getAce(o);return!!n&&[n,e]}return $pre=e.closest("pre"),0!=$pre.length&&this.isInAce($pre)}},getPreBrush:function(t){var e=$(t),o=e.attr("class");if(!o)return"";var n=o.match(/brush:[^ ]*/),i="";return n&&n.length>0&&(i=n[0]),i},preToAce:function(t,e){if(e||this.canAce()){var o=$(t),n=this.getAceId();o.attr("id",n);var i=this.initAce(n,"",!0);i&&i.focus()}},aceToPre:function(t,e){var o=this,n=$(t),i=o.isInAce(n);if(i){var a=i[0],n=i[1],r=a.getValue();isAceError(r)&&(r=n.html()),r=r.replace(/</g,"&lt").replace(/>/g,"&gt");var s=$('<pre class="'+n.attr("class")+' ace-to-pre">'+r+"</pre>");n.replaceWith(s),a.destroy(),o._aceEditors[n.attr("id")]=null,e&&setTimeout(function(){var t=tinymce.activeEditor,e=t.selection,o=e.getRng();o.selectNode(s.get(0)),t.focus(),s.trigger("click"),s.html(r+" ")},0)}},removeAllToggleRaw:function(){$("#editorContent .toggle-raw").remove()},removeCurToggleRaw:function(){if(this.curToggleRaw)try{this.curToggleRaw.remove()}catch(t){}},curToggleRaw:null,handleEvent:function(){if(this.canAce()){var t=this;$("#editorContent").on("mouseenter","pre",function(e){var o=$(this);if($raw=o.find(".toggle-raw"),0==$raw.length){var n=$('<div class="toggle-raw" title="Toggle code with raw html"><input type="checkbox" /></div>');o.append(n),t.curToggleRaw=n}$input=o.find(".toggle-raw input"),LeaAce.isInAce(o)?$input.prop("checked",!0):$input.prop("checked",!1)}),$("#editorContent").on("mouseleave","pre",function(){var t=$(this).find(".toggle-raw");t.remove()}),$("#editorContent").on("change",".toggle-raw input",function(){var e=$(this).prop("checked"),o=$(this).closest("pre");e?t.preToAce(o,!0):t.aceToPre(o,!0)});var e;$("#editorContent").on("keyup","pre",function(o){var n=o.keyCode;if(8==n||46==n)if(e){var i=(new Date).getTime();if(i-e<300){var a=t.isInAce($(this));if(a&&!a[0].getValue())return a[0].destroy(),void $(this).remove()}e=i}else e=(new Date).getTime()}),$("#editorContent").on("mousedown","pre",function(e){var o=t.isInAce($(this));if(o){var n=o[0];n.focus(),e.preventDefault(),e.stopPropagation()}})}}};var _topInfoStart=(new Date).getTime();
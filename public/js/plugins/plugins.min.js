define("note_info",[],function(){var e=["<table>","<tr><th>"+getMsg("Create Time")+'</th><td id="noteInfoCreatedTime"></td></tr>',"<tr><th>"+getMsg("Update Time")+'</th><td id="noteInfoUpdatedTime"></td></tr>','<tr class="post-url-tr">',"<th>"+getMsg("Post Url")+"</th>","<td>",'<div class="post-url-wrap">','<span class="post-url-base">http://blog.leanote.com/life/post/</span><span><span class="post-url-text">life-life-life-a-leanote</span>','<input type="text" class="form-control">',"</span>",' <a class="post-url-pencil" title="'+getMsg("update")+'"><i class="fa fa-pencil"></i></a>',"</div>","</td>","</tr>","</table>"].join(""),t=$(e),i=t.find("#noteInfoCreatedTime"),n=t.find("#noteInfoUpdatedTime"),o=(t.find("#noteInfoPostUrl"),t.find(".post-url-tr")),r=t.find(".post-url-wrap"),a=t.find("input"),s=t.find(".post-url-base"),l=t.find(".post-url-text"),d={$noteInfo:$("#noteInfo"),note:null,bind:function(){var e=this;$("#noteInfoDropdown").on("click",function(){e.render()}),t.find(".post-url-pencil").on("click",function(){r.addClass("post-url-edit"),a.val(decodeURI(e.note.UrlTitle)),a.focus()}),a.on("keydown",function(e){13===e.keyCode&&a.blur()}),a.on("blur",function(){r.removeClass("post-url-edit");var t=a.val();t&&ajaxPost("/member/blog/updateBlogUrlTitle",{noteId:e.note.NoteId,urlTitle:t},function(t){if(reIsOk(t)){var i=encodeURI(t.Item);e.note.UrlTitle=i,l.text(decodeURI(e.note.UrlTitle))}else alert(t.Msg||"error")})}),LEA.on("noteChanged",function(t){e.render(t)})},getPostUrl:function(e){return""},rendered:!1,render:function(e){var r=this;e||(e=Note.getCurNote()),e&&(r.note=e,i.html(goNowToDatetime(e.CreatedTime)),n.html(goNowToDatetime(e.UpdatedTime)),e.IsBlog?(o.removeClass("hide"),s.text(UserInfo.PostUrl+"/"),l.text(decodeURI(e.UrlTitle))):o.addClass("hide"),r.rendered||(r.$noteInfo.html(t),r.rendered=!0))},init:function(){this.bind()}};d.init()}),define("tips",[],function(){var e=['<div class="modal fade bs-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">','<div class="modal-dialog modal-sm">','<div class="modal-content">','<div class="modal-header">','<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>','<h4 class="modal-title" class="modalTitle">'+getMsg("editorTips")+"</h4>","</div>",'<div class="modal-body">'+getMsg("editorTipsInfo")+"</div>",'<div class="modal-footer">','<button type="button" class="btn btn-default" data-dismiss="modal">'+getMsg("close")+"</button>","</div>","</div>","</div>","</div>"].join(""),t=$(e),i={init:function(){$("#tipsBtn").click(function(){t.modal({show:!0})})}};i.init()}),define("history",[],function(){var e=['<div class="modal fade history-modal" tabindex="-1" role="dialog" aria-hidden="true">','<div class="modal-dialog modal-lg ">','<div class="modal-content">','<div class="modal-header">','<h4 class="modal-title" class="modalTitle">NaN',"</div>",'<div class="modal-body clearfix">','<div class="history-list-wrap pull-left">','<div class="history-list-header">'+getMsg("history")+' (<span class="history-num"></span>)</div>','<div class="history-list list-group"></div>',"</div>",'<div class="history-content-wrap pull-left">','<div class="history-content-header">','<a class="btn btn-primary back">'+getMsg("restoreFromThisVersion")+"</a>",'<a class="btn btn-primary delete">'+getMsg("deleteThisHistoryVersion")+"</a>",'<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>',"</div>",'<div class="history-content"></div>',"</div>","</div>",'<div class="modal-footer hide">','<button type="button" class="btn btn-default" data-dismiss="modal">'+getMsg("close")+"</button>","</div>","</div>","</div>","</div>"].join(""),t=$(e),i=t.find(".history-content"),n=t.find(".history-list"),o=t.find(".history-num"),r={note:null,list:[],curIndex:0,renderContent:function(e){var t=this.list[e].Content;this.curIndex=e;var o="<div>",r="</div>";this.note.IsMarkdown&&(o="<pre>",r="</pre>",t=trimTitle(t)),i.html(o+t+r);var a=n.find("a");a.removeClass("active"),a.eq(e).addClass("active")},render:function(e){var i="";if(this.list=e,e)for(var r=0;r<e.length;++r){var a=e[r];i+='<a class="list-group-item" data-index="'+r+'"><span class="badge">#'+(e.length-r)+"</span>"+goNowToDatetime(a.UpdatedTime)+"</a>"}n.html(i),this.renderContent(0),o.html(e.length),t.modal({show:!0})},bind:function(){var e=this;$("#contentHistory").click(function(){e.getHistories()}),n.on("click","a",function(){var t=$(this).data("index");e.renderContent(t)}),t.find(".back").click(function(){confirm(getMsg("confirmBackup"))&&(Note.curChangedSaveIt(!0),note=Note.cache[Note.curNoteId],setEditorContent(e.list[e.curIndex].Content,note.IsMarkdown),t.modal("hide"),Note.curChangedSaveIt(!0))}),t.find(".delete").click(function(){confirm(getMsg("confirmHistoryDelete"))&&ajaxPost("/noteContentHistory/deleteHistory",{noteId:Note.curNoteId,userId:Note.cache[Note.curNoteId].UserId,timeToDel:e.list[e.curIndex].UpdatedTime},function(t){e.getHistories()})})},getHistories:function(){var e=this,i=Note.getCurNote();e.note=i,ajaxGet("/noteContentHistory/listHistories",{noteId:Note.curNoteId},function(i){return!isArray(i)||i.length<1?(alert(getMsg("noHistories")),void t.modal("hide")):void e.render(i)})},init:function(){this.bind()}};r.init()});var urlPrefix=UrlPrefix;define("attachment_upload",["fileupload"],function(){function e(e){return"number"!=typeof e?"":e>=1e9?(e/1e9).toFixed(2)+" GB":e>=1e6?(e/1e6).toFixed(2)+" MB":(e/1e3).toFixed(2)+" KB"}function t(e,t){var i=$(e);$(t).bind("dragover",function(e){e.preventDefault();var t=window.dropZoneTimeoutAttach;t&&clearTimeout(t);var n=!1,o=e.target;do{if(o===i[0]){n=!0;break}o=o.parentNode}while(null!=o);n?i.addClass("hover"):i.removeClass("hover"),window.dropZoneTimeoutAttach=setTimeout(function(){window.dropZoneTimeoutAttach=null,i.removeClass("in hover")},100)})}t("#dropAttach","#uploadAttach");var i=function(){$(".dropzone .btn-choose-file").click(function(){$(this).parent().find("input").click()});var t=$("#attachUploadMsg");$("#uploadAttach").fileupload({dataType:"json",pasteZone:"",dropZone:$("#dropAttach"),formData:function(e){return[{name:"noteId",value:Note.curNoteId}]},add:function(i,n){var o=Note.getCurNote();if(!o||o.IsNew)return void alert("This note hasn't saved, please save it firstly!");var r=$('<div class="alert alert-info"><img class="loader" src="/images/ajax-loader.gif"> <a class="close" data-dismiss="alert">×</a></div>');r.append(n.files[0].name+" <small>[<i>"+e(n.files[0].size)+"</i>]</small>"),t.html(r),n.context=t;var a=n.files[0].size,s=+GlobalConfigs.uploadAttachSize||100;if("number"==typeof a&&a>1048576*s)return r.find("img").remove(),r.removeClass("alert-info").addClass("alert-danger"),r.append(" Warning: File size is bigger than "+s+"M"),void setTimeout(function(e){return function(){e.remove()}}(r),3e3);var l;setTimeout(function(){l=n.submit()},10)},done:function(t,i){if(1==i.result.Ok)i.context.html(""),Attach.addAttach(i.result.Item);else{i.result;i.context.html("");var n=$('<div class="alert alert-danger"><a class="close" data-dismiss="alert">×</a></div>');n.append("<b>Error:</b> "+i.files[0].name+" <small>[<i>"+e(i.files[0].size)+"</i>]</small> "+i.result.Msg),i.context.html(n),setTimeout(function(e){return function(){e.remove()}}(n),3e3)}$("#uploadAttachMsg").scrollTop(1e3)},fail:function(t,i){i.context.html("");var n=$('<div class="alert alert-danger"><a class="close" data-dismiss="alert">×</a></div>');n.append("<b>Error:</b> "+i.files[0].name+" <small>[<i>"+e(i.files[0].size)+"</i>]</small> "+i.errorThrown),i.context.html(n),setTimeout(function(e){return function(){e.remove()}}(n),3e3),$("#uploadAttachMsg").scrollTop(1e3)}})};i()}),define("editor_drop_paste",["fileupload"],function(){function e(){var e=$("#editorContent").children(),t=e&&e.length>0?e[e.length-1]:null;t&&"P"==t.tagName||$("#editorContent").append('<p><br data-mce-bogus="1"></p>')}function t(t){var i="__mcenew"+(new Date).getTime(),n='<div contenteditable="false" id="'+i+'" class="leanote-image-container"><img class="loader" src="/images/ajax-loader.gif"><div class="progress"><div class="progress-bar progress-bar-success progress-bar-striped" role="progressbar" aria-valuenow="2" aria-valuemin="0" aria-valuemax="100" style="width: 0%;">0%</div></div></div>';this.containerStr=n,t.insertContent(n),e();var o=$("#"+i);this.container=o,this.id=i,this.processBar=o.find(".progress-bar")}function i(e,t){function i(e,i){n.parentNode.removeChild(n),t({width:e,height:i})}var n=document.createElement("img");n.onload=function(){i(n.clientWidth,n.clientHeight)},n.onerror=function(){i()},n.src=e;var o=n.style;o.visibility="hidden",o.position="fixed",o.bottom=o.left=0,o.width=o.height="auto",document.body.appendChild(n)}function n(e){var t=tinymce.activeEditor,n=t.dom,r=function(t){function r(e){e&&e.width&&(e.width>600&&(e.width=600),t.width=e.width,n.setAttrib(a,"width",t.width)),n.setAttrib(a,"src",t.src),t.title&&n.setAttrib(a,"title",t.title),n.setAttrib(a,"id",null)}var a,s={};s.id="__mcenew"+o++,s.src="/images/loading-24.gif",a=n.createHTML("img",s),tinymce.activeEditor.insertContent(a),a=n.get(s.id),i(e.src,r)},a="";if(fileIds=e.src.split("fileId="),2==fileIds.length&&fileIds[1].length=="53aecf8a8a039a43c8036282".length&&(a=fileIds[1]),a){var s=Note.getCurNote();s&&s.UserId!=UserInfo.UserId?!function(e){ajaxPost("/file/copyImage",{userId:UserInfo.UserId,fileId:a,toUserId:s.UserId},function(t){reIsOk(t)&&t.Id&&(e.src="/api/file/getImage?fileId="+t.Id),r(e)})}(e):r(e)}else r(e)}t.prototype.update=function(e){var t=this;e=Math.ceil(100*e),e>=100&&(e=99),e+="%",$("#"+t.id+" .progress-bar").html(e).css("width",e)},t.prototype.replace=function(e){var t=this;i(e,function(){$("#"+t.id).replaceWith('<img src="'+e+'" />')})},t.prototype.remove=function(){var e=this;$("#"+e.id).remove()};var o=1,r=function(){function e(e){return"number"!=typeof e?"":e>=1e9?(e/1e9).toFixed(2)+" GB":e>=1e6?(e/1e6).toFixed(2)+" MB":(e/1e3).toFixed(2)+" KB"}function t(){$("#upload").css("z-index",12);var e=+$("#mceToolbar").css("height").slice(0,-2);$("#upload").css("top",e-8),$("#upload").show()}function i(){$("#upload").css("z-index",0).css("top","auto").hide()}var o=$("#upload ul");$("#drop a").click(function(){$(this).parent().find("input").click()}),$("#upload").fileupload({dataType:"json",pasteZone:"",acceptFileTypes:/(\.|\/)(gif|jpg|jpeg|png|jpe)$/i,maxFileSize:21e4,dropZone:$("#drop"),formData:function(e){return[{name:"albumId",value:""}]},add:function(t,i){var n=$('<li><div class="alert alert-info"><img class="loader" src="/images/ajax-loader.gif"> <a class="close" data-dismiss="alert">×</a></div></li>');n.find("div").append(i.files[0].name+" <small>[<i>"+e(i.files[0].size)+"</i>]</small>"),i.context=n.appendTo(o);i.submit()},done:function(t,i){if(1==i.result.Ok){i.context.remove();var o={src:"/api/file/getImage?fileId="+i.result.Id};n(o)}else{i.context.empty();var r=$('<li><div class="alert alert-danger"><a class="close" data-dismiss="alert">×</a></div></li>');r.find("div").append("<b>"+getMsg("Error")+":</b> "+i.files[0].name+" <small>[<i>"+e(i.files[0].size)+"</i>]</small> "+i.result.Msg),i.context.append(r),setTimeout(function(e){return function(){e.remove()}}(r),2e3)}$("#uploadMsg").scrollTop(1e3)},fail:function(t,i){i.context.empty();var n=$('<li><div class="alert alert-danger"><a class="close" data-dismiss="alert">×</a></div></li>');n.find("div").append("<b>"+getMsg("Error")+":</b> "+i.files[0].name+" <small>[<i>"+e(i.files[0].size)+"</i>]</small> "+i.errorThrown),i.context.append(n),setTimeout(function(e){return function(){e.remove()}}(n),2e3),$("#uploadMsg").scrollTop(1e3)}}),$(document).on("drop dragover",function(e){e.preventDefault()}),$(document).bind("dragover",function(e){var n=$("#drop"),o=window.dropZoneTimeout;o?clearTimeout(o):(n.addClass("in"),t());var r=!1,a=e.target;do{if(a===n[0]){r=!0;break}a=a.parentNode}while(null!=a);r?(n.addClass("hover"),LEA.readOnly&&LEA.toggleWriteable()):n.removeClass("hover"),window.dropZoneTimeout=setTimeout(function(){window.dropZoneTimeout=null,n.removeClass("in hover"),i()},500)})},a=0,s=function(){var e,i;$("#editorContent, #left-column").fileupload({dataType:"json",pasteZone:$("#editorContent, #left-column"),dropZone:"",maxFileSize:21e4,url:"/file/pasteImage",paramName:"file",formData:function(e){return[{name:"from",value:"pasteImage"},{name:"noteId",value:Note.curNoteId}]},progress:function(t,i){e&&!e.IsMarkdown&&i.process.update(i.loaded/i.total)},add:function(n,o){var r=(new Date).getTime();if(!(r-a<500)){a=r;var s=Note.getCurNote();e=s,!s||s.IsNew,setTimeout(function(){if(i=tinymce.EditorManager.activeEditor,!s.IsMarkdown)var e=new t(i);o.process=e;o.submit()},20)}},done:function(t,i){if(1==i.result.Ok){var n=i.result,o="/api/file/getImage?fileId="+n.Id;e&&!e.IsMarkdown?i.process.replace(o):MD&&MD.insertLink(o,"title",!0)}else i.process.remove()},fail:function(t,i){e&&!e.IsMarkdown&&i.process.remove()}})};r(),s()}),requirejs.config({paths:{editor_drop_paste:"js/plugins/editor_drop_paste",attachment_upload:"js/plugins/attachment_upload",fileupload:"js/plugins/fileupload.min",note_info:"js/plugins/note_info",tips:"js/plugins/tips",history:"js/plugins/history"},shim:{}}),setTimeout(function(){require(["editor_drop_paste","attachment_upload"]),require(["note_info"]),setTimeout(function(){require(["tips"]),require(["history"])},10)}),!function(e){"use strict";e(window.jQuery)}(function(e){"use strict";var t=0;e.ajaxTransport("iframe",function(i){if(i.async){var n,o,r;return{send:function(a,s){n=e('<form style="display:none;"></form>'),n.attr("accept-charset",i.formAcceptCharset),r=/\?/.test(i.url)?"&":"?","DELETE"===i.type?(i.url=i.url+r+"_method=DELETE",i.type="POST"):"PUT"===i.type?(i.url=i.url+r+"_method=PUT",i.type="POST"):"PATCH"===i.type&&(i.url=i.url+r+"_method=PATCH",i.type="POST"),o=e('<iframe src="javascript:false;" name="iframe-transport-'+(t+=1)+'"></iframe>').bind("load",function(){var t,r=e.isArray(i.paramName)?i.paramName:[i.paramName];o.unbind("load").bind("load",function(){var t;try{if(t=o.contents(),!t.length||!t[0].firstChild)throw new Error}catch(i){t=void 0}s(200,"success",{iframe:t}),e('<iframe src="javascript:false;"></iframe>').appendTo(n),n.remove()}),n.prop("target",o.prop("name")).prop("action",i.url).prop("method",i.type),i.formData&&e.each(i.formData,function(t,i){e('<input type="hidden"/>').prop("name",i.name).val(i.value).appendTo(n)}),i.fileInput&&i.fileInput.length&&"POST"===i.type&&(t=i.fileInput.clone(),i.fileInput.after(function(e){return t[e]}),i.paramName&&i.fileInput.each(function(t){e(this).prop("name",r[t]||i.paramName)}),n.append(i.fileInput).prop("enctype","multipart/form-data").prop("encoding","multipart/form-data")),n.submit(),t&&t.length&&i.fileInput.each(function(i,n){var o=e(t[i]);e(n).prop("name",o.prop("name")),o.replaceWith(n)})}),n.append(o).appendTo(document.body)},abort:function(){o&&o.unbind("load").prop("src","javascript".concat(":false;")),n&&n.remove()}}}}),e.ajaxSetup({converters:{"iframe text":function(t){return t&&e(t[0].body).text()},"iframe json":function(t){return t&&e.parseJSON(e(t[0].body).text())},"iframe html":function(t){return t&&e(t[0].body).html()},"iframe script":function(t){return t&&e.globalEval(e(t[0].body).text())}}})}),function(e){e(jQuery)}(function(e,t){var i=0,n=Array.prototype.slice,o=e.cleanData;e.cleanData=function(t){for(var i,n=0;null!=(i=t[n]);n++)try{e(i).triggerHandler("remove")}catch(r){}o(t)},e.widget=function(t,i,n){var o,r,a,s,l={},d=t.split(".")[0];t=t.split(".")[1],o=d+"-"+t,n||(n=i,i=e.Widget),e.expr[":"][o.toLowerCase()]=function(t){return!!e.data(t,o)},e[d]=e[d]||{},r=e[d][t],a=e[d][t]=function(e,t){return this._createWidget?void(arguments.length&&this._createWidget(e,t)):new a(e,t)},e.extend(a,r,{version:n.version,_proto:e.extend({},n),_childConstructors:[]}),s=new i,s.options=e.widget.extend({},s.options),e.each(n,function(e,t){return"function"!=typeof t?void(l[e]=t):void(l[e]=function(){var n=function(){return i.prototype[e].apply(this,arguments)},o=function(t){return i.prototype[e].apply(this,t)};return function(){var e,i=this._super,r=this._superApply;return this._super=n,this._superApply=o,e=t.apply(this,arguments),this._super=i,this._superApply=r,e}}())}),a.prototype=e.widget.extend(s,{widgetEventPrefix:r?s.widgetEventPrefix:t},l,{constructor:a,namespace:d,widgetName:t,widgetFullName:o}),r?(e.each(r._childConstructors,function(t,i){var n=i.prototype;e.widget(n.namespace+"."+n.widgetName,a,i._proto)}),delete r._childConstructors):i._childConstructors.push(a),e.widget.bridge(t,a)},e.widget.extend=function(i){for(var o,r,a=n.call(arguments,1),s=0,l=a.length;s<l;s++)for(o in a[s])r=a[s][o],a[s].hasOwnProperty(o)&&r!==t&&(e.isPlainObject(r)?i[o]=e.isPlainObject(i[o])?e.widget.extend({},i[o],r):e.widget.extend({},r):i[o]=r);return i},e.widget.bridge=function(i,o){var r=o.prototype.widgetFullName||i;e.fn[i]=function(a){var s="string"==typeof a,l=n.call(arguments,1),d=this;return a=!s&&l.length?e.widget.extend.apply(null,[a].concat(l)):a,s?this.each(function(){var n,o=e.data(this,r);return o?"function"!=typeof o[a]||"_"===a.charAt(0)?e.error("no such method '"+a+"' for "+i+" widget instance"):(n=o[a].apply(o,l),n!==o&&n!==t?(d=n&&n.jquery?d.pushStack(n.get()):n,!1):void 0):e.error("cannot call methods on "+i+" prior to initialization; attempted to call method '"+a+"'")}):this.each(function(){var t=e.data(this,r);t?t.option(a||{})._init():e.data(this,r,new o(a,this))}),d}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,n){n=e(n||this.defaultElement||this)[0],this.element=e(n),this.uuid=i++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this.bindings=e(),this.hoverable=e(),this.focusable=e(),n!==this&&(e.data(n,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===n&&this.destroy()}}),this.document=e(n.style?n.ownerDocument:n.document||n),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.off(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().off(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(i,n){var o,r,a,s=i;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof i)if(s={},o=i.split("."),i=o.shift(),o.length){for(r=s[i]=e.widget.extend({},this.options[i]),a=0;a<o.length-1;a++)r[o[a]]=r[o[a]]||{},r=r[o[a]];if(i=o.pop(),n===t)return r[i]===t?null:r[i];r[i]=n}else{if(n===t)return this.options[i]===t?null:this.options[i];s[i]=n}return this._setOptions(s),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!t).attr("aria-disabled",t),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(t,i,n){var o,r=this;"boolean"!=typeof t&&(n=i,i=t,t=!1),n?(i=o=e(i),this.bindings=this.bindings.add(i)):(n=i,i=this.element,o=this.widget()),e.each(n,function(n,a){function s(){if(t||r.options.disabled!==!0&&!e(this).hasClass("ui-state-disabled"))return("string"==typeof a?r[a]:a).apply(r,arguments)}"string"!=typeof a&&(s.guid=a.guid=a.guid||s.guid||e.guid++);var l=n.match(/^(\w+)\s*(.*)$/),d=l[1]+r.eventNamespace,u=l[2];u?o.delegate(u,d,s):i.on(d,s)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.off(t).undelegate(t)},_delay:function(e,t){function i(){return("string"==typeof e?n[e]:e).apply(n,arguments)}var n=this;return setTimeout(i,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,i,n){var o,r,a=this.options[t];if(n=n||{},i=e.Event(i),i.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),i.target=this.element[0],r=i.originalEvent)for(o in r)o in i||(i[o]=r[o]);return this.element.trigger(i,n),!("function"==typeof a&&a.apply(this.element[0],[i].concat(n))===!1||i.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,i){e.Widget.prototype["_"+t]=function(n,o,r){"string"==typeof o&&(o={effect:o});var a,s=o?o===!0||"number"==typeof o?i:o.effect||i:t;o=o||{},"number"==typeof o&&(o={duration:o}),a=!e.isEmptyObject(o),o.complete=r,o.delay&&n.delay(o.delay),a&&e.effects&&e.effects.effect[s]?n[t](o):s!==t&&n[s]?n[s](o.duration,o.easing,r):n.queue(function(i){e(this)[t](),r&&r.call(n[0]),i()})}})}),function(e){"use strict";e(window.jQuery)}(function(e){"use strict";e.support.xhrFileUpload=!(!window.XMLHttpRequestUpload||!window.FileReader),e.support.xhrFormDataFileUpload=!!window.FormData,e.widget("blueimp.fileupload",{options:{dropZone:e(document),pasteZone:e(document),fileInput:void 0,replaceFileInput:!0,paramName:void 0,singleFileUploads:!0,limitMultiFileUploads:void 0,sequentialUploads:!1,limitConcurrentUploads:void 0,forceIframeTransport:!1,redirect:void 0,redirectParamName:void 0,postMessage:void 0,multipart:!0,maxChunkSize:void 0,uploadedBytes:void 0,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,formData:function(e){return e.serializeArray()},add:function(t,i){(i.autoUpload||i.autoUpload!==!1&&(e(this).data("blueimp-fileupload")||e(this).data("fileupload")).options.autoUpload)&&i.submit()},processData:!1,contentType:!1,cache:!1},_refreshOptionsList:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_BitrateTimer:function(){this.timestamp=+new Date,this.loaded=0,this.bitrate=0,this.getBitrate=function(e,t,i){var n=e-this.timestamp;return(!this.bitrate||!i||n>i)&&(this.bitrate=(t-this.loaded)*(1e3/n)*8,this.loaded=t,this.timestamp=e),this.bitrate}},_isXHRUpload:function(t){return!t.forceIframeTransport&&(!t.multipart&&e.support.xhrFileUpload||e.support.xhrFormDataFileUpload)},_getFormData:function(t){var i;return"function"==typeof t.formData?t.formData(t.form):e.isArray(t.formData)?t.formData:t.formData?(i=[],e.each(t.formData,function(e,t){i.push({name:e,value:t})}),i):[]},_getTotal:function(t){var i=0;return e.each(t,function(e,t){i+=t.size||1}),i},_initProgressObject:function(e){e._progress={loaded:0,total:0,bitrate:0}},_onProgress:function(e,t){if(e.lengthComputable){var i,n=+new Date;if(t._time&&t.progressInterval&&n-t._time<t.progressInterval&&e.loaded!==e.total)return;t._time=n,i=Math.floor(e.loaded/e.total*(t.chunkSize||t._progress.total))+(t.uploadedBytes||0),this._progress.loaded+=i-t._progress.loaded,this._progress.bitrate=this._bitrateTimer.getBitrate(n,this._progress.loaded,t.bitrateInterval),t._progress.loaded=t.loaded=i,t._progress.bitrate=t.bitrate=t._bitrateTimer.getBitrate(n,i,t.bitrateInterval),this._trigger("progress",e,t),this._trigger("progressall",e,this._progress)}},_initProgressListener:function(t){var i=this,n=t.xhr?t.xhr():e.ajaxSettings.xhr();n.upload&&(e(n.upload).bind("progress",function(e){var n=e.originalEvent;e.lengthComputable=n.lengthComputable,e.loaded=n.loaded,e.total=n.total,i._onProgress(e,t)}),t.xhr=function(){return n})},_initXHRData:function(t){var i,n=t.files[0],o=t.multipart||!e.support.xhrFileUpload,r=t.paramName[0];if(t.headers=t.headers||{},t.contentRange&&(t.headers["Content-Range"]=t.contentRange),o){if(e.support.xhrFormDataFileUpload){if(t.postMessage)i=this._getFormData(t),t.blob?i.push({name:r,value:t.blob}):e.each(t.files,function(e,n){i.push({name:t.paramName[e]||r,value:n})});else{if(t.formData instanceof FormData)i=t.formData;else{i=new FormData;var a=this._getFormData(t);log(a),e.each(this._getFormData(t),function(e,t){i.append(t.name,t.value)})}t.blob?(t.headers["Content-Disposition"]='attachment; filename="'+encodeURI(n.name)+'"',i.append(r,t.blob,n.name)):e.each(t.files,function(e,n){(window.Blob&&n instanceof Blob||window.File&&n instanceof File)&&i.append(t.paramName[e]||r,n,n.name)})}t.data=i}}else t.headers["Content-Disposition"]='attachment; filename="'+encodeURI(n.name)+'"',t.contentType=n.type,t.data=t.blob||n;t.blob=null},_initIframeSettings:function(t){t.dataType="iframe "+(t.dataType||""),t.formData=this._getFormData(t),t.redirect&&e("<a></a>").prop("href",t.url).prop("host")!==location.host&&t.formData.push({name:t.redirectParamName||"redirect",value:t.redirect})},_initDataSettings:function(e){this._isXHRUpload(e)?(this._chunkedUpload(e,!0)||(e.data||this._initXHRData(e),this._initProgressListener(e)),e.postMessage&&(e.dataType="postmessage "+(e.dataType||""))):this._initIframeSettings(e,"iframe")},_getParamName:function(t){var i=e(t.fileInput),n=t.paramName;return n?e.isArray(n)||(n=[n]):(n=[],i.each(function(){for(var t=e(this),i=t.prop("name")||"files[]",o=(t.prop("files")||[1]).length;o;)n.push(i),o-=1}),n.length||(n=[i.prop("name")||"files[]"])),n},_initFormSettings:function(t){t.form&&t.form.length||(t.form=e(t.fileInput.prop("form")),t.form.length||(t.form=e(this.options.fileInput.prop("form")))),t.paramName=this._getParamName(t),t.urlFunc&&(t.url=t.urlFunc()),t.url||(t.url=t.form.prop("action")||location.href),t.type=(t.type||t.form.prop("method")||"").toUpperCase(),"POST"!==t.type&&"PUT"!==t.type&&"PATCH"!==t.type&&(t.type="POST"),t.formAcceptCharset||(t.formAcceptCharset=t.form.attr("accept-charset"))},_getAJAXSettings:function(t){var i=e.extend({},this.options,t);return this._initFormSettings(i),this._initDataSettings(i),i},_getDeferredState:function(e){return e.state?e.state():e.isResolved()?"resolved":e.isRejected()?"rejected":"pending"},_enhancePromise:function(e){return e.success=e.done,e.error=e.fail,e.complete=e.always,e},_getXHRPromise:function(t,i,n){var o=e.Deferred(),r=o.promise();return i=i||this.options.context||r,t===!0?o.resolveWith(i,n):t===!1&&o.rejectWith(i,n),r.abort=o.promise,this._enhancePromise(r)},_addConvenienceMethods:function(e,t){var i=this;t.submit=function(){return"pending"!==this.state()&&(t.jqXHR=this.jqXHR=i._trigger("submit",e,this)!==!1&&i._onSend(e,this)),this.jqXHR||i._getXHRPromise()},t.abort=function(){return this.jqXHR?this.jqXHR.abort():this._getXHRPromise()},t.state=function(){if(this.jqXHR)return i._getDeferredState(this.jqXHR)},t.progress=function(){return this._progress}},_getUploadedBytes:function(e){var t=e.getResponseHeader("Range"),i=t&&t.split("-"),n=i&&i.length>1&&parseInt(i[1],10);return n&&n+1},_chunkedUpload:function(t,i){var n,o,r=this,a=t.files[0],s=a.size,l=t.uploadedBytes=t.uploadedBytes||0,d=t.maxChunkSize||s,u=a.slice||a.webkitSlice||a.mozSlice,p=e.Deferred(),c=p.promise();return!(!(this._isXHRUpload(t)&&u&&(l||d<s))||t.data)&&(!!i||(l>=s?(a.error="Uploaded bytes exceed file size",this._getXHRPromise(!1,t.context,[null,"error",a.error])):(o=function(){var i=e.extend({},t),c=i._progress.loaded;i.blob=u.call(a,l,l+d,a.type),i.chunkSize=i.blob.size,i.contentRange="bytes "+l+"-"+(l+i.chunkSize-1)+"/"+s,r._initXHRData(i),r._initProgressListener(i),n=(r._trigger("chunksend",null,i)!==!1&&e.ajax(i)||r._getXHRPromise(!1,i.context)).done(function(n,a,d){l=r._getUploadedBytes(d)||l+i.chunkSize,i._progress.loaded===c&&r._onProgress(e.Event("progress",{lengthComputable:!0,loaded:l-i.uploadedBytes,total:l-i.uploadedBytes}),i),t.uploadedBytes=i.uploadedBytes=l,i.result=n,i.textStatus=a,i.jqXHR=d,r._trigger("chunkdone",null,i),r._trigger("chunkalways",null,i),l<s?o():p.resolveWith(i.context,[n,a,d])}).fail(function(e,t,n){i.jqXHR=e,i.textStatus=t,i.errorThrown=n,r._trigger("chunkfail",null,i),r._trigger("chunkalways",null,i),p.rejectWith(i.context,[e,t,n])})},this._enhancePromise(c),c.abort=function(){return n.abort()},o(),c)))},_beforeSend:function(e,t){0===this._active&&(this._trigger("start"),this._bitrateTimer=new this._BitrateTimer,this._progress.loaded=this._progress.total=0,this._progress.bitrate=0),t._progress||(t._progress={}),t._progress.loaded=t.loaded=t.uploadedBytes||0,t._progress.total=t.total=this._getTotal(t.files)||1,t._progress.bitrate=t.bitrate=0,this._active+=1,this._progress.loaded+=t.loaded,this._progress.total+=t.total},_onDone:function(t,i,n,o){var r=o._progress.total;o._progress.loaded<r&&this._onProgress(e.Event("progress",{lengthComputable:!0,loaded:r,total:r}),o),o.result=t,o.textStatus=i,o.jqXHR=n,this._trigger("done",null,o)},_onFail:function(e,t,i,n){n.jqXHR=e,n.textStatus=t,n.errorThrown=i,this._trigger("fail",null,n),n.recalculateProgress&&(this._progress.loaded-=n._progress.loaded,this._progress.total-=n._progress.total)},_onAlways:function(e,t,i,n){this._active-=1,this._trigger("always",null,n),0===this._active&&this._trigger("stop")},_onSend:function(t,i){i.submit||this._addConvenienceMethods(t,i);var n,o,r,a,s=this,l=s._getAJAXSettings(i),d=function(){return s._sending+=1,l._bitrateTimer=new s._BitrateTimer,n=n||((o||s._trigger("send",t,l)===!1)&&s._getXHRPromise(!1,l.context,o)||s._chunkedUpload(l)||e.ajax(l)).done(function(e,t,i){s._onDone(e,t,i,l)}).fail(function(e,t,i){s._onFail(e,t,i,l)}).always(function(e,t,i){if(s._sending-=1,s._onAlways(e,t,i,l),l.limitConcurrentUploads&&l.limitConcurrentUploads>s._sending)for(var n=s._slots.shift();n;){if("pending"===s._getDeferredState(n)){n.resolve();break}n=s._slots.shift()}})};return this._beforeSend(t,l),this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?(this.options.limitConcurrentUploads>1?(r=e.Deferred(),this._slots.push(r),a=r.pipe(d)):a=this._sequence=this._sequence.pipe(d,d),a.abort=function(){return o=[void 0,"abort","abort"],n?n.abort():(r&&r.rejectWith(l.context,o),d())},this._enhancePromise(a)):d()},_onAdd:function(t,i){var n,o,r,a,s=this,l=!0,d=e.extend({},this.options,i),u=d.limitMultiFileUploads,p=this._getParamName(d);if((d.singleFileUploads||u)&&this._isXHRUpload(d))if(!d.singleFileUploads&&u)for(r=[],n=[],a=0;a<i.files.length;a+=u)r.push(i.files.slice(a,a+u)),o=p.slice(a,a+u),o.length||(o=p),n.push(o);else n=p;else r=[i.files],n=[p];return i.originalFiles=i.files,e.each(r||i.files,function(o,a){var d=e.extend({},i);return d.files=r?a:[a],d.paramName=n[o],s._initProgressObject(d),s._addConvenienceMethods(t,d),l=s._trigger("add",t,d)}),l},_replaceFileInput:function(t){var i=t.clone(!0);e("<form></form>").append(i)[0].reset(),t.after(i).detach(),e.cleanData(t.unbind("remove")),this.options.fileInput=this.options.fileInput.map(function(e,n){return n===t[0]?i[0]:n}),t[0]===this.element[0]&&(this.element=i)},_handleFileTreeEntry:function(t,i){var n,o=this,r=e.Deferred(),a=function(e){e&&!e.entry&&(e.entry=t),r.resolve([e])};return i=i||"",t.isFile?t._file?(t._file.relativePath=i,r.resolve(t._file)):t.file(function(e){e.relativePath=i,r.resolve(e)},a):t.isDirectory?(n=t.createReader(),n.readEntries(function(e){o._handleFileTreeEntries(e,i+t.name+"/").done(function(e){r.resolve(e)}).fail(a)},a)):r.resolve([]),r.promise()},_handleFileTreeEntries:function(t,i){
var n=this;return e.when.apply(e,e.map(t,function(e){return n._handleFileTreeEntry(e,i)})).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(t){t=t||{};var i=t.items;return i&&i.length&&(i[0].webkitGetAsEntry||i[0].getAsEntry)?this._handleFileTreeEntries(e.map(i,function(e){var t;return e.webkitGetAsEntry?(t=e.webkitGetAsEntry(),t&&(t._file=e.getAsFile()),t):e.getAsEntry()})):e.Deferred().resolve(e.makeArray(t.files)).promise()},_getSingleFileInputFiles:function(t){t=e(t);var i,n,o=t.prop("webkitEntries")||t.prop("entries");if(o&&o.length)return this._handleFileTreeEntries(o);if(i=e.makeArray(t.prop("files")),i.length)void 0===i[0].name&&i[0].fileName&&e.each(i,function(e,t){t.name=t.fileName,t.size=t.fileSize});else{if(n=t.prop("value"),!n)return e.Deferred().resolve([]).promise();i=[{name:n.replace(/^.*\\/,"")}]}return e.Deferred().resolve(i).promise()},_getFileInputFiles:function(t){return t instanceof e&&1!==t.length?e.when.apply(e,e.map(t,this._getSingleFileInputFiles)).pipe(function(){return Array.prototype.concat.apply([],arguments)}):this._getSingleFileInputFiles(t)},_onChange:function(t){var i=this,n={fileInput:e(t.target),form:e(t.target.form)};this._getFileInputFiles(n.fileInput).always(function(e){n.files=e,i.options.replaceFileInput&&i._replaceFileInput(n.fileInput),i._trigger("change",t,n)!==!1&&i._onAdd(t,n)})},_onPaste:function(t){var i=t.originalEvent.clipboardData,n=i&&i.items||[],o={files:[]};if(e.each(n,function(e,t){var i=t.getAsFile&&t.getAsFile();i&&o.files.push(i)}),this._trigger("paste",t,o)===!1||this._onAdd(t,o)===!1)return!1},_onDrop:function(e){var t=this,i=e.dataTransfer=e.originalEvent.dataTransfer,n={};i&&i.files&&i.files.length&&e.preventDefault(),this._getDroppedFiles(i).always(function(i){n.files=i,t._trigger("drop",e,n)!==!1&&t._onAdd(e,n)})},_onDragOver:function(t){var i=t.dataTransfer=t.originalEvent.dataTransfer;return this._trigger("dragover",t)!==!1&&void(i&&e.inArray("Files",i.types)!==-1&&(i.dropEffect="copy",t.preventDefault()))},_initEventHandlers:function(){this._isXHRUpload(this.options)&&(this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop}),this._on(this.options.pasteZone,{paste:this._onPaste})),this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragover drop"),this._off(this.options.pasteZone,"paste"),this._off(this.options.fileInput,"change")},_setOption:function(t,i){var n=e.inArray(t,this._refreshOptionsList)!==-1;n&&this._destroyEventHandlers(),this._super(t,i),n&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var t=this.options;void 0===t.fileInput?t.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):t.fileInput instanceof e||(t.fileInput=e(t.fileInput)),t.dropZone instanceof e||(t.dropZone=e(t.dropZone)),t.pasteZone instanceof e||(t.pasteZone=e(t.pasteZone))},_create:function(){var t=this.options;e.extend(t,e(this.element[0].cloneNode(!1)).data()),this._initSpecialOptions(),this._slots=[],this._sequence=this._getXHRPromise(!0),this._sending=this._active=0,this._initProgressObject(this),this._initEventHandlers()},progress:function(){return this._progress},add:function(t){var i=this;t&&!this.options.disabled&&(t.fileInput&&!t.files?this._getFileInputFiles(t.fileInput).always(function(e){t.files=e,i._onAdd(null,t)}):(t.files=e.makeArray(t.files),this._onAdd(null,t)))},send:function(t){if(t&&!this.options.disabled){if(t.fileInput&&!t.files){var i,n,o=this,r=e.Deferred(),a=r.promise();return a.abort=function(){return n=!0,i?i.abort():(r.reject(null,"abort","abort"),a)},this._getFileInputFiles(t.fileInput).always(function(e){n||(t.files=e,i=o._onSend(null,t).then(function(e,t,i){r.resolve(e,t,i)},function(e,t,i){r.reject(e,t,i)}))}),this._enhancePromise(a)}if(t.files=e.makeArray(t.files),t.files.length)return this._onSend(null,t)}return this._getXHRPromise(!1,t&&t.context)}})}),window.define&&define("fileupload",[],function(){});
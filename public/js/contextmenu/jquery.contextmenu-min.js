LEA.cmroot=1,function(t){function e(){return!1}t.fn.contextmenu=function(i){function n(t){for(var e in f)s(e,!t.disable);for(var e=0;e<t.items.length;e++)s(t.items[e],t.disable);h=t.name}function s(t,e){if(t.indexOf(".")!==-1)for(var i=t.split("."),n=i[0],s=1;s<i.length;s++)n+="."+i[s],a(n,e);l(t,e)}function l(t,e){var i=o(t);i.disable=e,i.className=e?"b-m-idisable":"b-m-item"}function a(e,i){var n=o(e);1===n.nodeType?t(n).find(".c-text").css("text-decoration",i?"underline":""):n.underline=i}function o(t){return f[t]||(f[t]={})}function c(e,i){H(),r(),m=i,I.call(p[d],{left:e.pageX,top:e.pageY},0),m&&!t(m).hasClass("item-active")&&t(m).addClass("contextmenu-hover")}function u(e){var n=!i.onContextMenu||!t.isFunction(i.onContextMenu)||i.onContextMenu.call(this,e);return n&&(i.onShow&&t.isFunction(i.onShow)&&i.onShow.call(this,A),A.showMenu(e,this)),e&&e.preventDefault(),!1}function r(){Note.$itemList.find("li").removeClass("contextmenu-hover")}var d="contextmenu"+LEA.cmroot;LEA.cmroot++,i=t.extend({alias:d,width:150},i);var h=null,m=null,p={},f={},b={},v=[],x='<div class="b-m-$[type]" unselectable="on"><div class="clearfix cm-item"><div class="b-m-icon pull-left"><i class="fa $[faIcon]"></i>$[imgIcon]</div><div class="pull-left cm-text"><span class="c-text" unselectable="on">$[text]</span></div></div></div>';itemNoIconTpl="<div class='b-m-$[type]' unselectable=on><nobr unselectable=on><span align='absmiddle'></span><span class='c-text' unselectable=on>$[text]</span></nobr></div>";var g=t("<div/>").addClass("b-m-mpanel").attr("unselectable","on").css("display","none"),y=t("<div/>").addClass("b-m-item").attr("unselectable","on"),w=t("<div/>").addClass("b-m-split"),C=t("body"),N={},$=function(i){return p[i.alias]=this,this.gidx=i.alias,this.id=i.alias,i.disable&&(this.disable=i.disable,this.className="b-m-idisable"),t(this).width(i.width).on("click",function(){}).on("mousedown",e).appendTo(C),i=null,this},M=function(e){var i=this;i.title=e.text,i.idx=e.alias,i.gidx=e.gidx,i.data=e;var n="";return e.icon&&(n='<img src="'+e.icon+'"/>'),e.imgIcon=n,e.icon?i.innerHTML=x.replace(/\$\[([^\]]+)\]/g,function(){return e[arguments[1]]}):i.innerHTML=x.replace(/\$\[([^\]]+)\]/g,function(){return e[arguments[1]]}),(e.disable||f[e.alias]&&f[e.alias].disable)&&(i.disable=!0,i.className="b-m-idisable",t(i).find(".c-text").css("text-decoration","underline")),(e.underline||f[e.alias]&&f[e.alias].underline)&&t(i).find(".c-text").css("text-decoration","underline"),e.items&&(i.group=!0),e.action&&(b[e.alias]=e.action),f[e.alias]=i,i=e=null,this},L=function(i,n,s){for(var l=null,a=n.length,o=0;o<a;o++){var c=n[o];if("splitLine"==c.type)l=w.clone()[0];else{if(c.alias||(s?c.alias=s+"."+c.text:c.alias=c.text),c.gidx=i,"group"!=c.type||c.action){"group"==c.type?($.apply(g.clone()[0],[c]),N[c.alias]=c.items,c.type="arrow",l=M.apply(y.clone()[0],[c])):(c.type="ibody",l=M.apply(y.clone()[0],[c]));var u=c;!function(e,i){t(i).on("click",function(i){return this.disable||(t.isFunction(b[this.idx])&&b[this.idx].call(this,m,e),H(),t(m).removeClass("contextmenu-hover")),!1})}(u,l)}else $.apply(g.clone()[0],[c]),N[c.alias]=c.items,c.type="arrow",l=M.apply(y.clone()[0],[c]);t(l).on("contextmenu",e).on("mouseenter",T).on("mouseleave",E)}p[i].appendChild(l),l=c=c.items=null}i=n=null},T=function(e){if(!this.group&&this.disable)return!1;if(H.call(p[this.gidx]),this.group){var i=t(this).offset(),n=t(this).outerWidth();I.apply(p[this.idx],[i,n,this])}return this.className="b-m-ifocus",!1},E=function(t){return this.group||this.disable||(this.className="b-m-item"),!1},H=function(){for(var t=null,e=v.length-1;e>=0&&v[e]!=this.gidx;e--)t=v.pop(),p[t].style.display="none",f[t]&&(f[t].disable?f[t].className="b-m-idisable":f[t].className="b-m-item")},I=function(e,i,n){var s=t(this);""==s.html()&&L(n.idx,N[n.idx],n.idx);var l=C.width(),a=document.documentElement.clientHeight-10;a=a<0?100:a;var o=t(this).outerWidth(),c=t(this).outerHeight()-10;c=c<0?100:c;var o=t(this).outerWidth();e.left=e.left+i+o>l?e.left-o<0?0:e.left-o:e.left+i,e.top=e.top+c>a?e.top-c+(i>0?25:0)<0?0:e.top-c+(i>0?25:0):e.top,t(this).css(e).show().css("max-height",a),v.push(this.gidx)},k=t("#"+i.alias),A=null;0==k.length?(A=$.apply(g.clone()[0],[i]),A.applyrule=n,A.showMenu=c,L(i.alias,i.items)):A=k[0];var F=t(i.parent).on("contextmenu",i.children,function(t){u.call(this,t)});t("body").on("click",function(t){r(),H()}),i.rule&&n(i.rule);var S={destroy:function(){F.off("contextmenu")},showMenu:function(t,e){u.call(e,t)}};return S}}(jQuery);
LEA.cmroot=1,function(e){function t(){return!1}e.fn.contextmenu=function(i){function n(e){for(var t in f)s(t,!e.disable);for(var t=0;t<e.items.length;t++)s(e.items[t],e.disable);h=e.name}function s(t,i){if(t.indexOf(".")!==-1)for(var n=t.split("."),s=n[0],o=1;o<n.length;o++)s+="."+n[o],l(s,i);else e(f[t]).find(".b-m-arrow").css("background",i?"none":"");a(t,i)}function a(e,t){var i=o(e);i.disable=t,i.className=t?"b-m-idisable":"b-m-item"}function l(t,i){var n=o(t);1===n.nodeType?e(n).find(".c-text").css("text-decoration",i?"underline":""):n.underline=i}function o(e){return f[e]||(f[e]={})}function c(t,i){E(),u(),m=i,H.call(p[d],{left:t.pageX,top:t.pageY},0),!m||e(m).hasClass("item-active")||e(m).hasClass("curSelectedNode")||e(m).addClass("contextmenu-hover")}function r(t){var n=!i.onContextMenu||!e.isFunction(i.onContextMenu)||i.onContextMenu.call(this,t);return n&&(i.onShow&&e.isFunction(i.onShow)&&i.onShow.call(this,S),S.showMenu(t,this)),t&&t.preventDefault(),!1}function u(){Note.$itemList.find("li").removeClass("contextmenu-hover"),e(notebookList).find("a").removeClass("contextmenu-hover")}var d="contextmenu"+LEA.cmroot;LEA.cmroot++,i=e.extend({alias:d,width:150},i);var h=null,m=null,p={},f={},b={},x=[],v='<div class="b-m-$[type]" unselectable="on"><div class="clearfix cm-item"><div class="b-m-icon pull-left"><i class="fa $[faIcon]"></i>$[imgIcon]</div><div class="pull-left cm-text"><span class="c-text" unselectable="on">$[text]</span></div></div></div>';itemNoIconTpl="<div class='b-m-$[type]' unselectable=on><nobr unselectable=on><span align='absmiddle'></span><span class='c-text' unselectable=on>$[text]</span></nobr></div>";var g=e("<div/>").addClass("b-m-mpanel").attr("unselectable","on").css("display","none"),y=e("<div/>").addClass("b-m-item").attr("unselectable","on"),w=e("<div/>").addClass("b-m-split"),C=e("body"),N={},$=function(i){return p[i.alias]=this,this.gidx=i.alias,this.id=i.alias,i.disable&&(this.disable=i.disable,this.className="b-m-idisable"),e(this).width(i.width).on("click",function(){}).on("mousedown",t).appendTo(C),i=null,this},L=function(t){var i=this;i.title=t.text,i.idx=t.alias,i.gidx=t.gidx,i.data=t;var n="";return t.icon&&(n='<img src="'+t.icon+'"/>'),t.imgIcon=n,t.icon?i.innerHTML=v.replace(/\$\[([^\]]+)\]/g,function(){return t[arguments[1]]}):i.innerHTML=v.replace(/\$\[([^\]]+)\]/g,function(){return t[arguments[1]]}),(t.disable||f[t.alias]&&f[t.alias].disable)&&(i.disable=!0,i.className="b-m-idisable",e(i).find(".c-text").css("text-decoration","underline")),(t.underline||f[t.alias]&&f[t.alias].underline)&&e(i).find(".c-text").css("text-decoration","underline"),t.items&&(i.group=!0),t.action&&(b[t.alias]=t.action),f[t.alias]=i,i=t=null,this},M=function(i,n,s){for(var a=null,l=n.length,o=0;o<l;o++){var c=n[o];if("splitLine"==c.type)a=w.clone()[0];else{if(c.alias||(s?c.alias=s+"."+c.text:c.alias=c.text),c.gidx=i,"group"!=c.type||c.action){"group"==c.type?($.apply(g.clone()[0],[c]),N[c.alias]=c.items,c.type="arrow",a=L.apply(y.clone()[0],[c])):(c.type="ibody",a=L.apply(y.clone()[0],[c]));var r=c;!function(t,i){e(i).on("click",function(i){return this.disable||(e.isFunction(b[this.idx])&&b[this.idx].call(this,m,t),E(),e(m).removeClass("contextmenu-hover")),!1})}(r,a)}else $.apply(g.clone()[0],[c]),N[c.alias]=c.items,c.type="arrow",a=L.apply(y.clone()[0],[c]);e(a).on("contextmenu",t).on("mouseenter",k).on("mouseleave",T)}p[i].appendChild(a),a=c=c.items=null}i=n=null},k=function(t){if(!this.group&&this.disable)return!1;if(this.disable&&this.idx.indexOf(".")===-1)return!1;if(E.call(p[this.gidx]),this.group){var i=e(this).offset(),n=e(this).outerWidth();H.apply(p[this.idx],[i,n,this])}return this.className="b-m-ifocus",!1},T=function(e){return this.group||this.disable||(this.className="b-m-item"),!1},E=function(){for(var e=null,t=x.length-1;t>=0&&x[t]!=this.gidx;t--)e=x.pop(),p[e].style.display="none",f[e]&&(f[e].disable?f[e].className="b-m-idisable":f[e].className="b-m-item")},H=function(t,i,n){var s=e(this);""==s.html()&&M(n.idx,N[n.idx],n.idx);var a=C.width(),l=document.documentElement.clientHeight-10;l=l<0?100:l;var o=e(this).outerWidth(),c=e(this).outerHeight()-10;c=c<0?100:c;var o=e(this).outerWidth();t.left=t.left+i+o>a?t.left-o<0?0:t.left-o:t.left+i,t.top=t.top+c>l?t.top-c+(i>0?25:0)<0?0:t.top-c+(i>0?25:0):t.top,e(this).css(t).show().css("max-height",l),x.push(this.gidx)},I=e("#"+i.alias),S=null;0==I.length?(S=$.apply(g.clone()[0],[i]),S.applyrule=n,S.showMenu=c,M(i.alias,i.items)):S=I[0];var A=e(i.parent).on("contextmenu",i.children,function(e){r.call(this,e)});e("body").on("click",function(e){u(),E()}),i.rule&&n(i.rule);var F={destroy:function(){A.off("contextmenu")},showMenu:function(e,t){r.call(t,e)}};return F}}(jQuery);
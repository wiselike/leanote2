tinymce.PluginManager.add("lists",function(e){function t(e){return e&&/^(OL|UL|DL)$/.test(e.nodeName)}function n(e){return e.parentNode.firstChild==e}function r(e){return e.parentNode.lastChild==e}function i(t){return t&&!!e.schema.getTextBlockElements()[t.nodeName]}var o=this;e.on("init",function(){function a(e){function t(t){var r,i,o;i=e[t?"startContainer":"endContainer"];o=e[t?"startOffset":"endOffset"];if(1==i.nodeType){r=x.create("span",{"data-mce-type":"bookmark"});if(i.hasChildNodes()){o=Math.min(o,i.childNodes.length-1);t?i.insertBefore(r,i.childNodes[o]):x.insertAfter(r,i.childNodes[o])}else i.appendChild(r);i=r;o=0}n[t?"startContainer":"endContainer"]=i;n[t?"startOffset":"endOffset"]=o}var n={};t(!0);e.collapsed||t();return n}function s(e){function t(t){function n(e){for(var t=e.parentNode.firstChild,n=0;t;){if(t==e)return n;1==t.nodeType&&"bookmark"==t.getAttribute("data-mce-type")||n++;t=t.nextSibling}return-1}var r,i,o;r=o=e[t?"startContainer":"endContainer"];i=e[t?"startOffset":"endOffset"];if(r){if(1==r.nodeType){i=n(r);r=r.parentNode;x.remove(o)}e[t?"startContainer":"endContainer"]=r;e[t?"startOffset":"endOffset"]=i}}t(!0);t();var n=x.createRng();n.setStart(e.startContainer,e.startOffset);e.endContainer&&n.setEnd(e.endContainer,e.endOffset);w.setRng(n)}function l(t,n){var r,i,o,a=x.createFragment(),s=e.schema.getBlockElements();e.settings.forced_root_block&&(n=n||e.settings.forced_root_block);if(n){i=x.create(n);i.tagName===e.settings.forced_root_block&&x.setAttribs(i,e.settings.forced_root_block_attrs);a.appendChild(i)}if(t)for(;r=t.firstChild;){var l=r.nodeName;o||"SPAN"==l&&"bookmark"==r.getAttribute("data-mce-type")||(o=!0);if(s[l]){a.appendChild(r);i=null}else if(n){if(!i){i=x.create(n);a.appendChild(i)}i.appendChild(r)}else a.appendChild(r)}e.settings.forced_root_block?o||tinymce.Env.ie&&!(tinymce.Env.ie>10)||i.appendChild(x.create("br",{"data-mce-bogus":"1"})):a.appendChild(x.create("br"));return a}function c(){return tinymce.grep(w.getSelectedBlocks(),function(e){return/^(LI|DT|DD)$/.test(e.nodeName)})}function d(e,t,n){function r(e){tinymce.each(a,function(n){e.parentNode.insertBefore(n,t.parentNode)});x.remove(e)}var i,o,a,s;a=x.select('span[data-mce-type="bookmark"]',e);n=n||l(t);i=x.createRng();i.setStartAfter(t);i.setEndAfter(e);o=i.extractContents();for(s=o.firstChild;s;s=s.firstChild)if("LI"==s.nodeName&&x.isEmpty(s)){x.remove(s);break}x.isEmpty(o)||x.insertAfter(o,e);x.insertAfter(n,e);x.isEmpty(t.parentNode)&&r(t.parentNode);x.remove(t);x.isEmpty(e)&&x.remove(e)}function u(e){var n,r;n=e.nextSibling;if(n&&t(n)&&n.nodeName==e.nodeName){for(;r=n.firstChild;)e.appendChild(r);x.remove(n)}n=e.previousSibling;if(n&&t(n)&&n.nodeName==e.nodeName){for(;r=n.firstChild;)e.insertBefore(r,e.firstChild);x.remove(n)}}function f(e){tinymce.each(tinymce.grep(x.select("ol,ul",e)),function(e){var n,r=e.parentNode;if("LI"==r.nodeName&&r.firstChild==e){n=r.previousSibling;if(n&&"LI"==n.nodeName){n.appendChild(e);x.isEmpty(r)&&x.remove(r)}}if(t(r)){n=r.previousSibling;n&&"LI"==n.nodeName&&n.appendChild(e)}})}function p(e){function i(e){x.isEmpty(e)&&x.remove(e)}var o,a=e.parentNode,s=a.parentNode;if("DD"==e.nodeName){x.rename(e,"DT");return!0}if(n(e)&&r(e)){if("LI"==s.nodeName){x.insertAfter(e,s);i(s);x.remove(a)}else if(t(s))x.remove(a,!0);else{s.insertBefore(l(e),a);x.remove(a)}return!0}if(n(e)){if("LI"==s.nodeName){x.insertAfter(e,s);e.appendChild(a);i(s)}else if(t(s))s.insertBefore(e,a);else{s.insertBefore(l(e),a);x.remove(e)}return!0}if(r(e)){if("LI"==s.nodeName)x.insertAfter(e,s);else if(t(s))x.insertAfter(e,a);else{x.insertAfter(l(e),a);x.remove(e)}return!0}if("LI"==s.nodeName){a=s;o=l(e,"LI")}else o=t(s)?l(e,"LI"):l(e);d(a,e,o);f(a.parentNode);return!0}function h(e){function n(n,r){var i;if(t(n)){for(;i=e.lastChild.firstChild;)r.appendChild(i);x.remove(n)}}var r,i;if("DT"==e.nodeName){x.rename(e,"DD");return!0}r=e.previousSibling;if(r&&t(r)){r.appendChild(e);return!0}if(r&&"LI"==r.nodeName&&t(r.lastChild)){r.lastChild.appendChild(e);n(e.lastChild,r.lastChild);return!0}r=e.nextSibling;if(r&&t(r)){r.insertBefore(e,r.firstChild);return!0}if(r&&"LI"==r.nodeName&&t(e.lastChild))return!1;r=e.previousSibling;if(r&&"LI"==r.nodeName){i=x.create(e.parentNode.nodeName);r.appendChild(i);i.appendChild(e);n(e.lastChild,i);return!0}return!1}function m(){var t=c();if(t.length){for(var n=a(w.getRng(!0)),r=0;r<t.length&&(h(t[r])||0!==r);r++);s(n);e.nodeChanged();return!0}}function g(){var t=c();if(t.length){var n,r,i=a(w.getRng(!0)),o=e.getBody();n=t.length;for(;n--;)for(var l=t[n].parentNode;l&&l!=o;){r=t.length;for(;r--;)if(t[r]===l){t.splice(n,1);break}l=l.parentNode}for(n=0;n<t.length&&(p(t[n])||0!==n);n++);s(i);e.nodeChanged();return!0}}function v(n){function r(){function t(e){var t,n;t=o[e?"startContainer":"endContainer"];n=o[e?"startOffset":"endOffset"];1==t.nodeType&&(t=t.childNodes[Math.min(n,t.childNodes.length-1)]||t);for(;t.parentNode!=a;){if(i(t))return t;if(/^(TD|TH)$/.test(t.parentNode.nodeName))return t;t=t.parentNode}return t}for(var n,r=[],a=e.getBody(),s=t(!0),l=t(),c=[],d=s;d;d=d.nextSibling){c.push(d);if(d==l)break}tinymce.each(c,function(e){if(i(e)){r.push(e);n=null}else if(x.isBlock(e)||"BR"==e.nodeName){"BR"==e.nodeName&&x.remove(e);n=null}else{var t=e.nextSibling;if(tinymce.dom.BookmarkManager.isBookmarkNode(e)&&(i(t)||!t&&e.parentNode==a))n=null;else{if(!n){n=x.create("p");e.parentNode.insertBefore(n,e);r.push(n)}n.appendChild(e)}}});return r}var o=w.getRng(!0),l=a(o),c="LI";n=n.toUpperCase();"DL"==n&&(c="DT");tinymce.each(r(),function(e){var r,i;i=e.previousSibling;if(i&&t(i)&&i.nodeName==n){r=i;e=x.rename(e,c);i.appendChild(e)}else{r=x.create(n);e.parentNode.insertBefore(r,e);r.appendChild(e);e=x.rename(e,c)}u(r)});s(l)}function y(){var n=a(w.getRng(!0)),r=e.getBody();tinymce.each(c(),function(e){var n,i;if(x.isEmpty(e))p(e);else{for(n=e;n&&n!=r;n=n.parentNode)t(n)&&(i=n);d(i,e)}});s(n)}function b(e){var t=x.getParent(w.getStart(),"OL,UL,DL");if(t)if(t.nodeName==e)y(e);else{var n=a(w.getRng(!0));u(x.rename(t,e));s(n)}else v(e)}function C(t){return function(){var n=x.getParent(e.selection.getStart(),"UL,OL,DL");return n&&n.nodeName==t}}var x=e.dom,w=e.selection;o.backspaceDelete=function(n){function r(t,n){var r,i,o=t.startContainer,a=t.startOffset;if(3==o.nodeType&&(n?a<o.data.length:a>0))return o;r=e.schema.getNonEmptyElements();i=new tinymce.dom.TreeWalker(t.startContainer);for(;o=i[n?"next":"prev"]();){if("LI"==o.nodeName&&!o.hasChildNodes())return o;if(r[o.nodeName])return o;if(3==o.nodeType&&o.data.length>0)return o}}function i(e,n){var r,i,o=e.parentNode;t(n.lastChild)&&(i=n.lastChild);r=n.lastChild;r&&"BR"==r.nodeName&&e.hasChildNodes()&&x.remove(r);x.isEmpty(n)&&x.$(n).empty();if(!x.isEmpty(e))for(;r=e.firstChild;)n.appendChild(r);i&&n.appendChild(i);x.remove(e);x.isEmpty(o)&&x.remove(o)}if(w.isCollapsed()){var o=x.getParent(w.getStart(),"LI");if(o){var l=w.getRng(!0),c=x.getParent(r(l,n),"LI");if(c&&c!=o){var d=a(l);n?i(c,o):i(o,c);s(d);return!0}if(!c&&!n&&y(o.parentNode.nodeName))return!0}}};e.on("BeforeExecCommand",function(t){var n,r=t.command.toLowerCase();"indent"==r?m()&&(n=!0):"outdent"==r&&g()&&(n=!0);if(n){e.fire("ExecCommand",{command:t.command});t.preventDefault();return!0}});e.addCommand("InsertUnorderedList",function(){b("UL")});e.addCommand("InsertOrderedList",function(){b("OL")});e.addCommand("InsertDefinitionList",function(){b("DL")});e.addQueryStateHandler("InsertUnorderedList",C("UL"));e.addQueryStateHandler("InsertOrderedList",C("OL"));e.addQueryStateHandler("InsertDefinitionList",C("DL"));e.on("keydown",function(t){if(9==t.keyCode&&!tinymce.util.VK.metaKeyPressed(t)&&e.dom.getParent(e.selection.getStart(),"LI,DT,DD")){t.preventDefault();t.shiftKey?g():m()}})});e.addButton("indent",{icon:"indent",title:"Increase indent",cmd:"Indent",onPostRender:function(){var t=this;e.on("nodechange",function(){for(var r=e.selection.getSelectedBlocks(),i=!1,o=0,a=r.length;!i&&o<a;o++){var s=r[o].nodeName;i="LI"==s&&n(r[o])||"UL"==s||"OL"==s||"DD"==s}t.disabled(i)})}});e.on("keydown",function(e){e.keyCode==tinymce.util.VK.BACKSPACE?o.backspaceDelete()&&e.preventDefault():e.keyCode==tinymce.util.VK.DELETE&&o.backspaceDelete(!0)&&e.preventDefault()})});
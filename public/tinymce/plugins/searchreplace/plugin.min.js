!function(){function e(e,t,n,r,i){function o(e,t){t=t||0;if(!e[0])throw"findAndReplaceDOMText cannot handle zero-length matches";var n=e.index;if(t>0){var r=e[t];if(!r)throw"Invalid capture group";n+=e[0].indexOf(r);e[0]=r}return[n,n+e[0].length,[e[0]]]}function a(e){var t;if(3===e.nodeType)return e.data;if(p[e.nodeName]&&!f[e.nodeName])return"";t="";(f[e.nodeName]||h[e.nodeName])&&(t+="\n");if(e=e.firstChild)do t+=a(e);while(e=e.nextSibling);return t}function s(e,t,n){var r,i,o,a,s=[],l=0,c=e,d=t.shift(),u=0;e:for(;;){(f[c.nodeName]||h[c.nodeName])&&l++;if(3===c.nodeType){if(!i&&c.length+l>=d[1]){i=c;a=d[1]-l}else r&&s.push(c);if(!r&&c.length+l>d[0]){r=c;o=d[0]-l}l+=c.length}if(r&&i){c=n({startNode:r,startNodeIndex:o,endNode:i,endNodeIndex:a,innerNodes:s,match:d[2],matchIndex:u});l-=i.length-a;r=null;i=null;s=[];d=t.shift();u++;if(!d)break}else{if((!p[c.nodeName]||f[c.nodeName])&&c.firstChild){c=c.firstChild;continue}if(c.nextSibling){c=c.nextSibling;continue}}for(;;){if(c.nextSibling){c=c.nextSibling;break}if(c.parentNode===e)break e;c=c.parentNode}}}function l(e){var t;if("function"!=typeof e){var n=e.nodeType?e:u.createElement(e);t=function(e,t){var r=n.cloneNode(!1);r.setAttribute("data-mce-index",t);e&&r.appendChild(u.createTextNode(e));return r}}else t=e;return function(e){var n,r,i,o=e.startNode,a=e.endNode,s=e.matchIndex;if(o===a){var l=o;i=l.parentNode;if(e.startNodeIndex>0){n=u.createTextNode(l.data.substring(0,e.startNodeIndex));i.insertBefore(n,l)}var c=t(e.match[0],s);i.insertBefore(c,l);if(e.endNodeIndex<l.length){r=u.createTextNode(l.data.substring(e.endNodeIndex));i.insertBefore(r,l)}l.parentNode.removeChild(l);return c}n=u.createTextNode(o.data.substring(0,e.startNodeIndex));r=u.createTextNode(a.data.substring(e.endNodeIndex));for(var d=t(o.data.substring(e.startNodeIndex),s),f=[],p=0,h=e.innerNodes.length;p<h;++p){var m=e.innerNodes[p],g=t(m.data,s);m.parentNode.replaceChild(g,m);f.push(g)}var v=t(a.data.substring(0,e.endNodeIndex),s);i=o.parentNode;i.insertBefore(n,o);i.insertBefore(d,o);i.removeChild(o);i=a.parentNode;i.insertBefore(v,a);i.insertBefore(r,a);i.removeChild(a);return v}}var c,d,u,f,p,h,m=[],g=0;u=t.ownerDocument;f=i.getBlockElements();p=i.getWhiteSpaceElements();h=i.getShortEndedElements();d=a(t);if(d){if(e.global)for(;c=e.exec(d);)m.push(o(c,r));else{c=d.match(e);m.push(o(c,r))}if(m.length){g=m.length;s(t,m,l(n))}return g}}function t(t){function n(){function e(){i.statusbar.find("#next").disabled(!a(d+1).length);i.statusbar.find("#prev").disabled(!a(d-1).length)}function n(){tinymce.ui.MessageBox.alert("Could not find the specified string.",function(){i.find("#find")[0].focus()})}var r={},i=tinymce.ui.Factory.create({type:"window",layout:"flex",pack:"center",align:"right",classes:"find-replace-ctn",onClose:function(){t.focus();c.done()},onSubmit:function(t){var o,s,l,u;t.preventDefault();s=i.find("#case").checked();u=i.find("#words").checked();l=i.find("#find").value();if(l.length)if(r.text!=l||r.caseState!=s||r.wholeWord!=u){o=c.find(l,s,u);o||n();i.statusbar.items().slice(1).disabled(0===o);e();r={text:l,caseState:s,wholeWord:u}}else{if(0===a(d+1).length){n();return}c.next();e()}else{c.done(!1);i.statusbar.items().slice(1).disabled(!0)}},buttons:[{text:"Find",onclick:function(){i.submit()}},{text:"Replace",disabled:!0,onclick:function(){if(!c.replace(i.find("#replace").value())){i.statusbar.items().slice(1).disabled(!0);d=-1;r={}}}},{text:"Replace all",disabled:!0,onclick:function(){c.replace(i.find("#replace").value(),!0,!0);i.statusbar.items().slice(1).disabled(!0);r={}}},{type:"spacer",flex:1},{text:"Prev",name:"prev",disabled:!0,onclick:function(){c.prev();e()}},{text:"Next",name:"next",disabled:!0,onclick:function(){c.next();e()}}],title:"Find and replace",items:{type:"form",padding:20,labelGap:30,spacing:10,items:[{type:"textbox",name:"find",size:40,label:"Find",value:t.selection.getNode().src},{type:"textbox",name:"replace",size:40,label:"Replace with"},{type:"checkbox",name:"case",text:"Match case",label:" "},{type:"checkbox",name:"words",text:"Whole words",label:" "}]}}).renderTo().reflow();i.moveTo($("body").width()-$(".mce-find-replace-ctn").width(),60)}function r(e){var t=e.getAttribute("data-mce-index");return"number"==typeof t?""+t:t}function i(n){var r,i;i=t.dom.create("span",{"data-mce-bogus":1});i.className="mce-match-marker";r=t.getBody();c.done(!1);return e(n,r,i,!1,t.schema)}function o(e){var t=e.parentNode;e.firstChild&&t.insertBefore(e.firstChild,e);e.parentNode.removeChild(e)}function a(e){var n,i=[];n=tinymce.toArray(t.getBody().getElementsByTagName("span"));if(n.length)for(var o=0;o<n.length;o++){var a=r(n[o]);null!==a&&a.length&&a===e.toString()&&i.push(n[o])}return i}function s(e){var n=d,r=t.dom;e=e!==!1;e?n++:n--;r.removeClass(a(d),"mce-match-marker-selected");var i=a(n);if(i.length){r.addClass(a(n),"mce-match-marker-selected");t.selection.scrollIntoView(i[0]);return n}return-1}function l(e){e.parentNode.removeChild(e)}var c=this,d=-1;c.init=function(e){e.addMenuItem("searchreplace",{text:"Find and replace",shortcut:"Meta+F",onclick:n,separator:"before",context:"edit"});e.addButton("searchreplace",{tooltip:"Find and replace",shortcut:"Meta+F",onclick:n});e.addCommand("SearchReplace",n);e.shortcuts.add("Meta+F","",n)};c.find=function(e,t,n){e=e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");e=n?"\\b"+e+"\\b":e;var r=i(new RegExp(e,t?"g":"gi"));if(r){d=-1;d=s(!0)}return r};c.next=function(){var e=s(!0);e!==-1&&(d=e)};c.prev=function(){var e=s(!1);e!==-1&&(d=e)};c.replace=function(e,n,i){var s,u,f,p,h,m,g=d;n=n!==!1;f=t.getBody();u=tinymce.toArray(f.getElementsByTagName("span"));for(s=0;s<u.length;s++){var v=r(u[s]);if(null!==v&&v.length){p=h=parseInt(v,10);if(i||p===d){if(e.length){u[s].firstChild.nodeValue=e;o(u[s])}else l(u[s]);for(;u[++s];){p=r(u[s]);if(null!==v&&v.length){if(p!==h){s--;break}l(u[s])}}n&&g--}else h>d&&u[s].setAttribute("data-mce-index",h-1)}}t.undoManager.add();d=g;if(n){m=a(g+1).length>0;c.next()}else{m=a(g-1).length>0;c.prev()}return!i&&m};c.done=function(e){var n,i,a,s;i=tinymce.toArray(t.getBody().getElementsByTagName("span"));for(n=0;n<i.length;n++){var l=r(i[n]);if(null!==l&&l.length){if(l===d.toString()){a||(a=i[n].firstChild);s=i[n].firstChild}o(i[n])}}if(a&&s){var c=t.dom.createRng();c.setStart(a,0);c.setEnd(s,s.data.length);e!==!1&&t.selection.setRng(c);return c}}}tinymce.PluginManager.add("searchreplace",t)}();
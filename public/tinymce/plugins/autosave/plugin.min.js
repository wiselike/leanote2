tinymce._beforeUnloadHandler=function(){var e;tinymce.each(tinymce.editors,function(t){t.plugins.autosave&&t.plugins.autosave.storeDraft();!e&&t.isDirty()&&t.getParam("autosave_ask_before_unload",!0)&&(e=t.translate("You have unsaved changes are you sure you want to navigate away?"))});return e};tinymce.PluginManager.add("autosave",function(e){function t(e,t){var n={s:1e3,m:6e4};e=/^(\d+)([ms]?)$/.exec(""+(e||t));return(e[2]?n[e[2]]:1)*parseInt(e,10)}function n(){var e=parseInt(p.getItem(d+"time"),10)||0;if((new Date).getTime()-e>f.autosave_retention){r(!1);return!1}return!0}function r(t){p.removeItem(d+"draft");p.removeItem(d+"time");t!==!1&&e.fire("RemoveDraft")}function i(){if(!c()&&e.isDirty()){p.setItem(d+"draft",e.getContent({format:"raw",no_events:!0}));p.setItem(d+"time",(new Date).getTime());e.fire("StoreDraft")}}function o(){if(n()){e.setContent(p.getItem(d+"draft"),{format:"raw"});e.fire("RestoreDraft")}}function a(){if(!u){setInterval(function(){e.removed||i()},f.autosave_interval);u=!0}}function s(){var t=this;t.disabled(!n());e.on("StoreDraft RestoreDraft RemoveDraft",function(){t.disabled(!n())});a()}function l(){e.undoManager.beforeChange();o();r();e.undoManager.add()}function c(t){var n=e.settings.forced_root_block;t=tinymce.trim("undefined"==typeof t?e.getBody().innerHTML:t);return""===t||new RegExp("^<"+n+"[^>]*>((Â |&nbsp;|[ \t]|<br[^>]*>)+?|)</"+n+">|<br>$","i").test(t)}var d,u,f=e.settings,p=tinymce.util.LocalStorage;d=f.autosave_prefix||"tinymce-autosave-{path}{query}-{id}-";d=d.replace(/\{path\}/g,document.location.pathname);d=d.replace(/\{query\}/g,document.location.search);d=d.replace(/\{id\}/g,e.id);f.autosave_interval=t(f.autosave_interval,"30s");f.autosave_retention=t(f.autosave_retention,"20m");e.addButton("restoredraft",{title:"Restore last draft",onclick:l,onPostRender:s});e.addMenuItem("restoredraft",{text:"Restore last draft",onclick:l,onPostRender:s,context:"file"});if(e.settings.autosave_restore_when_empty!==!1){e.on("init",function(){n()&&c()&&o()});e.on("saveContent",function(){r()})}window.onbeforeunload=tinymce._beforeUnloadHandler;this.hasDraft=n;this.storeDraft=i;this.restoreDraft=o;this.removeDraft=r;this.isEmpty=c});